<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Fedora | Sakamoto Kurome</title>
<meta name="keywords" content="Unix, Linux, Fedora, CentOS, Linux Deploy" />
<meta name="description" content="Fedora [fəˈdɔrə] 费多拉 Fedora 定制版 SELinux 初探 從進入了 CentOS 5.x 之後的 CentOS 版本中 (當然包括 CentOS 7)，SELinux 已經是個非常完備的核心模組了！尤其 CentOS 提供了">
<meta name="author" content="Sakamoto Kurome">
<link rel="canonical" href="https://sakamotokurome.github.io/posts/fedora/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css" integrity="sha256-yIlj/i15RiAA/Q&#43;xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://sakamotokurome.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://sakamotokurome.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://sakamotokurome.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://sakamotokurome.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://sakamotokurome.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.90.0" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

<link rel="stylesheet" href="https://sakamotokurome.github.io/custom.css">
<meta name="google-site-verification" content="i2r403EffR8m-KBf7EHi6AYg7tfnMshaXTAynoYPnpE" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K2Y212LPQ2"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-K2Y212LPQ2', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Fedora" />
<meta property="og:description" content="Fedora [fəˈdɔrə] 费多拉 Fedora 定制版 SELinux 初探 從進入了 CentOS 5.x 之後的 CentOS 版本中 (當然包括 CentOS 7)，SELinux 已經是個非常完備的核心模組了！尤其 CentOS 提供了" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sakamotokurome.github.io/posts/fedora/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-09T11:39:38&#43;08:00" />
<meta property="article:modified_time" content="2022-03-09T11:39:38&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Fedora"/>
<meta name="twitter:description" content="Fedora [fəˈdɔrə] 费多拉 Fedora 定制版 SELinux 初探 從進入了 CentOS 5.x 之後的 CentOS 版本中 (當然包括 CentOS 7)，SELinux 已經是個非常完備的核心模組了！尤其 CentOS 提供了"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://sakamotokurome.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Fedora",
      "item": "https://sakamotokurome.github.io/posts/fedora/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Fedora",
  "name": "Fedora",
  "description": "Fedora [fəˈdɔrə] 费多拉 Fedora 定制版 SELinux 初探 從進入了 CentOS 5.x 之後的 CentOS 版本中 (當然包括 CentOS 7)，SELinux 已經是個非常完備的核心模組了！尤其 CentOS 提供了",
  "keywords": [
    "Unix", "Linux", "Fedora", "CentOS", "Linux Deploy"
  ],
  "articleBody": "Fedora [fəˈdɔrə] 费多拉\nFedora 定制版 SELinux 初探 從進入了 CentOS 5.x 之後的 CentOS 版本中 (當然包括 CentOS 7)，SELinux 已經是個非常完備的核心模組了！尤其 CentOS 提供了很多管理 SELinux 的指令與機制， 因此在整體架構上面是單純且容易操作管理的！所以，在沒有自行開發網路服務軟體以及使用其他第三方協力軟體的情況下， 也就是全部使用 CentOS 官方提供的軟體來使用我們伺服器的情況下，建議大家不要關閉 SELinux 了喔！ 讓我們來仔細的玩玩這傢伙吧！\n什麼是 SELinux 什麼是 SELinux 呢？其實他是『 Security Enhanced Linux 』的縮寫，字面上的意義就是安全強化的 Linux 之意！那麼所謂的『安全強化』是強化哪個部分？ 是網路資安還是權限管理？底下就讓我們來談談吧！\n當初設計的目標：避免資源的誤用 SELinux 是由美國國家安全局 (NSA) 開發的，當初開發這玩意兒的目的是因為很多企業界發現， 通常系統出現問題的原因大部分都在於『內部員工的資源誤用』所導致的，實際由外部發動的攻擊反而沒有這麼嚴重。 那麼什麼是『員工資源誤用』呢？舉例來說，如果有個不是很懂系統的系統管理員為了自己設定的方便，將網頁所在目錄 /var/www/html/ 的權限設定為 drwxrwxrwx 時，你覺得會有什麼事情發生？\n現在我們知道所有的系統資源都是透過程序來進行存取的，那麼 /var/www/html/ 如果設定為 777 ， 代表所有程序均可對該目錄存取，萬一你真的有啟動 WWW 伺服器軟體，那麼該軟體所觸發的程序將可以寫入該目錄， 而該程序卻是對整個 Internet 提供服務的！只要有心人接觸到這支程序，而且該程序剛好又有提供使用者進行寫入的功能， 那麼外部的人很可能就會對你的系統寫入些莫名其妙的東西！那可真是不得了！一個小小的 777 問題可是大大的！\n為了控管這方面的權限與程序的問題，所以美國國家安全局就著手處理作業系統這方面的控管。 由於 Linux 是自由軟體，程式碼都是公開的，因此她們便使用 Linux 來作為研究的目標， 最後更將研究的結果整合到 Linux 核心裡面去，那就是 SELinux 啦！所以說， SELinux 是整合到核心的一個模組喔！ 更多的 SELinux 相關說明可以參考：\n http://www.nsa.gov/research/selinux/  這也就是說：其實 SELinux 是在進行程序、檔案等細部權限設定依據的一個核心模組！ 由於啟動網路服務的也是程序，因此剛好也能夠控制網路服務能否存取系統資源的一道關卡！ 所以，在講到 SELinux 對系統的存取控制之前，我們得先來回顧一下之前談到的系統檔案權限與使用者之間的關係。 因為先談完這個你才會知道為何需要 SELinux 的啦！\n傳統的檔案權限與帳號關係：自主式存取控制, DAC 我們通过Linux 帳號管理與 ACL 權限設定的內容，知道系統的帳號主要分為系統管理員 (root) 與一般用戶，而這兩種身份能否使用系統上面的檔案資源則與 rwx 的權限設定有關。 不過你要注意的是，各種權限設定對 root 是無效的。因此，當某個程序想要對檔案進行存取時， 系統就會根據該程序的擁有者/群組，並比對檔案的權限，若通過權限檢查，就可以存取該檔案了。\n這種存取檔案系統的方式被稱為『自主式存取控制 (Discretionary Access Control, DAC)』，基本上，就是依據程序的擁有者與檔案資源的 rwx 權限來決定有無存取的能力。 不過這種 DAC 的存取控制有幾個困擾，那就是：\n root 具有最高的權限：如果不小心某支程序被有心人士取得， 且該程序屬於 root 的權限，那麼這支程序就可以在系統上進行任何資源的存取！真是要命！ 使用者可以取得程序來變更檔案資源的存取權限：如果你不小心將某個目錄的權限設定為 777 ，由於對任何人的權限會變成 rwx ，因此該目錄就會被任何人所任意存取！  這些問題是非常嚴重的！尤其是當你的系統是被某些漫不經心的系統管理員所掌控時！他們甚至覺得目錄權限調為 777 也沒有什麼了不起的危險哩…\n以政策規則訂定特定程序讀取特定檔案：委任式存取控制, MAC 現在我們知道 DAC 的困擾就是當使用者取得程序後，他可以藉由這支程序與自己預設的權限來處理他自己的檔案資源。 萬一這個使用者對 Linux 系統不熟，那就很可能會有資源誤用的問題產生。為了避免 DAC 容易發生的問題，因此 SELinux 導入了委任式存取控制 (Mandatory Access Control, MAC) 的方法！\n委任式存取控制 (MAC) 有趣啦！他可以針對特定的程序與特定的檔案資源來進行權限的控管！ 也就是說，即使你是 root ，那麼在使用不同的程序時，你所能取得的權限並不一定是 root ， 而得要看當時該程序的設定而定。如此一來，我們針對控制的『主體』變成了『程序』而不是使用者喔！ 此外，這個主體程序也不能任意使用系統檔案資源，因為每個檔案資源也有針對該主體程序設定可取用的權限！ 如此一來，控制項目就細的多了！但整個系統程序那麼多、檔案那麼多，一項一項控制可就沒完沒了！ 所以 SELinux 也提供一些預設的政策 (Policy) ，並在該政策內提供多個規則 (rule) ，讓你可以選擇是否啟用該控制規則！\n在委任式存取控制的設定下，我們的程序能夠活動的空間就變小了！舉例來說， WWW 伺服器軟體的達成程序為 httpd 這支程式， 而預設情況下， httpd 僅能在 /var/www/ 這個目錄底下存取檔案，如果 httpd 這個程序想要到其他目錄去存取資料時， 除了規則設定要開放外，目標目錄也得要設定成 httpd 可讀取的模式 (type) 才行喔！限制非常多！ 所以，即使不小心 httpd 被 cracker 取得了控制權，他也無權瀏覽 /etc/shadow 等重要的設定檔喔！\n簡單的來說，針對 Apache 這個 WWW 網路服務使用 DAC 或 MAC 的結果來說，兩者間的關係可以使用下圖來說明。 底下這個圖示取自 Red Hat 訓練教材，真的是很不錯～所以被鳥哥借用來說明一下！\n左圖是沒有 SELinux 的 DAC 存取結果，apache 這隻 root 所主導的程序，可以在這三個目錄內作任何檔案的新建與修改～ 相當麻煩～右邊則是加上 SELinux 的 MAC 管理的結果，SELinux 僅會針對 Apache 這個『 process 』放行部份的目錄， 其他的非正規目錄就不會放行給 Apache 使用！因此不管你是誰，就是不能穿透 MAC 的框框！這樣有比較了解乎？\nSELinux 的運作模式 再次的重複說明一下，SELinux 是透過 MAC 的方式來控管程序，他控制的主體是程序， 而目標則是該程序能否讀取的『檔案資源』！所以先來說明一下這些咚咚的相關性啦！\n  主體 (Subject)： SELinux 主要想要管理的就是程序，因此你可以將『主體』跟本章談到的 process 劃上等號；\n  目標 (Object)： 主體程序能否存取的『目標資源』一般就是檔案系統。因此這個目標項目可以等檔案系統劃上等號；\n  政策 (Policy)：\n由於程序與檔案數量龐大，因此 SELinux 會依據某些服務來制訂基本的存取安全性政策。這些政策內還會有詳細的規則 (rule) 來指定不同的服務開放某些資源的存取與否。在目前的 CentOS 7.x 裡面僅有提供三個主要的政策，分別是：\n targeted：針對網路服務限制較多，針對本機限制較少，是預設的政策； minimum：由 target 修訂而來，僅針對選擇的程序來保護！ mls：完整的 SELinux 限制，限制方面較為嚴格。  建議使用預設的 targeted 政策即可。\n  安全性本文 (security context)： 我們剛剛談到了主體、目標與政策面，但是主體能不能存取目標除了政策指定之外，主體與目標的安全性本文必須一致才能夠順利存取。 這個安全性本文 (security context) 有點類似檔案系統的 rwx 啦！安全性本文的內容與設定是非常重要的！ 如果設定錯誤，你的某些服務(主體程序)就無法存取檔案系統(目標資源)，當然就會一直出現『權限不符』的錯誤訊息了！\n  由於 SELinux 重點在保護程序讀取檔案系統的權限，因此我們將上述的幾個說明搭配起來，繪製成底下的流程圖，比較好理解：\n上圖的重點在『主體』如何取得『目標』的資源存取權限！ 由上圖我們可以發現，(1)主體程序必須要通過 SELinux 政策內的規則放行後，就可以與目標資源進行安全性本文的比對， (2)若比對失敗則無法存取目標，若比對成功則可以開始存取目標。問題是，最終能否存取目標還是與檔案系統的 rwx 權限設定有關喔！如此一來，加入了 SELinux 之後，出現權限不符的情況時，你就得要一步一步的分析可能的問題了！\n安全性本文 (Security Context) CentOS 7.x 的 target 政策已經幫我們制訂好非常多的規則了，因此你只要知道如何開啟/關閉某項規則的放行與否即可。 那個安全性本文比較麻煩！因為你可能需要自行設定檔案的安全性本文呢！為何需要自行設定啊？ 舉例來說，你不也常常進行檔案的 rwx 的重新設定嗎？這個安全性本文你就將他想成 SELinux 內必備的 rwx 就是了！這樣比較好理解啦。\n安全性本文存在於主體程序中與目標檔案資源中。程序在記憶體內，所以安全性本文可以存入是沒問題。 那檔案的安全性本文是記錄在哪裡呢？事實上，安全性本文是放置到檔案的 inode 內的，因此主體程序想要讀取目標檔案資源時，同樣需要讀取 inode ， 在 inode 內就可以比對安全性本文以及 rwx 等權限值是否正確，而給予適當的讀取權限依據。\n那麼安全性本文到底是什麼樣的存在呢？我們先來看看 /root 底下的檔案的安全性本文好了。 觀察安全性本文可使用『 ls -Z 』去觀察如下：(注意：你必須已經啟動了 SELinux 才行！若尚未啟動，這部份請稍微看過一遍即可。底下會介紹如何啟動 SELinux 喔！)\n# 先來觀察一下 root 家目錄底下的『檔案的 SELinux 相關資訊』 [root@study ~]# ls -Z -rw-------. root root system_u:object_r:admin_home_t:s0 anaconda-ks.cfg -rw-r--r--. root root system_u:object_r:admin_home_t:s0 initial-setup-ks.cfg -rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 regular_express.txt # 上述特殊字體的部分，就是安全性本文的內容！鳥哥僅列出數個預設的檔案而已， # 本書學習過程中所寫下的檔案則沒有列在上頭喔！ 如上所示，安全性本文主要用冒號分為三個欄位，這三個欄位的意義為：\nIdentify:role:type 身份識別:角色:類型 這三個欄位的意義仔細的說明一下吧：\n  身份識別 (Identify)：\n相當於帳號方面的身份識別！主要的身份識別常見有底下幾種常見的類型：\n  unconfined_u：不受限的用戶，也就是說，該檔案來自於不受限的程序所產生的！一般來說，我們使用可登入帳號來取得 bash 之後， 預設的 bash 環境是不受 SELinux 管制的～因為 bash 並不是什麼特別的網路服務！因此，在這個不受 SELinux 所限制的 bash 程序所產生的檔案， 其身份識別大多就是 unconfined_u 這個『不受限』用戶囉！\n  system_u：系統用戶，大部分就是系統自己產生的檔案囉！\n  基本上，如果是系統或軟體本身所提供的檔案，大多就是 system_u 這個身份名稱，而如果是我們用戶透過 bash 自己建立的檔案，大多則是不受限的 unconfined_u 身份～如果是網路服務所產生的檔案，或者是系統服務運作過程產生的檔案，則大部分的識別就會是 system_u 囉！\n因為鳥哥這邊教大家使用文字界面來產生許多的資料，因此你看上面的三個檔案中，系統安裝主動產生的 anaconda-ks.cfs 及 initial-setup-ks.cfg 就會是 system_u，而我們自己從網路上面抓下來的 regular_express.txt 就會是 unconfined_u 這個識別啊！\n  角色 (Role)：\n透過角色欄位，我們可以知道這個資料是屬於程序、檔案資源還是代表使用者。一般的角色有：\n  object_r：代表的是檔案或目錄等檔案資源，這應該是最常見的囉；\n  system_r：代表的就是程序啦！不過，一般使用者也會被指定成為 system_r 喔！\n  你也會發現角色的欄位最後面使用『 _r 』來結尾！因為是 role 的意思嘛！\n  類型 (Type) (最重要！)：\n在預設的 targeted 政策中， Identify 與 Role 欄位基本上是不重要的！重要的在於這個類型 (type) 欄位！ 基本上，一個主體程序能不能讀取到這個檔案資源，與類型欄位有關！而類型欄位在檔案與程序的定義不太相同，分別是：\n  type：在檔案資源 (Object) 上面稱為類型 (Type)；\n  domain：在主體程序 (Subject) 則稱為領域 (domain) 了！\n  domain 需要與 type 搭配，則該程序才能夠順利的讀取檔案資源啦！\n  程序與檔案 SELinux type 欄位的相關性 那麼這三個欄位如何利用呢？首先我們來瞧瞧主體程序在這三個欄位的意義為何！透過身份識別與角色欄位的定義， 我們可以約略知道某個程序所代表的意義喔！先來動手瞧一瞧目前系統中的程序在 SELinux 底下的安全本文為何？\n# 再來觀察一下系統『程序的 SELinux 相關資訊』 [root@study ~]# ps -eZ LABEL PID TTY TIME CMD system_u:system_r:init_t:s0 1 ? 00:00:03 systemd system_u:system_r:kernel_t:s0 2 ? 00:00:00 kthreadd system_u:system_r:kernel_t:s0 3 ? 00:00:00 ksoftirqd/0 .....(中間省略)..... unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 31513 ? 00:00:00 sshd unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 31535 pts/0 00:00:00 bash # 基本上程序主要就分為兩大類，一種是系統有受限的 system_u:system_r，另一種則可能是用戶自己的， # 比較不受限的程序 (通常是本機用戶自己執行的程式)，亦即是 unconfined_u:unconfined_r 這兩種！ 基本上，這些對應資料在 targeted 政策下的對應如下：\n   身份識別 角色 該對應在 targeted 的意義     unconfined_u unconfined_r 一般可登入使用者的程序囉！比較沒有受限的程序之意！大多數都是用戶已經順利登入系統 (不論是網路還是本機登入來取得可用的 shell) 後， 所用來操作系統的程序！如 bash, X window 相關軟體等。   system_u system_r 由於為系統帳號，因此是非交談式的系統運作程序，大多數的系統程序均是這種類型！    但就如上所述，在預設的 target 政策下，其實最重要的欄位是類型欄位 (type)， 主體與目標之間是否具有可以讀寫的權限，與程序的 domain 及檔案的 type 有關！這兩者的關係我們可以使用 crond 以及他的設定檔來說明！ 亦即是 /usr/sbin/crond, /etc/crontab, /etc/cron.d 等檔案來說明。 首先，看看這幾個咚咚的安全性本文內容先：\n# 1. 先看看 crond 這個『程序』的安全本文內容： [root@study ~]# ps -eZ | grep cron system_u:system_r:crond_t:s0-s0:c0.c1023 1338 ? 00:00:01 crond system_u:system_r:crond_t:s0-s0:c0.c1023 1340 ? 00:00:00 atd # 這個安全本文的類型名稱為 crond_t 格式！ # 2. 再來瞧瞧執行檔、設定檔等等的安全本文內容為何！ [root@study ~]# ll -Zd /usr/sbin/crond /etc/crontab /etc/cron.d drwxr-xr-x. root root system_u:object_r:system_cron_spool_t:s0 /etc/cron.d -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 /etc/crontab -rwxr-xr-x. root root system_u:object_r:crond_exec_t:s0 /usr/sbin/crond 當我們執行 /usr/sbin/crond 之後，這個程式變成的程序的 domain 類型會是 crond_t 這一個～而這個 crond_t 能夠讀取的設定檔則為 system_cron_spool_t 這種的類型。因此不論 /etc/crontab, /etc/cron.d 以及 /var/spool/cron 都會是相關的 SELinux 類型 (/var/spool/cron 為 user_cron_spool_t)。 文字看起來不太容易了解，我們使用圖示來說明這幾個東西的關係！\n上圖的意義我們可以這樣看的：\n 首先，我們觸發一個可執行的目標檔案，那就是具有 crond_exec_t 這個類型的 /usr/sbin/crond 檔案； 該檔案的類型會讓這個檔案所造成的主體程序 (Subject) 具有 crond 這個領域 (domain)， 我們的政策針對這個領域已經制定了許多規則，其中包括這個領域可以讀取的目標資源類型； 由於 crond domain 被設定為可以讀取 system_cron_spool_t 這個類型的目標檔案 (Object)， 因此你的設定檔放到 /etc/cron.d/ 目錄下，就能夠被 crond 那支程序所讀取了； 但最終能不能讀到正確的資料，還得要看 rwx 是否符合 Linux 權限的規範！  上述的流程告訴我們幾個重點，第一個是政策內需要制訂詳細的 domain/type 相關性；第二個是若檔案的 type 設定錯誤， 那麼即使權限設定為 rwx 全開的 777 ，該主體程序也無法讀取目標檔案資源的啦！不過如此一來， 也就可以避免使用者將他的家目錄設定為 777 時所造成的權限困擾。\n真的是這樣嗎？沒關係～讓我們來做個測試練習吧！就是，萬一你的 crond 設定檔的 SELinux 並不是 system_cron_spool_t 時， 該設定檔真的可以順利的被讀取運作嗎？來看看底下的範例！\n# 1. 先假設你因為不熟的緣故，因此是在『root 家目錄』建立一個如下的 cron 設定： [root@study ~]# vim checktime 10 * * * * root sleep 60s # 2. 檢查後才發現檔案放錯目錄了，又不想要保留副本，因此使用 mv 移動到正確目錄： [root@study ~]# mv checktime /etc/cron.d [root@study ~]# ll /etc/cron.d/checktime -rw-r--r--. 1 root root 27 Aug 7 18:41 /etc/cron.d/checktime # 仔細看喔，權限是 644 ，確定沒有問題！任何程序都能夠讀取喔！ # 3. 強制重新啟動 crond ，然後偷看一下登錄檔，看看有沒有問題發生！ [root@study ~]# systemctl restart crond [root@study ~]# tail /var/log/cron Aug 7 18:46:01 study crond[28174]: ((null)) Unauthorized SELinux context=system_u:system_r: system_cronjob_t:s0-s0:c0.c1023 file_context=unconfined_u:object_r:admin_home_t:s0 (/etc/cron.d/checktime) Aug 7 18:46:01 study crond[28174]: (root) FAILED (loading cron table) # 上面的意思是，有錯誤！因為原本的安全本文與檔案的實際安全本文無法搭配的緣故！ 您瞧瞧～從上面的測試案例來看，我們的設定檔確實沒有辦法被 crond 這個服務所讀取喔！而原因在登錄檔內就有說明， 主要就是來自 SELinux 安全本文 (context) type 的不同所致喔！沒辦法讀就沒辦法讀，先放著～後面再來學怎麼處理這問題吧！\nSELinux 三種模式的啟動、關閉與觀察 並非所有的 Linux distributions 都支援 SELinux 的，所以你必須要先觀察一下你的系統版本為何！ 鳥哥這裡介紹的 CentOS 7.x 本身就有支援 SELinux 啦！所以你不需要自行編譯 SELinux 到你的 Linux 核心中！ 目前 SELinux 依據啟動與否，共有三種模式，分別如下：\n enforcing：強制模式，代表 SELinux 運作中，且已經正確的開始限制 domain/type 了； permissive：寬容模式：代表 SELinux 運作中，不過僅會有警告訊息並不會實際限制 domain/type 的存取。這種模式可以運來作為 SELinux 的 debug 之用； disabled：關閉，SELinux 並沒有實際運作。  我們前面不是談過主體程序需要經過政策規則、安全本文比對之後，加上 rwx 的權限規範， 若一切合理才會讓程序順利的讀取檔案嗎？那麼這個 SELinux 的三種模式與上面談到的政策規則、安全本文的關係為何呢？我們還是使用圖示加上流程來讓大家理解一下：\n就如上圖所示，首先，你得要知道，並不是所有的程序都會被 SELinux 所管制，因此最左邊會出現一個所謂的『有受限的程序主體』！那如何觀察有沒有受限 (confined )呢？ 很簡單啊！就透過 ps -eZ 去擷取！舉例來說，我們來找一找 crond 與 bash 這兩隻程序是否有被限制吧？\n[root@study ~]# ps -eZ | grep -E 'cron|bash' system_u:system_r:crond_t:s0-s0:c0.c1023 1340 ? 00:00:00 atd unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 13888 tty2 00:00:00 bash unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 28054 pts/0 00:00:00 bash unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 28094 pts/0 00:00:00 bash system_u:system_r:crond_t:s0-s0:c0.c1023 28174 ? 00:00:00 crond 如前所述，因為在目前 target 這個政策底下，只有第三個類型 (type) 欄位會有影響，因此我們上表僅列出第三個欄位的資料而已。 我們可以看到， crond 確實是有受限的主體程序，而 bash 因為是本機程序，因此就是不受限 (unconfined_t) 的類型！也就是說， bash 是不需要經過上圖的流程，而是直接去判斷 rwx 而已～。\n了解了受限的主體程序的意義之後，再來了解一下，三種模式的運作吧！首先，如果是 Disabled 的模式，那麼 SELinux 將不會運作，當然受限的程序也不會經過 SELinux ， 也是直接去判斷 rwx 而已。那如果是寬容 (permissive) 模式呢？這種模式也是不會將主體程序抵擋 (所以箭頭是可以直接穿透的喔！)，不過萬一沒有通過政策規則，或者是安全本文的比對時， 那麼該讀寫動作將會被紀錄起來 (log)，可作為未來檢查問題的判斷依據。\n至於最終那個 Enforcing 模式，就是實際將受限主體進入規則比對、安全本文比對的流程，若失敗，就直接抵擋主體程序的讀寫行為，並且將他記錄下來。 如果通通沒問題，這才進入到 rwx 權限的判斷喔！這樣可以理解三種模式的行為了嗎？\n那你怎麼知道目前的 SELinux 模式呢？就透過 getenforce 吧！\n[root@study ~]# getenforce Enforcing ==諾！就顯示出目前的模式為 Enforcing 囉！ 另外，我們又如何知道 SELinux 的政策 (Policy) 為何呢？這時可以使用 sestatus 來觀察：\n[root@study ~]# sestatus [-vb] 選項與參數： -v ：檢查列於 /etc/sestatus.conf 內的檔案與程序的安全性本文內容； -b ：將目前政策的規則布林值列出，亦即某些規則 (rule) 是否要啟動 (0/1) 之意； 範例一：列出目前的 SELinux 使用哪個政策 (Policy)？ [root@study ~]# sestatus SELinux status: enabled ==是否啟動 SELinux SELinuxfs mount: /sys/fs/selinux ==SELinux 的相關檔案資料掛載點 SELinux root directory: /etc/selinux ==SELinux 的根目錄所在 Loaded policy name: targeted ==目前的政策為何？ Current mode: enforcing ==目前的模式 Mode from config file: enforcing ==目前設定檔內規範的 SELinux 模式 Policy MLS status: enabled ==是否含有 MLS 的模式機制 Policy deny_unknown status: allowed ==是否預設抵擋未知的主體程序 Max kernel policy version: 28 如上所示，目前是啟動的，而且是 Enforcing 模式，而由設定檔查詢得知亦為 Enforcing 模式。 此外，目前的預設政策為 targeted 這一個。你應該要有疑問的是， SELinux 的設定檔是哪個檔案啊？ 其實就是 /etc/selinux/config 這個檔案喔！我們來看看內容：\n[root@study ~]# vim /etc/selinux/config SELINUX=enforcing ==調整 enforcing|disabled|permissive SELINUXTYPE=targeted ==目前僅有 targeted, mls, minimum 三種政策 若有需要修改預設政策的話，就直接改 SELINUX=enforcing 那一行即可喔！\nSELinux 的啟動與關閉 上面是預設的政策與啟動的模式！你要注意的是，如果改變了政策則需要重新開機；如果由 enforcing 或 permissive 改成 disabled ，或由 disabled 改成其他兩個，那也必須要重新開機。這是因為 SELinux 是整合到核心裡面去的， 你只可以在 SELinux 運作下切換成為強制 (enforcing) 或寬容 (permissive) 模式，不能夠直接關閉 SELinux 的！ 如果剛剛你發現 getenforce 出現 disabled 時，請到上述檔案修改成為 enforcing 然後重新開機吧！\n不過你要注意的是，如果從 disable 轉到啟動 SELinux 的模式時， 由於系統必須要針對檔案寫入安全性本文的資訊，因此開機過程會花費不少時間在等待重新寫入 SELinux 安全性本文 (有時也稱為 SELinux Label) ，而且在寫完之後還得要再次的重新開機一次喔！你必須要等待粉長一段時間！ 等到下次開機成功後，再使用 getenforce 或 sestatus 來觀察看看有否成功的啟動到 Enforcing 的模式囉！\n如果你已經在 Enforcing 的模式，但是可能由於一些設定的問題導致 SELinux 讓某些服務無法正常的運作， 此時你可以將 Enforcing 的模式改為寬容 (permissive) 的模式，讓 SELinux 只會警告無法順利連線的訊息， 而不是直接抵擋主體程序的讀取權限。讓 SELinux 模式在 enforcing 與 permissive 之間切換的方法為：\n[root@study ~]# setenforce [0|1] 選項與參數： 0 ：轉成 permissive 寬容模式； 1 ：轉成 Enforcing 強制模式 範例一：將 SELinux 在 Enforcing 與 permissive 之間切換與觀察 [root@study ~]# setenforce 0 [root@study ~]# getenforce Permissive [root@study ~]# setenforce 1 [root@study ~]# getenforce Enforcing 不過請注意， setenforce 無法在 Disabled 的模式底下進行模式的切換喔！\nTips：在某些特殊的情況底下，你從 Disabled 切換成 Enforcing 之後，竟然有一堆服務無法順利啟動，都會跟你說在 /lib/xxx 裡面的資料沒有權限讀取，所以啟動失敗。這大多是由於在重新寫入 SELinux type (Relabel) 出錯之故，使用 Permissive 就沒有這個錯誤。那如何處理呢？最簡單的方法就是在 Permissive 的狀態下，使用『 restorecon -Rv / 』重新還原所有 SELinux 的類型，就能夠處理這個錯誤！\nSELinux 政策內的規則管理 我們知道 SELinux 的三種模式是會影響到主體程序的放行與否。 如果是進入 Enforcing 模式，那麼接著下來會影響到主體程序的，當然就是第二關：『 target 政策內的各項規則 (rules) 』了！ 好了，那麼我們怎麼知道目前這個政策裡面到底有多少會影響到主體程序的規則呢？很簡單，就透過 getsebool 來瞧一瞧即可。\n SELinux 各個規則的布林值查詢 getsebool  如果想要查詢系統上面全部規則的啟動與否 (on/off，亦即布林值)，很簡單的透過 sestatus -b 或 getsebool -a 均可！\n[root@study ~]# getsebool [-a] [規則的名稱] 選項與參數： -a ：列出目前系統上面的所有 SELinux 規則的布林值為開啟或關閉值 範例一：查詢本系統內所有的布林值設定狀況 [root@study ~]# getsebool -a abrt_anon_write -- off abrt_handle_event -- off ....(中間省略).... cron_can_relabel -- off # 這個跟 cornd 比較有關！ cron_userdomain_transition -- on ....(中間省略).... httpd_enable_homedirs -- off # 這當然就是跟網頁，亦即 http 有關的囉！ ....(底下省略).... # 這麼多的 SELinux 規則喔！每個規則後面都列出現在是允許放行還是不許放行的布林值喔！  SELinux 各個規則規範的主體程序能夠讀取的檔案 SELinux type 查詢 seinfo, sesearch  我們現在知道有這麼多的 SELinux 規則，但是每個規則內到底是在限制什麼東西？如果你想要知道的話，那就得要使用 seinfo 等工具！ 這些工具並沒有在我們安裝時就安裝了，因此請拿出原版光碟，放到光碟機，鳥哥假設你將原版光碟掛載到 /mnt 底下，那麼接下來這麼作， 先安裝好我們所需要的軟體才行！\n[root@study ~]# yum install /mnt/Packages/setools-console-* 很快的安裝完畢之後，我們就可以來使用 seinfo, sesearch 等指令了！\n[root@study ~]# seinfo [-trub] 選項與參數： --all ：列出 SELinux 的狀態、規則布林值、身份識別、角色、類別等所有資訊 -u ：列出 SELinux 的所有身份識別 (user) 種類 -r ：列出 SELinux 的所有角色 (role) 種類 -t ：列出 SELinux 的所有類別 (type) 種類 -b ：列出所有規則的種類 (布林值) 範例一：列出 SELinux 在此政策下的統計狀態 [root@study ~]# seinfo Statistics for policy file: /sys/fs/selinux/policy Policy Version \u0026 Type: v.28 (binary, mls) Classes: 83 Permissions: 255 Sensitivities: 1 Categories: 1024 Types: 4620 Attributes: 357 Users: 8 Roles: 14 Booleans: 295 Cond. Expr.: 346 Allow: 102249 Neverallow: 0 Auditallow: 160 Dontaudit: 8413 Type_trans: 16863 Type_change: 74 Type_member: 35 Role allow: 30 Role_trans: 412 Range_trans: 5439 ....(底下省略).... # 從上面我們可以看到這個政策是 targeted ，此政策的安全本文類別有 4620 個； # 而各種 SELinux 的規則 (Booleans) 共制訂了 295 條！ 我們前面簡單的談到了幾個身份識別 (user) 以及角色 (role) 而已，如果你想要查詢目前所有的身份識別與角色，就使用『 seinfo -u 』及『 seinfo -r 』就可以知道了！至於簡單的統計資料，就直接輸入 seinfo 即可！但是上面還是沒有談到規則相關的東西耶～ 沒關係～一個一個來～我們在 16.5.1 的最後面談到 /etc/cron.d/checktime 的 SELinux type 類型不太對～那我們也知道 crond 這個程序的 type 是 crond_t ， 能不能找一下 crond_t 能夠讀取的檔案 SELinux type 有哪些呢？\n[root@study ~]# sesearch [-A] [-s 主體類別] [-t 目標類別] [-b 布林值] 選項與參數： -A ：列出後面資料中，允許『讀取或放行』的相關資料 -t ：後面還要接類別，例如 -t httpd_t -b ：後面還要接SELinux的規則，例如 -b httpd_enable_ftp_server 範例一：找出 crond_t 這個主體程序能夠讀取的檔案 SELinux type [root@study ~]# sesearch -A -s crond_t | grep spool allow crond_t system_cron_spool_t : file { ioctl read write create getattr .. allow crond_t system_cron_spool_t : dir { ioctl read getattr lock search op.. allow crond_t user_cron_spool_t : file { ioctl read write create getattr se.. allow crond_t user_cron_spool_t : dir { ioctl read write getattr lock add_n.. allow crond_t user_cron_spool_t : lnk_file { read getattr } ; # allow 後面接主體程序以及檔案的 SELinux type，上面的資料是擷取出來的， # 意思是說，crond_t 可以讀取 system_cron_spool_t 的檔案/目錄類型～等等！ 範例二：找出 crond_t 是否能夠讀取 /etc/cron.d/checktime 這個我們自訂的設定檔？ [root@study ~]# ll -Z /etc/cron.d/checktime -rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 /etc/cron.d/checktime # 兩個重點，一個是 SELinux type 為 admin_home_t，一個是檔案 (file) [root@study ~]# sesearch -A -s crond_t | grep admin_home_t allow domain admin_home_t : dir { getattr search open } ; allow domain admin_home_t : lnk_file { read getattr } ; allow crond_t admin_home_t : dir { ioctl read getattr lock search open } ; allow crond_t admin_home_t : lnk_file { read getattr } ; # 仔細看！看仔細～雖然有 crond_t admin_home_t 存在，但是這是總體的資訊， # 並沒有針對某些規則的尋找～所以還是不確定 checktime 能否被讀取。但是，基本上就是 SELinux # type 出問題～因此才會無法讀取的！ 所以，現在我們知道 /etc/cron.d/checktime 這個我們自己複製過去的檔案會沒有辦法被讀取的原因，就是因為 SELinux type 錯誤啦！ 根本就無法被讀取～好～那現在我們來查一查，那 getsebool -a 裡面看到的 httpd_enable_homedirs 到底是什麼？又是規範了哪些主體程序能夠讀取的 SELinux type 呢？\n[root@study ~]# semanage boolean -l | grep httpd_enable_homedirs SELinux boolean State Default Description httpd_enable_homedirs (off , off) Allow httpd to enable homedirs # httpd_enable_homedirs 的功能是允許 httpd 程序去讀取使用者家目錄的意思～ [root@study ~]# sesearch -A -b httpd_enable_homedirs 範例三：列出 httpd_enable_homedirs 這個規則當中，主體程序能夠讀取的檔案 SELinux type Found 43 semantic av rules: allow httpd_t home_root_t : dir { ioctl read getattr lock search open } ; allow httpd_t home_root_t : lnk_file { read getattr } ; allow httpd_t user_home_type : dir { getattr search open } ; allow httpd_t user_home_type : lnk_file { read getattr } ; ....(後面省略).... # 從上面的資料才可以理解，在這個規則中，主要是放行 httpd_t 能否讀取使用者家目錄的檔案！ # 所以，如果這個規則沒有啟動，基本上， httpd_t 這種程序就無法讀取使用者家目錄下的檔案！  修改 SELinux 規則的布林值 setsebool  那麼如果查詢到某個 SELinux rule，並且以 sesearch 知道該規則的用途後，想要關閉或啟動他，又該如何處置？\n[root@study ~]# setsebool [-P] 『規則名稱』 [0|1] 選項與參數： -P ：直接將設定值寫入設定檔，該設定資料未來會生效的！ 範例一：查詢 httpd_enable_homedirs 這個規則的狀態，並且修改這個規則成為不同的布林值 [root@study ~]# getsebool httpd_enable_homedirs httpd_enable_homedirs -- off ==結果是 off ，依題意給他啟動看看！ [root@study ~]# setsebool -P httpd_enable_homedirs 1 # 會跑很久很久！請耐心等待！ [root@study ~]# getsebool httpd_enable_homedirs httpd_enable_homedirs -- on 這個 setsebool 最好記得一定要加上 -P 的選項！因為這樣才能將此設定寫入設定檔！ 這是非常棒的工具組！你一定要知道如何使用 getsebool 與 setsebool 才行！\nSELinux 安全本文的修改 現在我們知道 SELinux 對受限的主體程序有沒有影響，第一關考慮 SELinux 的三種類型，第二關考慮 SELinux 的政策規則是否放行，第三關則是開始比對 SELinux type 啦！從剛剛我們也知道可以透過 sesearch 來找到主體程序與檔案的 SELinux type 關係！ 好，現在總算要來修改檔案的 SELinux type，以讓主體程序能夠讀到正確的檔案啊！這時就得要幾個重要的小東西了～來瞧瞧～\n使用 chcon 手動修改檔案的 SELinux type [root@study ~]# chcon [-R] [-t type] [-u user] [-r role] 檔案 [root@study ~]# chcon [-R] --reference=範例檔 檔案 選項與參數： -R ：連同該目錄下的次目錄也同時修改； -t ：後面接安全性本文的類型欄位！例如 httpd_sys_content_t ； -u ：後面接身份識別，例如 system_u； (不重要) -r ：後面接角色，例如 system_r； (不重要) -v ：若有變化成功，請將變動的結果列出來 --reference=範例檔：拿某個檔案當範例來修改後續接的檔案的類型！ 範例一：查詢一下 /etc/hosts 的 SELinux type，並將該類型套用到 /etc/cron.d/checktime 上 [root@study ~]# ll -Z /etc/hosts -rw-r--r--. root root system_u:object_r:net_conf_t:s0 /etc/hosts [root@study ~]# chcon -v -t net_conf_t /etc/cron.d/checktime changing security context of ‘/etc/cron.d/checktime’ [root@study ~]# ll -Z /etc/cron.d/checktime -rw-r--r--. root root unconfined_u:object_r:net_conf_t:s0 /etc/cron.d/checktime 範例二：直接以 /etc/shadow SELinux type 套用到 /etc/cron.d/checktime 上！ [root@study ~]# chcon -v --reference=/etc/shadow /etc/cron.d/checktime [root@study ~]# ll -Z /etc/shadow /etc/cron.d/checktime -rw-r--r--. root root system_u:object_r:shadow_t:s0 /etc/cron.d/checktime ----------. root root system_u:object_r:shadow_t:s0 /etc/shadow 上面的練習『都沒有正確的解答！』因為正確的 SELinux type 應該就是要以 /etc/cron.d/ 底下的檔案為標準來處理才對啊～ 好了～既然如此～能不能讓 SELinux 自己解決預設目錄下的 SELinux type 呢？可以！就用 restorecon 吧！\n使用 restorecon 讓檔案恢復正確的 SELinux type [root@study ~]# restorecon [-Rv] 檔案或目錄 選項與參數： -R ：連同次目錄一起修改； -v ：將過程顯示到螢幕上 範例三：將 /etc/cron.d/ 底下的檔案通通恢復成預設的 SELinux type！ [root@study ~]# restorecon -Rv /etc/cron.d restorecon reset /etc/cron.d/checktime context system_u:object_r:shadow_t:s0- system_u:object_r:system_cron_spool_t:s0 # 上面這兩行其實是同一行喔！表示將 checktime 由 shadow_t 改為 system_cron_spool_t 範例四：重新啟動 crond 看看有沒有正確啟動 checktime 囉！？ [root@study ~]# systemctl restart crond [root@study ~]# tail /var/log/cron # 再去瞧瞧這個 /var/log/cron 的內容，應該就沒有錯誤訊息了 其實，鳥哥幾乎已經忘了 chcon 這個指令了！因為 restorecon 主動的回復預設的 SELinux type 要簡單很多！而且可以一口氣恢復整個目錄下的檔案！ 所以，鳥哥建議你幾乎只要記得 restorecon 搭配 -Rv 同時加上某個目錄這樣的指令串即可～修改 SELinux 的 type 就變得非常的輕鬆囉！\nsemanage 預設目錄的安全性本文查詢與修改 你應該要覺得奇怪，為什麼 restorecon 可以『恢復』原本的 SELinux type 呢？那肯定就是有個地方在紀錄每個檔案/目錄的 SELinux 預設類型囉？ 沒錯！是這樣～那要如何 (1)查詢預設的 SELinux type 以及 (2)如何增加/修改/刪除預設的 SELinux type 呢？很簡單～透過 semanage 即可！他是這樣使用的：\n[root@study ~]# semanage {login|user|port|interface|fcontext|translation} -l [root@study ~]# semanage fcontext -{a|d|m} [-frst] file_spec 選項與參數： fcontext ：主要用在安全性本文方面的用途， -l 為查詢的意思； -a ：增加的意思，你可以增加一些目錄的預設安全性本文類型設定； -m ：修改的意思； -d ：刪除的意思。 範例一：查詢一下 /etc /etc/cron.d 的預設 SELinux type 為何？ [root@study ~]# semanage fcontext -l | grep -E '^/etc |^/etc/cron' SELinux fcontext type Context /etc all files system_u:object_r:etc_t:s0 /etc/cron\\.d(/.*)? all files system_u:object_r:system_cron_spool_t:s0 看到上面輸出的最後一行，那也是為啥我們直接使用 vim 去 /etc/cron.d 底下建立新檔案時，預設的 SELinux type 就是正確的！ 同時，我們也會知道使用 restorecon 回復正確的 SELinux type 時，系統會去判斷預設的類型為何的依據。現在讓我們來想一想， 如果 (當然是假的！不可能這麼幹) 我們要建立一個 /srv/mycron 的目錄，這個目錄預設也是需要變成 system_cron_spool_t 時， 我們應該要如何處理呢？基本上可以這樣作：\n# 1. 先建立 /srv/mycron 同時在內部放入設定檔，同時觀察 SELinux type [root@study ~]# mkdir /srv/mycron [root@study ~]# cp /etc/cron.d/checktime /srv/mycron [root@study ~]# ll -dZ /srv/mycron /srv/mycron/checktime drwxr-xr-x. root root unconfined_u:object_r:var_t:s0 /srv/mycron -rw-r--r--. root root unconfined_u:object_r:var_t:s0 /srv/mycron/checktime # 2. 觀察一下上層 /srv 的 SELinux type [root@study ~]# semanage fcontext -l | grep '^/srv' SELinux fcontext type Context /srv all files system_u:object_r:var_t:s0 # 怪不得 mycron 會是 var_t 囉！ # 3. 將 mycron 預設值改為 system_cron_spool_t 囉！ [root@study ~]# semanage fcontext -a -t system_cron_spool_t \"/srv/mycron(/.*)?\" [root@study ~]# semanage fcontext -l | grep '^/srv/mycron' SELinux fcontext type Context /srv/mycron(/.*)? all files system_u:object_r:system_cron_spool_t:s0 # 4. 恢復 /srv/mycron 以及子目錄相關的 SELinux type 喔！ [root@study ~]# restorecon -Rv /srv/mycron [root@study ~]# ll -dZ /srv/mycron /srv/mycron/* drwxr-xr-x. root root unconfined_u:object_r:system_cron_spool_t:s0 /srv/mycron -rw-r--r--. root root unconfined_u:object_r:system_cron_spool_t:s0 /srv/mycron/checktime # 有了預設值，未來就不會不小心被亂改了！這樣比較妥當些～ semanage 的功能很多，不過鳥哥主要用到的僅有 fcontext 這個項目的動作而已。如上所示， 你可以使用 semanage 來查詢所有的目錄預設值，也能夠使用他來增加預設值的設定！如果您學會這些基礎的工具， 那麼 SELinux 對你來說，也不是什麼太難的咚咚囉！\n一個網路服務案例及登錄檔協助 本章在 SELinux 小節當中談到的各個指令中，尤其是 setsebool, chcon, restorecon 等，都是為了當你的某些網路服務無法正常提供相關功能時， 才需要進行修改的一些指令動作。但是，我們怎麼知道哪個時候才需要進行這些指令的修改啊？我們怎麼知道系統因為 SELinux 的問題導致網路服務不對勁啊？如果都要靠用戶端連線失敗才來哭訴，那也太沒有效率了！所以，我們的 CentOS 7.x 有提供幾支偵測的服務在登錄 SELinux 產生的錯誤喔！那就是 auditd 與 setroubleshootd。\n setroubleshoot – 錯誤訊息寫入 /var/log/messages  幾乎所有 SELinux 相關的程式都會以 se 為開頭，這個服務也是以 se 為開頭！而 troubleshoot 大家都知道是錯誤克服，因此這個 setroubleshoot 自然就得要啟動他啦！這個服務會將關於 SELinux 的錯誤訊息與克服方法記錄到 /var/log/messages 與 /var/log/setroubleshoot/* 裡頭，所以你一定得要啟動這個服務才好。啟動這個服務之前當然就是得要安裝它啦！ 這玩意兒總共需要兩個軟體，分別是 setroublshoot 與 setroubleshoot-server，如果你沒有安裝，請自行使用 yum 安裝吧！\n此外，原本的 SELinux 資訊本來是以兩個服務來記錄的，分別是 auditd 與 setroubleshootd。既然是同樣的資訊，因此 CentOS 6.x (含 7.x) 以後將兩者整合在 auditd 當中啦！所以，並沒有 setroubleshootd 的服務存在了喔！因此，當你安裝好了 setroubleshoot-server 之後，請記得要重新啟動 auditd，否則 setroubleshootd 的功能不會被啟動的。\nTips：事實上，CentOS 7.x 對 setroubleshootd 的運作方式是： (1)先由 auditd 去呼叫 audispd 服務， (2)然後 audispd 服務去啟動 sedispatch 程式， (3)sedispatch 再將原本的 auditd 訊息轉成 setroubleshootd 的訊息，進一步儲存下來的！\n[root@study ~]# rpm -qa | grep setroubleshoot setroubleshoot-plugins-3.0.59-1.el7.noarch setroubleshoot-3.2.17-3.el7.x86_64 setroubleshoot-server-3.2.17-3.el7.x86_64 在預設的情況下，這個 setroubleshoot 應該都是會安裝的！是否正確安裝可以使用上述的表格指令去查詢。萬一沒有安裝，請使用 yum install 去安裝吧！ 再說一遍，安裝完畢最好重新啟動 auditd 這個服務喔！不過，剛剛裝好且順利啟動後， setroubleshoot 還是不會有作用，為啥？ 因為我們並沒有任何受限的網路服務主體程序在運作啊！所以，底下我們將使用一個簡單的 FTP 伺服器軟體為例，讓你了解到我們上頭講到的許多重點的應用！\n 實例狀況說明：透過 vsftpd 這個 FTP 伺服器來存取系統上的檔案  現在的年輕小伙子們傳資料都用 line, FB, dropbox, google 雲端磁碟等等，不過在網路早期傳送大容量的檔案，還是以 FTP 這個協定為主！ 現在為了速度，經常有 p2p 的軟體提供大容量檔案的傳輸，但以鳥哥這個老人家來說，可能 FTP 傳送資料還是比較有保障… 在 CentOS 7.x 的環境下，達成 FTP 的預設伺服器軟體主要是 vsftpd 這一支喔！\n詳細的 FTP 協定我們在伺服器篇再來談，這裡只是簡單的利用 vsftpd 這個軟體與 FTP 的協定來講解 SELinux 的問題與錯誤克服而已。 不過既然要使用到 FTP 協定，一些簡單的知識還是得要存在才好！否則等一下我們沒有辦法了解為啥要這麼做！ 首先，你得要知道，用戶端需要使用『FTP 帳號登入 FTP 伺服器』才行！而有一個稱為『匿名 (anonymous) 』的帳號可以登入系統！ 但是這個匿名的帳號登入後，只能存取某一個特定的目錄，而無法脫離該目錄～！\n在 vsftpd 中，一般用戶與匿名者的家目錄說明如下：\n 匿名者：如果使用瀏覽器來連線到 FTP 伺服器的話，那預設就是使用匿名者登入系統。而匿名者的家目錄預設是在 /var/ftp 當中！ 同時，匿名者在家目錄下只能下載資料，不能上傳資料到 FTP 伺服器。同時，匿名者無法離開 FTP 伺服器的 /var/ftp 目錄喔！ 一般 FTP 帳號：在預設的情況下，所有 UID 大於 1000 的帳號，都可以使用 FTP 來登入系統！ 而登入系統之後，所有的帳號都能夠取得自己家目錄底下的檔案資料！當然預設是可以上傳、下載檔案的！  為了避免跟之前章節的用戶產生誤解的情況，這裡我們先建立一個名為 ftptest 的帳號，且帳號密碼為 myftp123， 先來建立一下吧！\n[root@study ~]# useradd -s /sbin/nologin ftptest [root@study ~]# echo \"myftp123\" | passwd --stdin ftptest 接下來當然就是安裝 vsftpd 這隻伺服器軟體，同時啟動這隻服務，另外，我們也希望未來開機都能夠啟動這隻服務！ 因此需要這樣做 (鳥哥假設你的 CentOS 7.x 的原版光碟已經掛載於 /mnt 了喔！)：\n[root@study ~]# yum install /mnt/Packages/vsftpd-3* [root@study ~]# systemctl start vsftpd [root@study ~]# systemctl enable vsftpd [root@study ~]# netstat -tlnp Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1326/sshd tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 2349/master tcp6 0 0 :::21 :::* LISTEN 6256/vsftpd tcp6 0 0 :::22 :::* LISTEN 1326/sshd tcp6 0 0 ::1:25 :::* LISTEN 2349/master # 要注意看，上面的特殊字體那行有出現，才代表 vsftpd 這隻服務有啟動喔！！  匿名者無法下載的問題  現在讓我們來模擬一些 FTP 的常用狀態！假設你想要將 /etc/securetty 以及主要的 /etc/sysctl.conf 放置給所有人下載， 那麼你可能會這樣做！\n[root@study ~]# cp -a /etc/securetty /etc/sysctl.conf /var/ftp/pub [root@study ~]# ll /var/ftp/pub -rw-------. 1 root root 221 Oct 29 2014 securetty # 先假設你沒有看到這個問題！ -rw-r--r--. 1 root root 225 Mar 6 11:05 sysctl.conf 一般來說，預設要給用戶下載的 FTP 檔案會放置到上面表格當中的 /var/ftp/pub 目錄喔！現在讓我們使用簡單的終端機瀏覽器 curl 來觀察看看！ 看你能不能查詢到上述兩個檔案的內容呢？\n# 1. 先看看 FTP 根目錄底下有什麼檔案存在？ [root@study ~]# curl ftp://localhost drwxr-xr-x 2 0 0 40 Aug 08 00:51 pub # 確實有存在一個名為 pub 的檔案喔！那就是在 /var/ftp 底下的 pub 囉！ # 2. 再往下看看，能不能看到 pub 內的檔案呢？ [root@study ~]# curl ftp://localhost/pub/ # 因為是目錄，要加上 / 才好！ -rw------- 1 0 0 221 Oct 29 2014 securetty -rw-r--r-- 1 0 0 225 Mar 06 03:05 sysctl.conf # 3. 承上，繼續看一下 sysctl.conf 的內容好了！ [root@study ~]# curl ftp://localhost/pub/sysctl.conf # System default settings live in /usr/lib/sysctl.d/00-system.conf. # To override those settings, enter new settings here, or in an /etc/sysctl.d/.conf file # # For more information, see sysctl.conf(5) and sysctl.d(5). # 真的有看到這個檔案的內容喔！所以確定是可以讓 vsftpd 讀取到這檔案的！ # 4. 再來瞧瞧 securetty 好了！ [root@study ~]# curl ftp://localhost/pub/securetty curl: (78) RETR response: 550 # 看不到耶！但是，基本的原因應該是權限問題喔！因為 vsftpd 預設放在 /var/ftp/pub 內的資料， # 不論什麼 SELinux type 幾乎都可以被讀取的才對喔！所以要這樣處理！ # 5. 修訂權限之後再一次觀察 securetty 看看！ [root@study ~]# chmod a+r /var/ftp/pub/securetty [root@study ~]# curl ftp://localhost/pub/securetty # 此時你就可以看到實際的檔案內容囉！ # 6. 修訂 SELinux type 的內容 (非必備) [root@study ~]# restorecon -Rv /var/ftp 上面這個例子在告訴你，要先從權限的角度來瞧一瞧，如果無法被讀取，可能就是因為沒有 r 或沒有 rx 囉！並不一定是由 SELinux 引起的！ 了解乎？好～再來瞧瞧如果是一般帳號呢？如何登入？\n 無法從家目錄下載檔案的問題分析與解決  我們前面建立了 ftptest 帳號，那如何使用文字界面來登入呢？就使用如下的方式來處理。同時請注意，因為文字型的 FTP 用戶端軟體， 預設會將用戶丟到根目錄而不是家目錄，因此，你的 URL 可能需要修訂一下如下！\n# 0. 為了讓 curl 這個文字瀏覽器可以傳輸資料，我們先建立一些資料在 ftptest 家目錄 [root@study ~]# echo \"testing\"  ~ftptest/test.txt [root@study ~]# cp -a /etc/hosts /etc/sysctl.conf ~ftptest/ [root@study ~]# ll ~ftptest/ -rw-r--r--. 1 root root 158 Jun 7 2013 hosts -rw-r--r--. 1 root root 225 Mar 6 11:05 sysctl.conf -rw-r--r--. 1 root root 8 Aug 9 01:05 test.txt # 1. 一般帳號直接登入 FTP 伺服器，同時變換目錄到家目錄去！ [root@study ~]# curl ftp://ftptest:myftp123@localhost/~/ -rw-r--r-- 1 0 0 158 Jun 07 2013 hosts -rw-r--r-- 1 0 0 225 Mar 06 03:05 sysctl.conf -rw-r--r-- 1 0 0 8 Aug 08 17:05 test.txt # 真的有資料～看檔案最左邊的權限也是沒問題，所以，來讀一下 test.txt 的內容看看 # 2. 開始下載 test.txt, sysctl.conf 等有權限可以閱讀的檔案看看！ [root@study ~]# curl ftp://ftptest:myftp123@localhost/~/test.txt curl: (78) RETR response: 550 # 竟然說沒有權限！明明我們的 rwx 是正常沒問題！那是否有可能是 SELinux 造成的？ # 3. 先將 SELinux 從 Enforce 轉成 Permissive 看看情況！同時觀察登錄檔 [root@study ~]# setenforce 0 [root@study ~]# curl ftp://ftptest:myftp123@localhost/~/test.txt testing [root@study ~]# setenforce 1 # 確定問題後，一定要轉成 Enforcing 啊！ # 確定有資料內容！所以，確定就是 SELinux 造成無法讀取的問題～那怎辦？要改規則？還是改 type？ # 因為都不知道，所以，就檢查一下登錄檔看看有沒有相關的資訊可以提供給我們處理！ [root@study ~]# vim /var/log/messages Aug 9 02:55:58 station3-39 setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from lock access on the file /home/ftptest/test.txt. For complete SELinux messages. run sealert -l 3a57aad3-a128-461b-966a-5bb2b0ffa0f9 Aug 9 02:55:58 station3-39 python: SELinux is preventing /usr/sbin/vsftpd from lock access on the file /home/ftptest/test.txt. ***** Plugin catchall_boolean (47.5 confidence) suggests ****************** If you want to allow ftp to home dir Then you must tell SELinux about this by enabling the 'ftp_home_dir' boolean. You can read 'None' man page for more details. Do setsebool -P ftp_home_dir 1 ***** Plugin catchall_boolean (47.5 confidence) suggests ****************** If you want to allow ftpd to full access Then you must tell SELinux about this by enabling the 'ftpd_full_access' boolean. You can read 'None' man page for more details. Do setsebool -P ftpd_full_access 1 ***** Plugin catchall (6.38 confidence) suggests ************************** .....(底下省略)..... # 基本上，你會看到有個特殊字體的部份，就是 sealert 那一行。雖然底下已經列出可能的解決方案了， # 就是一堆底線那些東西。至少就有三個解決方案 (最後一個沒列出來)，哪種才是正確的？ # 為了了解正確的解決方案，我們還是還執行一下 sealert 那行吧！看看情況再說！ # 4. 透過 sealert 的解決方案來處理問題 [root@study ~]# sealert -l 3a57aad3-a128-461b-966a-5bb2b0ffa0f9 SELinux is preventing /usr/sbin/vsftpd from lock access on the file /home/ftptest/test.txt. # 底下說有 47.5% 的機率是由於這個原因所發生，並且可以使用 setsebool 去解決的意思！ ***** Plugin catchall_boolean (47.5 confidence) suggests ****************** If you want to allow ftp to home dir Then you must tell SELinux about this by enabling the 'ftp_home_dir' boolean. You can read 'None' man page for more details. Do setsebool -P ftp_home_dir 1 # 底下說也是有 47.5% 的機率是由此產生的！ ***** Plugin catchall_boolean (47.5 confidence) suggests ****************** If you want to allow ftpd to full access Then you must tell SELinux about this by enabling the 'ftpd_full_access' boolean. You can read 'None' man page for more details. Do setsebool -P ftpd_full_access 1 # 底下說，僅有 6.38% 的可信度是由這個情況產生的！ ***** Plugin catchall (6.38 confidence) suggests ************************** If you believe that vsftpd should be allowed lock access on the test.txt file by default. Then you should report this as a bug. You can generate a local policy module to allow this access. Do allow this access for now by executing: # grep vsftpd /var/log/audit/audit.log | audit2allow -M mypol # semodule -i mypol.pp # 底下就重要了！是整個問題發生的主因～最好還是稍微瞧一瞧！ Additional Information: Source Context system_u:system_r:ftpd_t:s0-s0:c0.c1023 Target Context unconfined_u:object_r:user_home_t:s0 Target Objects /home/ftptest/test.txt [ file ] Source vsftpd Source Path /usr/sbin/vsftpd Port  Host station3-39.gocloud.vm Source RPM Packages vsftpd-3.0.2-9.el7.x86_64 Target RPM Packages Policy RPM selinux-policy-3.13.1-23.el7.noarch Selinux Enabled True Policy Type targeted Enforcing Mode Permissive Host Name station3-39.gocloud.vm Platform Linux station3-39.gocloud.vm 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 Alert Count 3 First Seen 2015-08-09 01:00:12 CST Last Seen 2015-08-09 02:55:57 CST Local ID 3a57aad3-a128-461b-966a-5bb2b0ffa0f9 Raw Audit Messages type=AVC msg=audit(1439060157.358:635): avc: denied { lock } for pid=5029 comm=\"vsftpd\" path=\"/home/ftptest/test.txt\" dev=\"dm-2\" ino=141 scontext=system_u:system_r:ftpd_t:s0-s0: c0.c1023 tcontext=unconfined_u:object_r:user_home_t:s0 tclass=file type=SYSCALL msg=audit(1439060157.358:635): arch=x86_64 syscall=fcntl success=yes exit=0 a0=4 a1=7 a2=7fffceb8cbb0 a3=0 items=0 ppid=5024 pid=5029 auid=4294967295 uid=1001 gid=1001 euid=1001 suid=1001 fsuid=1001 egid=1001 sgid=1001 fsgid=1001 tty=(none) ses=4294967295 comm=vsftpd exe=/usr/sbin/vsftpd subj=system_u:system_r:ftpd_t:s0-s0:c0.c1023 key=(null) Hash: vsftpd,ftpd_t,user_home_t,file,lock 經過上面的測試，現在我們知道主要的問題發生在 SELinux 的 type 不是 vsftpd_t 所能讀取的原因～ 經過仔細觀察 test.txt 檔案的類型，我們知道他原本就是家目錄，因此是 user_home_t 也沒啥了不起的啊！是正確的～ 因此，分析兩個比較可信 (47.5%) 的解決方案後，可能是與 ftp_home_dir 比較有關啊！所以，我們應該不需要修改 SELinux type， 修改的應該是 SELinux rules 才對！所以，這樣做看看：\n# 1. 先確認一下 SELinux 的模式，然後再瞧一瞧能否下載 test.txt，最終使用處理方式來解決～ [root@study ~]# getenforce Enforcing [root@study ~]# curl ftp://ftptest:myftp123@localhost/~/test.txt curl: (78) RETR response: 550 # 確定還是無法讀取的喔！ [root@study ~]# setsebool -P ftp_home_dir 1 [root@study ~]# curl ftp://ftptest:myftp123@localhost/~/test.txt testing # OK！太讚了！處理完畢！現在使用者可以在自己的家目錄上傳/下載檔案了！ # 2. 開始下載其他檔案試看看囉！ [root@study ~]# curl ftp://ftptest:myftp123@localhost/~/sysctl.conf # System default settings live in /usr/lib/sysctl.d/00-system.conf. # To override those settings, enter new settings here, or in an /etc/sysctl.d/.conf file # # For more information, see sysctl.conf(5) and sysctl.d(5). 沒問題喔！透過修改 SELinux rule 的布林值，現在我們就可以使用一般帳號在 FTP 服務來上傳/下載資料囉！非常愉快吧！ 那萬一我們還有其他的目錄也想要透過 FTP 來提供這個 ftptest 用戶上傳與下載呢？往下瞧瞧～\n 一般帳號用戶從非正規目錄上傳/下載檔案  假設我們還想要提供 /srv/gogogo 這個目錄給 ftptest 用戶使用，那又該如何處理呢？假設我們都沒有考慮 SELinux ， 那就是這樣的情況：\n# 1. 先處理好所需要的目錄資料 [root@study ~]# mkdir /srv/gogogo [root@study ~]# chgrp ftptest /srv/gogogo [root@study ~]# echo \"test\"  /srv/gogogo/test.txt # 2. 開始直接使用 ftp 觀察一下資料！ [root@study ~]# curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt curl: (78) RETR response: 550 # 有問題喔！來瞧瞧登錄檔怎麼說！ [root@study ~]# grep sealert /var/log/messages | tail Aug 9 04:23:12 station3-39 setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from read access on the file test.txt. For complete SELinux messages. run sealert -l 08d3c0a2-5160-49ab-b199-47a51a5fc8dd [root@study ~]# sealert -l 08d3c0a2-5160-49ab-b199-47a51a5fc8dd SELinux is preventing /usr/sbin/vsftpd from read access on the file test.txt. # 雖然這個可信度比較高～不過，因為會全部放行 FTP ，所以不太考慮！ ***** Plugin catchall_boolean (57.6 confidence) suggests ****************** If you want to allow ftpd to full access Then you must tell SELinux about this by enabling the 'ftpd_full_access' boolean. You can read 'None' man page for more details. Do setsebool -P ftpd_full_access 1 # 因為是非正規目錄的使用，所以這邊加上預設 SELinux type 恐怕會是比較正確的選擇！ ***** Plugin catchall_labels (36.2 confidence) suggests ******************* If you want to allow vsftpd to have read access on the test.txt file Then you need to change the label on test.txt Do # semanage fcontext -a -t FILE_TYPE 'test.txt' where FILE_TYPE is one of the following: NetworkManager_tmp_t, abrt_helper_exec_t, abrt_tmp_t, abrt_upload_watch_tmp_t, abrt_var_cache_t, abrt_var_run_t, admin_crontab_tmp_t, afs_cache_t, alsa_home_t, alsa_tmp_t, amanda_tmp_t, antivirus_home_t, antivirus_tmp_t, apcupsd_tmp_t, ... Then execute: restorecon -v 'test.txt' ***** Plugin catchall (7.64 confidence) suggests ************************** If you believe that vsftpd should be allowed read access on the test.txt file by default. Then you should report this as a bug. You can generate a local policy module to allow this access. Do allow this access for now by executing: # grep vsftpd /var/log/audit/audit.log | audit2allow -M mypol # semodule -i mypol.pp Additional Information: Source Context system_u:system_r:ftpd_t:s0-s0:c0.c1023 Target Context unconfined_u:object_r:var_t:s0 Target Objects test.txt [ file ] Source vsftpd .....(底下省略)..... 因為是非正規目錄啊，所以感覺上似乎與 semanage 那一行的解決方案比較相關～接下來就是要找到 FTP 的 SELinux type 來解決囉！ 所以，讓我們查一下 FTP 相關的資料囉！\n# 3. 先查看一下 /var/ftp 這個地方的 SELinux type 吧！ [root@study ~]# ll -Zd /var/ftp drwxr-xr-x. root root system_u:object_r:public_content_t:s0 /var/ftp # 4. 以 sealert 建議的方法來處理好 SELinux type 囉！ [root@study ~]# semanage fcontext -a -t public_content_t \"/srv/gogogo(/.*)?\" [root@study ~]# restorecon -Rv /srv/gogogo [root@study ~]# curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt test # 喔耶！終於再次搞定喔！ 在這個範例中，我們是修改了 SELinux type 喔！與前一個修改 SELinux rule 不太一樣！要理解理解喔！\n 無法變更 FTP 連線埠口問題分析與解決  在某些情況下，可能你的伺服器軟體需要開放在非正規的埠口，舉例來說，如果因為某些政策問題，導致 FTP 啟動的正常的 21 號埠口無法使用， 因此你想要啟用在 555 號埠口時，該如何處理呢？基本上，既然 SELinux 的主體程序大多是被受限的網路服務，沒道理不限制放行的埠口啊！ 所以，很可能會出問題～那就得要想想辦法才行！\n# 1. 先處理 vsftpd 的設定檔，加入換 port 的參數才行！ [root@study ~]# vim /etc/vsftpd/vsftpd.conf # 請按下大寫的 G 跑到最後一行，然後新增加底下這行設定！前面不可以留白！ listen_port=555 # 2. 重新啟動 vsftpd 並且觀察登錄檔的變化！ [root@study ~]# systemctl restart vsftpd [root@study ~]# grep sealert /var/log/messages Aug 9 06:34:46 station3-39 setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from name_bind access on the tcp_socket port 555. For complete SELinux messages. run sealert -l 288118e7-c386-4086-9fed-2fe78865c704 [root@study ~]# sealert -l 288118e7-c386-4086-9fed-2fe78865c704 SELinux is preventing /usr/sbin/vsftpd from name_bind access on the tcp_socket port 555. ***** Plugin bind_ports (92.2 confidence) suggests ************************ If you want to allow /usr/sbin/vsftpd to bind to network port 555 Then you need to modify the port type. Do # semanage port -a -t PORT_TYPE -p tcp 555 where PORT_TYPE is one of the following: certmaster_port_t, cluster_port_t, ephemeral_port_t, ftp_data_port_t, ftp_port_t, hadoop_datanode_port_t, hplip_port_t, port_t, postgrey_port_t, unreserved_port_t. .....(後面省略)..... # 看一下信任度，高達 92.2% 耶！幾乎就是這傢伙～因此不必再看～就是他了！比較重要的是， # 解決方案裡面，那個 PORT_TYPE 有很多選擇～但我們是要開啟 FTP 埠口嘛！所以， # 就由後續資料找到 ftp_port_t 那個項目囉！帶入實驗看看！ # 3. 實際帶入 SELinux 埠口修訂後，在重新啟動 vsftpd 看看 [root@study ~]# semanage port -a -t ftp_port_t -p tcp 555 [root@study ~]# systemctl restart vsftpd [root@study ~]# netstat -tlnp Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1167/sshd tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1598/master tcp6 0 0 :::555 :::* LISTEN 8436/vsftpd tcp6 0 0 :::22 :::* LISTEN 1167/sshd tcp6 0 0 ::1:25 :::* LISTEN 1598/master # 4. 實驗看看這個 port 能不能用？ [root@study ~]# curl ftp://localhost:555/pub/ -rw-r--r-- 1 0 0 221 Oct 29 2014 securetty -rw-r--r-- 1 0 0 225 Mar 06 03:05 sysctl.conf 透過上面的幾個小練習，你會知道在正規或非正規的環境下，如何處理你的 SELinux 問題哩！仔細研究看看囉！\nTips Multiple Git Accounts $ ssh-keygen -t rsa -C \"your-email\" $ nano ~/.ssh/config Host github-proj1 HostName github.com User git IdentityFile ~/.ssh/id_rsa_github_proj1 AddKeysToAgent yes Host github-proj2 HostName github.com User git IdentityFile ~/.ssh/id_rsa_github_proj2 AddKeysToAgent yes Host aws-codecommit-proj3 Hostname git-codecommit.us-east-2.amazonaws.com User TECADMIN0123456789 IdentityFile ~/.ssh/id_rsa_aws_codecommit_proj3 AddKeysToAgent yes $ git clone ssh://github-proj1/user1/repo.git $ git clone ssh://github-proj2/user2/repo.git $ git clone ssh://aws-codecommit-proj3/v1/repos/myrepo Gnome $ sudo dnf install gnome-tweaks gnome-extensions-app gnome-tweaks 里面可以管理 startup apps。\ngnome-extensions-app 管理 extensions。\n Blur Me gnome-shell-extension-appindicator gnome-shell-extension-caffeine gnome-shell-extension-freon  Fcitx5 安装\n$ sudo dnf install fcitx5 fcitx5-chinese-addons fcitx5-gtk fcitx5-qt fcitx5-configtool fcitx5-autostart $ rpm -ql fcitx5-autostart /etc/profile.d/fcitx5.sh /etc/xdg/autostart/org.fcitx.Fcitx5.desktop $ cat /etc/profile.d/fcitx5.sh if [ ! \"$XDG_SESSION_TYPE\" = \"tty\" ] # if this is a gui session (not tty) then # let's use fcitx instead of fcitx5 to make flatpak happy # this may break behavior for users who have installed both # fcitx and fcitx5, let then change the file on their own export INPUT_METHOD=fcitx export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=@im=fcitx fi $ cat /etc/xdg/autostart/org.fcitx.Fcitx5.desktop [Desktop Entry] Name[ca]=Fcitx 5 Name[da]=Fcitx 5 Name[de]=Fcitx 5 Name[ja]=Fcitx 5 Name[ko]=Fcitx 5 Name[zh_CN]=Fcitx 5 Name[zh_TW]=Fcitx 5 Name=Fcitx 5 GenericName[ca]=Mètode d'entrada GenericName[da]=Inputmetode GenericName[de]=Eingabemethode GenericName[ja]=入力メソッド GenericName[ko]=입력기 GenericName[ru]=Метод ввода GenericName[zh_CN]=输入法 GenericName[zh_TW]=輸入法 GenericName=Input Method Comment[ca]=Mètode d'entrada estàndard Comment[da]=Start inputmetode Comment[de]=Eingabemethode starten Comment[ja]=入力メソッドを開始 Comment[ko]=입력기 시작 Comment[zh_CN]=启动输入法 Comment=Start Input Method Exec=/usr/bin/fcitx5 Icon=fcitx Terminal=false Type=Application Categories=System;Utility; StartupNotify=false X-GNOME-AutoRestart=false X-GNOME-Autostart-Notify=false X-KDE-autostart-after=panel X-KDE-StartupNotify=false X-KDE-Wayland-VirtualKeyboard=true 扩展\n Input Method Panel  Speed Up DNF 尝试更改参数\n$ sudo vi /etc/dnf/dnf.conf fastestmirror=true max_parallel_downloads=10 metadata_expire=2d  fastermirror 选择最快的镜像 max_parallel_downloads 一次下载多个包  如果在更新过程中某个小包下载不了，导致无法更新，尝试只使用 ipv4 或者点击下载链接手动下载\n$ sudo dnf update -4 -v -y Mirrors bfsu tuna的姊妹站，通俗来讲就是tuna派人维护，北京外国语大学出钱。人少、稳定、涵盖项目较广。\n$ sudo mkdir /etc/yum.repos.d/bak $ sudo mv /etc/yum.repos.d/{fedora,fedora-updates,fedora-modular,fedora-updates-modular}.repo /etc/yum.repos.d/bak $ sudo nano /etc/yum.repos.d/fedora.repo [fedora] name=Fedora $releasever - $basearch failovermethod=priority baseurl=https://mirrors.bfsu.edu.cn/fedora/releases/$releasever/Everything/$basearch/os/ metadata_expire=28d gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch skip_if_unavailable=False $ sudo nano /etc/yum.repos.d/fedora-updates.repo [updates] name=Fedora $releasever - $basearch - Updates failovermethod=priority baseurl=https://mirrors.bfsu.edu.cn/fedora/updates/$releasever/Everything/$basearch/ enabled=1 gpgcheck=1 metadata_expire=6h gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch skip_if_unavailable=False $ sudo nano /etc/yum.repos.d/fedora-modular.repo [fedora-modular] name=Fedora Modular $releasever - $basearch failovermethod=priority baseurl=https://mirrors.bfsu.edu.cn/fedora/releases/$releasever/Modular/$basearch/os/ enabled=1 metadata_expire=7d gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch skip_if_unavailable=False $ sudo nano /etc/yum.repos.d/fedora-updates-modular.repo [updates-modular] name=Fedora Modular $releasever - $basearch - Updates failovermethod=priority baseurl=https://mirrors.bfsu.edu.cn/fedora/updates/$releasever/Modular/$basearch/ enabled=1 gpgcheck=1 metadata_expire=6h gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch skip_if_unavailable=False 最后运行 sudo dnf makecache 生成缓存。\nrpmfusion 第一步下载基础包(开源和闭源)， 这里我们使用bfsu来下载，以避免网络问题，终端输入:\n$ sudo yum install --nogpgcheck https://mirrors.bfsu.edu.cn/rpmfusion/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://mirrors.bfsu.edu.cn/rpmfusion/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm 第二步，使用bfsu镜像\n$ sudo sed -e 's|^metalink=|#metalink=|g' -e 's|^#baseurl=http://download1.rpmfusion.org/|baseurl=https://mirrors.bfsu.edu.cn/rpmfusion/|g' -i.bak /etc/yum.repos.d/rpmfusion-* flatpak $ sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo $ sudo flatpak remote-modify flathub --url=https://mirror.sjtu.edu.cn/flathub Nvidia   Update from the existing repositories\n$ sudo dnf update   Add the RPMFusion repository for NVIDIA drivers\n$ sudo dnf install fedora-workstation-repositories   Update from the newly added repositories\n$ sudo dnf update --refresh   Install the driver and its dependencies\n$ sudo dnf install gcc kernel-headers kernel-devel akmod-nvidia xorg-x11-drv-nvidia xorg-x11-drv-nvidia-libs xorg-x11-drv-nvidia-libs.i686   Wait for the kernel modules to load up\n  Read from the updated kernel modules\n$ sudo akmods --force $ sudo dracut --force   Reboot your system\n  Edit the X11 configuration\n$ sudo cp -p /usr/share/X11/xorg.conf.d/nvidia.conf /etc/X11/xorg.conf.d/nvidia.conf $ sudo nano /etc/X11/xorg.conf.d/nvidia.conf Section \"OutputClass\" Identifier \"nvidia\" MatchDriver \"nvidia-drm\" Driver \"nvidia\" Option \"AllowEmptyInitialConfiguration\" Option \"SLI\" \"Auto\" Option \"BaseMosaic\" \"on\" Option \"PrimaryGPU\" \"yes\" EndSection Section \"ServerLayout\" Identifier \"layout\" Option \"AllowNVIDIAGPUScreens\" EndSection   Reboot your system\n  Verify the configuration\n$ glxinfo | egrep \"OpenGL vendor|OpenGL renderer\"   ZFS on Fedora zfs-fuse is a daemon which provides support for the ZFS filesystem, via fuse. Ordinarily this daemon will be invoked from system boot scripts.\n$ sudo dnf install zfs-fuse $ sudo zfs-fuse $ sudo zpool import dpool cannot import 'dpool': pool is formatted using a newer ZFS version OpenZFS on Fedora\n$ sudo rpm -e --nodeps zfs-fuse $ sudo dnf install -y https://zfsonlinux.org/fedora/zfs-release$(rpm -E %dist).noarch.rpm $ sudo dnf install -y kernel-devel $ sudo dnf install -y zfs $ sudo modprobe zfs $ echo zfs | sudo tee /etc/modules-load.d/zfs.conf Managing DNF Repository DNF repositories commonly provide their own .repo file. To add such a repository to your system and enable it, run the following command as root:\ndnf config-manager --add-repo repository_url To enable a particular repository or repositories, type the following at a shell prompt as root:\ndnf config-manager --set-enabled repository… To disable a DNF repository, run the following command as root:\ndnf config-manager --set-disabled repository… Podman kali linux\n  开代理的话会报错：\nCould not connect to 127.0.0.1:7890 (127.0.0.1). - connect (111: Connection refused) 查看 man podman-run，添加 --http-proxy=false 解决：\n$ podman run --http-proxy=false -it docker.io/kalilinux/kali-rolling:latest /bin/bash   更换 ustc 源\n$ echo 'deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free con trib'  sources.list   metapackage\n$ apt update \u0026\u0026 apt -y install kali-linux-headless   connect to servers with nautilus ftp://ip.address.of.ftp.server smb://ip.address.of.samba.file.server nfs://ip.address.of.nfs.server kill kill 是向进程发送信号的命令。\n   代号 名称 内容     1 SIGHUP 启动被终止的程序，可让该进程重新读取自己的配置文件，类似重新启动。   2 SIGINT 相当于用键盘输入 [ctrl]-c 来中断一个程序的进行。   9 SIGKILL 代表强制中断一个程序的进行，如果该程序进行到一半，那么尚未完成的部分可能会有“半产品”产生，类似 vim会有 .filename.swp 保留下来。   15 SIGTERM 以正常的方式来终止该程序。由于是正常的终止，所以后续的动作会将他完成。不过，如果该程序已经发生问题，就是无法使用正常的方法终止时，输入这个 signal 也是没有用的。   19 SIGSTOP 相当于用键盘输入 [ctrl]-z 来暂停一个程序的进行。    Shell freezes In the event of a shell freeze (which might be caused by certain appearance tweaks, malfunctioning extensions or perhaps a lack of available memory), restarting the shell by pressing Alt+F2 and then entering r may not be possible.\nIn this case, try switching to another TTY (Ctrl+Alt+F2) and entering the following command: pkill -HUP gnome-shell. It may take a few seconds before the shell successfully restarts. On X11, restarting the shell in this fashion should not log the user out, but it is a good idea to try and ensure that all work is saved anyway; on Wayland (currently the default), restarting the shell kills the whole session, so everything will be lost.\nIf this fails, the Xorg server will need to be restarted either by pkill X for console logins or by restarting gdm.service for GDM logins. Bear in mind that restarting the Xorg server will log the user out, so try to ensure that all work is saved before attempting this.\nfix a frozen Gnome desktop session 在较旧的 Gnome（即 Gnome 3.28 之前）中，您可以使用此命令重新启动 GNome shell。\n$ glxinfo | grep display name of display: :1 display: :1 screen: 0 $ touch gnome-restart $ echo '#!/bin/bash'  gnome-restart $ echo 'DISPLAY=:1 gnome-shell --replace \u0026'  gnome-restart $ sudo chmod +x gnome-restart $ ./gnome-restart 重启 Gnome Shell 可以使用 busctl --user call org.gnome.Shell /org/gnome/Shell org.gnome.Shell Eval s 'Meta.restart(\"Restarting…\")' 命令行执行 ALT + F2 r 相同的操作。\n亦可：\n$ sudo systemctl restart systemd-logind DNF System Upgrade $ sudo dnf upgrade --refresh $ sudo reboot $ sudo dnf install dnf-plugin-system-upgrade $ sudo dnf system-upgrade download --releasever=35 $ sudo dnf system-upgrade reboot  Change the --releasever= number if you want to upgrade to a different release. If some of your packages have unsatisfied dependencies, the upgrade will refuse to continue until you run it again with an extra --allowerasing option. This often happens with packages installed from third-party repositories for which an updated repositories hasn’t been yet published. Study the output very carefully and examine which packages are going to be removed. None of them should be essential for system functionality, but some of them might be important for your productivity.  In case of unsatisfied dependencies, you can sometimes see more details if you add --best option to the command line. If you want to remove/install some packages manually before running dnf system-upgrade download again, it is advisable to perform those operations with --setopt=keepcache=1 dnf command line option. Otherwise the whole package cache will be removed after your operation, and you will need to download all the packages once again.   There are other important optional operations here, please read the official documentation.  DNF local plugin An internet search yields two common solutions that eliminate or reduce repeat downloads of the same RPM set – create a private Fedora Linux mirror or set up a caching proxy.\nFedora provides guidance on setting up a [private mirror](https://fedoraproject.org/wiki/ Infrastructure/Mirroring#How_can_someone_make_a_private_mirror). A mirror requires a lot of bandwidth and disk space and significant work to maintain. A full private mirror would be too expensive and it would be overkill for my purposes.\nThe most common solution I found online was to implement a caching proxy using Squid. I had two concerns with this type of solution. First, I would need to edit repository definitions stored in /etc/yum.repo.d on each virtual and physical machine or container to use the same mirror. Second, I would need to use http and not https connections which would introduce a security risk.\nAfter reading Glenn’s 2018 post on the DNF local plugin, I searched for additional information but could not find much of anything besides the sparse documentation for the plugin on the DNF documentation web site. This article is intended to raise awareness of this plugin.\nUse DNS over TLS dnf updateinfo First, check the updates available:\n$ dnf check-update OK, so run your first dnf updateinfo command:\n$ dnf updateinfo Look at the list of updates and which types they belong to:\n$ dnf updateinfo list The next command will list the actual changelog.\n$ dnf updateinfo info install only security and bugfixes updates\n$ dnf check-update --security --bugfix $ sudo dnf update --security --bugfix Install only specific updates\n$ sudo dnf update --advisories=FEDORA-2021-74ebf2f06f,FEDORA-2021-83fdddca0f Gaming on Fedora  Nvidia Drivers Steam(ProtonDB)/Lutris/Q4Wine Discord OBS GOverlay  i3 Spin 安装程序是 liveinst。\nQuestions Cannot open acess to console, the root account is locked… 先是添加一个 LV 到 /etc/fstab，结果开机报错，原因是写错了：\nTime out ...Dependency failed for ... 结束后就 Cannot open acess to console, the root account is locked，什么也干不了，只能强制关机。\n解决方案是重启进入 Fedora Live CD，挂载 root，修改 /etc/fstab。但是无法挂载，挂载的是 Fedora Live CD 的 root，我 TM 佛了，原因应该是这两个名一模一样，Live CD 覆盖了 root。最后是用 Ubntu Live CD 解决。\n这告诉我们，不要只有一个 Live CD。这还告诉我们，先找自己的原因才能有耐心去解决问题。\ndmesg-x86/cpu: SGX disabled by BIOS SGX技术的分析和研究\nsnd_hda_codec_hdmi hdaudioC0D2: Monitor plugged-in, Failed to power up codec ret=[-13] set Kernel parameters，要使改变在重启后仍生效，您可以手动编辑 /boot/grub/grub.cfg。对于初学者，建议编辑 /etc/default/grub 并将您的内核选项添加至 GRUB_CMDLINE_LINUX_DEFAULT 行：\nGRUB_CMDLINE_LINUX_DEFAULT=\"snd_hda_codec_hdmi.enable_silent_stream=0\" 然后重新生成 grub.cfg 文件：\n# grub2grub-mkconfig2 -o /boot/grub2/grub.cfg 为什么 Linus Torvalds 用 Fedora  2008：linus对发行版的要求是\"易安装，比较贴近上游\"即可（滚动+少折腾”）。 2010年的时候，他指出了Fedora 14的一个bug。 2011年Fedora 15换Gnome3作为默认DE了，Linus直言\"unholy mess\" ，然后转投XFCE。 2011年末，Linus提出并修补了openSUSE中Xorg的一个严重bug。 2013年5月：Linus尝试将自己手头的MacBook Air装上Linux，把几个大的发行版全部都试了一遍。发现只有Fedora能正常工作。 之后的所有消息就是各种fedora了  代理后为什么 ping 不通 问题：\n设置了http_proxy和https_proxy在.bashrc文件里，firefox可以上网了。ping外网能够解析域名，但ping不通\n解答：\n首先提一个问题，为什么我们要用代理服务器上网？\n那是因为如果不用代理服务器，我们访问的website 被blocked，最简单的方式就是在一个大型防火墙上执行： deny website IP。\n而使用代理服务器，无非是用代理服务器的IP作为目的IP，把用户的HTTP、HTTPS封装在TCP上，这样途径防火墙时，由于目的IP不在blocked IP 之列，所以被放行，这样我们就可以浏览一些被blocked 的网页。\n但是一般代理服务器并不为UDP/ICMP服务，最多为TCP服务，所以你ping website 时，代理服务器并没有介入，因为Ping是ICMP报文，那就意味着你的ping包的目的IP就是被blocked IP地址，很显然无法正常通过，全被丢了。\nFedora安装Chrome后显示“您的浏览器由所属组织管理” I finally got a chance to look into this today, and I don’t think it’s as alarming as this BZ makes it sound. Yes, Chrome (over-)states that it is “Managed by your organization”. Clicking on that links to https://support.google.com/chrome/answer/9281740 which lists the things a managed system can do. However, if you read just a few sentences further, it tells you how to view exactly which settings your administrator has enabled, which in turn has links to the descriptions of what those features are. As clearly linked there, the only settings we’ve enabled is “This browser can negotiate authentication with *.fedoraproject.org”.\nSo, I’m inclined to say that while the initial reading page might lead a user to be slightly concerned, I don’t feel that the situation is particularly dire. They can always just read content in the links.\nIn the worst case, if someone really doesn’t want to have that message appear, they can just dnf remove fedora-chromium-config.\nfedora-chromium-config\nThis package is used to install customizations for Chromium/Chrome that are recommended by Fedora, including a user-agent string identifying the system as Fedora.\nIt includes a GSSAPI configuration that enables access to many Fedora Project services. To add support for other domains, replace the symlink /etc/chromium/policies/managed/00_gssapi.json with your own content. (upstream)\ndifference between docker attach and docker exec There was a commit PR which added to the doc:\n Note: This command (attach) is not for running a new process in a container. See: docker exec.\n The answer to “Docker. How to get bash\\ssh inside runned container (run -d)?” illustrates the difference:\n (docker = 1.3) If we use docker attach, we can use only one instance of shell. So if we want to open new terminal with new instance of container’s shell, we just need to run docker exec\nif the docker container was started using /bin/bash command, you can access it using attach, if not then you need to execute the command to create a bash instance inside the container using exec.\n As mentioned in this issue:\n  Attach isn’t for running an extra thing in a container, it’s for attaching to the running process. “docker exec” is specifically for running new things in a already started container, be it a shell or some other process.   The same issue adds:\n While attach is not well named, particularly because of the LXC command lxc-attach (which is more akin docker exec  /bin/sh, but LXC specific), it does have a specific purpose of literally attaching you to the process Docker started. Depending on what the process is the behavior may be different, for instance attaching to /bin/bash will give you a shell, but attaching to redis-server will be like you’d just started redis directly without daemonizing.\n Error syncing passwords  Error: MergeDataAndStartSyncing@../../components/password_manager/core/browser/sync/password_syncable_service.cc:190, datatype error was encountered: Failed to get passwords from store.\n The problem was solved by deleting ‘Login Data’ and ‘Login Data-journal’ in the profile.\n$ rm -rf ~/.config/google-chrome/Default/Login\\ Data* The  part can be found in the Profile Path on the chrome://version page.\nCentOS Red Hat Enterprise Linux Developer Subscription Need to log in to download RHEL.\n怎样使用 Red Hat Subscription Manager (RHSM) 将系统注册到红帽客户门户网站？\n# subscription-manager register --username  --password  --auto-attach 配置 Red Hat Enterprise Linux 8 中基本系统设置的指南\nFrey’s Blog\n 所有文章 分类   关于多线程 概述 每个正在系统上运行的程序都是一个进程。每个进程包含一到N个线程。进程也可能是整个程序或者是部分程序的动态执行。线程是一组指令的集合，或者是程序的特殊段，它可以在程序里独立执行。也可以把它理解为代码运行的上下文。所以线程基本上是轻量级的进程，它负责在单个程序里执行多任务。通常由操作系统负责多个线程的调度和执行。线程是程序中一个单一的顺序控制流程。在单个程序中同时运行多个线程完成不同的工作,称为多线程。\n线程和进程的区别在于,子进程和父进程有不同的代码和数据空间,而多个线程则共享数据空间,每个线程有自己的执行堆栈和程序计数器为其执行上下文.多线程主要是为了节约CPU时间,发挥利用,根据具体情况而定. 线程的运行中需要使用计算机的内存资源和CPU。\n同步多线程（SMT）是一种在一个CPU 的时钟周期内能够执行来自多个线程的指令的硬件多线程技术。本质上，同步多线程是一种将线程级并行处理（多CPU）转化为指令级并行处理（同一CPU）的方法。 同步多线程是单个物理处理器从多个硬件线程上下文同时分派指令的能力。同步多线程用于在商用环境中及为周期/指令（CPI）计数较高的工作负载创造性能优势。 处理器采用超标量结构，最适于以并行方式读取及运行指令。同步多线程使您可在同一处理器上同时调度两个应用程序，从而利用处理器的超标量结构性质。\n超线程（HT, Hyper-Threading）是英特尔研发的一种技术，于2002年发布。通过此技术，英特尔实现在一个实体CPU中，提供两个逻辑线程。\n其实可以将SMT和HT理解为一个技术。\n Hyper-threading (officially called Hyper- ThreadingTechnology or HT Technology, and abbreviated as HTT orHT) is Intel’s proprietary simultaneous multithreading (SMT) implementation used to improve parallelization ofcomputations (doing multiple tasks at once) performed onx86 microprocessors.\n来自 https://cn.bing.com/search?q=intel+ht\u0026go=%E6%8F%90%E4%BA%A4\u0026qs=ds\u0026form=QBLHCN\n 与多进程的区别  “进程——资源分配的最小单位，线程——程序执行的最小单位”\n 实际应用中基本上都是“进程+线程”的结合方式，千万不要真的陷入一种非此即彼的误区。\n   对比维度 多进程 多线程 总结     数据共享、同步 数据共享复杂，需要用IPC；数据是分开的，同步简单 因为共享进程数据，数据共享简单，但也是因为这个原因导致同步复杂 各有优势   内存、CPU 占用内存多，切换复杂，CPU利用率低 占用内存少，切换简单，CPU利用率高 线程占优   创建销毁、切换 创建销毁、切换复杂，速度慢 创建销毁、切换简单，速度很快 线程占优   编程、调试 编程简单，调试简单 编程复杂，调试复杂 进程占优   可靠性 进程间不会互相影响 一个线程挂掉将导致整个进程挂掉 进程占优   分布式 适应于多核、多机分布式；如果一台机器不够，扩展到多台机器比较简单 适应于多核分布式 进程占优     需要注意：   1）需要频繁创建销毁的优先用线程\n2）需要进行大量计算的优先使用线程\n3）强相关的处理用线程，弱相关的处理用进程\n一般的Server需要完成如下任务：消息收发、消息处理。“消息收发”和“消息处理”就是弱相关的任务，而“消息处理”里面可能又分为“消息解码”、“业务处理”，这两个任务相对来说相关性就要强多了。因此“消息收发”和“消息处理”可以分进程设计，“消息解码”、“业务处理”可以分线程设计。当然这种划分方式不是一成不变的，也可以根据实际情况进行调整。\n4）可能要扩展到多机分布的用进程，多核分布的用线程\n5）都满足需求的情况下，用你最熟悉、最拿手的方式\n来自 https://blog.csdn.net/lishenglong666/article/details/8557215\n 如何使用？ 需要CPU、BIOS、操作系统、应用软件都支持多线程技术才可以。\n支持多线程的CPU Power CPU 支持的SMT技术：\n Simultaneous multithreading (SMT) is a processor technology that allows multiple instruction streams (threads) to run concurrently on the same physical processor, improving overall throughput. To the operating system, each hardware thread is treated as an independent logical processor. Single-threaded (ST) execution mode is also supported.\n来自 https://www.ibm.com/support/knowledgecenter/SSFHY8_6.2/reference/am5gr_f0106.html?view=embed\n Intel CPU 支持的HT技术：\n Intel® Hyper-Threading Technology (Intel® HT Technology) uses processor resources more efficiently, enabling multiple threads to run on each core. As a performance feature, it also increases processor throughput, improving overall performance on threaded software. Intel® HT Technology is available on the latest Intel® Core™ vPro™ processors, the Intel® Core™ processor family, the Intel® Core™ M processor family, and the Intel® Xeon® processor family. By combining one of these Intel® processors and chipsets with an operating system and BIOS supporting Intel® HT Technology.\n来自 https://www.intel.com/content/www/us/en/architecture-and-technology/hyper-threading/hyper-threading-technology.html\n SMT/HT支持情况  Intel CPU : 2 Thread/Core Power9 CPU： 8 Thread /Core Sparc: 8 Thread /Core  RHEL7/CentOS7 \u0026 Intel CPU BIOS 中修改SMT/HT 的设置，使用这种方式Enable或者Disable后，将永久生效，需要重启。\nHyper-Threading Technology BIOS Setup Options For Intel® Desktop/Server Boards setup option location is the main menu of the BIOS setup program. • Located on the same menu screen that already had Processor Type, Processor Speed, System Bus Speed, and other related processor fields. • Setup Option Text ○ The field is called Hyper-Threading Technology. • Setup Option Values ○ The setup option values are Enabled and Disabled. • Setup Option Help Text 来自  RHEL/CentOS操作系统中查看多线程情况：（更多信息：https://access.redhat.com/solutions/rhel-smt）\n# lscpu | grep -e Socket -e Core -e Thread Thread(s) per core: 2 # 线程数 Core(s) per socket: 6 # core 数量 Socket(s): 2 或者\n# grep -H . /sys/devices/system/cpu/cpu*/topology/thread_siblings_list | sort -n -t ':' -k 2 -u # 显示 /sys/devices/system/cpu/cpu0/topology/thread_siblings_list:0 # 表示HT关闭 # 显示 /sys/devices/system/cpu/cpu0/topology/thread_siblings_list:0-1 # 表示 HT 启用 操作系统层关闭多线程有几种办法：\n 方法一：使用nosmt启动参数，需要新的x86 CPU，需要重启  # grubby --args=nosmt --update-kernel=DEFAULT # grub2-mkconfig -o /boot/grub/grub.conf # 创建新的grub.conf # reboot #重启  方法二：临时关闭，重启后失效  # echo off  /sys/devices/system/cpu/smt/control /sys/devices/system/cpu/smt/control: This file allows to read out the SMT control state and provides the ability to disable or (re)enable SMT. The possible states are: ============== =================================================== on SMT is supported by the CPU and enabled. All logical CPUs can be onlined and offlined without restrictions. off SMT is supported by the CPU and disabled. Only the so called primary SMT threads can be onlined and offlined without restrictions. An attempt to online a non-primary sibling is rejected forceoff Same as 'off' but the state cannot be controlled. Attempts to write to the control file are rejected. notsupported The processor does not support SMT. It's therefore not affected by the SMT implications of L1TF. Attempts to write to the control file are rejected. ============== =================================================== The possible states which can be written into this file to control SMT state are: - on - off - forceoff /sys/devices/system/cpu/smt/active: This file reports whether SMT is enabled and active, i.e. if on any physical core two or more sibling threads are online. AIX \u0026 Power Power9 CPU默认支持8线程，使用smtctl命令可以查看和修改 smt级别。更多内容查看https://www.ibm.com/support/knowledgecenter/ssw_aix_72/com.ibm.aix.cmds5/smtctl.htm\n 查看 SMT level  smtctl  临时修改 SMT level, # 可以是 1, 2, 4 or 8，重启后将恢复原来的smt level  smtctl -t 2 -w now  修改 SMT level永久生效，# 可以是 1, 2, 4 or 8，完成后需要使用bosboot创建启动设备   smtctl -t 4 -w boot bosboot -a # Creates complete boot image and device. RHEL7 \u0026 Power OpenPower CPU 默认支持4线程，安装RHEL后可以使用开源的工具 ppc64_cpu进行查看和修改多线程（更多查看 https://github.com/ibm-power-utilities/powerpc-utils）。\nppc64_cpu --------- This allows users to set the smt state, smt-snooze-delay and other settings on ppc64 processors. It also allows users to control the number of processor cores which are online (not in the sleep state). 来自  1，查看 SMT level\nppc64_cpu --smt 2，修改 SMT 级别， # is 1, 2, 4 or on\nppc64_cpu --smt=# 3， 关闭 smt支持\nppc64_cpu --smt=off 其他 oracle数据库 Oracle Database 在12c之前windows平台下支持多线程，Unix和Linux只支持多进程模式。在Oracle Database 12c中，Oracle引入了多线程模式，允许在Windows平台之外的Unix、Linux系统使用多线程模式，结合多进程与多线程模式，Oracle可以改进进程管理与性能。\n通过设置初始化参数threaded_execution，可以启用或关闭多线程模式，该参数缺省值为False，设置为TRUE启用12c的这个新特性：\nSQL show parameter threaded_exec NAME TYPE VALUE --- threaded_execution boolean FALSE SQL alter system set threaded_execution=true scope=spfile; System altered. 该参数重新启动数据库后生效，但是注意，多线程模式，不支持操作系统认证，不能直接启动数据库，需要提供SYS的密码认证后方能启动数据库：\nSQL shutdown immediate; SQL startup ORA-01017: invalid username/password; logon denied # 需要通过用户名和密码登录数据库。 用ps -ef 检查一下进程/线程：\n[oracle@enmocoredb dbs]$ ps -ef|grep ora_ oracle 27404 1 0 17:00 ? 00:00:00 ora_pmon_core oracle 27406 1 0 17:00 ? 00:00:00 ora_psp0_core oracle 27408 1 3 17:00 ? 00:00:05 ora_vktm_core oracle 27412 1 0 17:00 ? 00:00:00 ora_u004_core oracle 27418 1 0 17:00 ? 00:00:00 ora_u005_core oracle 27424 1 0 17:00 ? 00:00:00 ora_dbw0_core 其中U进程是共享线程的\"容器进程\"，每个进程可以容纳100个线程。 来自 https://www.eygle.com/archives/2013/07/oracle_database_12c_multithreaded_model.html 连接热点   打开WIFI\nifconfig interface up   查看所有可用的无线网络信号\niw wlp2s0 scan | grep SSID   连接无线网\nwpa_supplicant -B -i wlp2s0 -c (wpa_passphrase \"SSID\" \"passwd\")   分配IP地址\ndhclient interface   查看无线网卡地址信息，有ip地址表示网络连接成功\nifconfig interface   PPPOE （ADSL）拨号上网   安装拨号软件\ndnf install rp-pppoe* ppp*   设定\npppoe-setup   拨号上网\npppoe-stoppppoe-start   安装中文输入法   安装 fcitx\ndnf install fcitx-im fcitx-configtool fcitx-googlepinyin   配置\n$ nano ~/.xprofile # or ~/.bashrc export GTK_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=\"@im=fcitx\"   fcitx 没图标：重装fcitx，在fcitx配置里关掉Kimpanel\n  关闭触摸板 $ dnf install xorg-x11-apps synclient TouchpadOff=1 # 关闭 synclient TouchpadOff=0 # 开启 用 MTP 挂载手机   安装jmtpfs\ndnf install jmtpfs   查看手机 “busnum”和“devnum”\njmptfs -l   建立挂载点\nmkdir /media/dir   挂载手机\njmtpfs -device=busnum,devnum /media/dir/   查找依赖 $ yum whatprovide package $ dnf provides package 默认字体 CentOS 默认字体目录 /lib/kbd/consolefonts\n纯命令行是不能使用系统之外的字体的。\nCentOS Minimal + Xfce base 源与 epel 源，使用用阿里镜像: https://developer.aliyun.com/mirror/\n  安装Xfce4，先安装 Xfce 可以保证不安装多余的包\ndnf group listdnf groupinstall Xfce   安装 X Window system\ndnf groupinstall \"X Window system\"   验证\nsystemctl isolate graphical.target   设置\n# 设置成命令模式systemctl set-default multi-user.target # 设置成图形模式systemctl set-default graphical.target    安装中文字体和中文输入法楷体字体\ndnf install cjkuni-ukai-fonts   输入法需要安装如下包：\n ibus， 这个包里有ibus-daemon这个平台服务器程序和ibus这个配置助手。 ibus-libpinyin， 这个是ibus平台下具体的拼音输入法。 im-chooser,这个是输入法平台选择助手程序。 执行im-chooser，选择输入法平台和输入法。重新登录系统。    xfce 主题\n 网站：xfce-look.org 主题目录： /usr/share/themes 或 ~/.themes 图标鼠标目录： /usr/share/icons 或 ~/.icons 壁纸： /usr/share/background , /usr/share/wallpapers Plank    EPEL EPEL的全称叫 Extra Packages for Enterprise Linux 。EPEL是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。装上了 EPEL之后，就相当于添加了一个第三方源。\n如果你知道rpmfusion.org的话，拿 rpmfusion 做比较还是很恰当的，rpmfusion 主要为桌面发行版提供大量rpm包（只有开源驱动才能进官方源，想要闭源驱动装rpmfusion），而EPEL则为服务器版本提供大量的rpm包，而且大多数rpm包在官方 repository 中是找不到的。\nLinux Deploy 准备 一个 Root 了的 Android 手机\nBusy Box：Linux Deploy 支撑软件。\nLinux deploy：Linux 系统支撑软件。\n安装 Busy Box 点击安装，等待程序自行运行，在界面中输出 ## END 后退出程序。\nLinux deploy  点击左图左上角部分，选择 设置，在设置界面中找到PATH变量，赋予其值 /system/xbin。 建议开启 锁定Wifi 功能。 接着退回主界面，点击右下角部分。 发行版 看个人喜好选择，Debian 系（Debian，Kaili，Ubuntu）较热门。 架构 默认。 源 默认。如果下的慢的话，就仿照默认的源换为国内的源，如 USTC MIRRORS，但是不要特意去换源，官方的源用的了的话官方的源最好。 安装路径 ：安装在手机自带的存储空间中，则在路径开头加上${ENV_DIR}；安装在 sdcard 中，加上${EXTERNAL_STORAGE}。 文件系统 ：推荐 ext4。 用户名 和 密码 自定义。 DNS 默认。 本地化 ：简体中文可以选择 zh_CN.UTF-8，建议选择 en_US.UTF-8 。 挂载列表：添加访问手机内容的目录，手机目录：挂载点，如 /sdcard:/mnt，之后会自动挂载。 开启SSH。 图形界面功能，需要的话就选 XFce 为桌面，XFce`是轻量级桌面环境。 退出系统设置界面，点击主界面右上角，选择安装。 等待程序自行安装Linux系统，开始时会自动创造一个4G左右大小的img文件，这个是默认的大小，你可以根据你手机的容量自定义，创造文件需要一点时间，屏幕会很安静，再然后会安装各种东西，屏幕会输出很多信息，根据你的源的速度，等待时间不等，看到  则安装完毕。如果中间没有 failed 则安装成功。安装失败的话就需要重新安装，换个快一点的网，或者好一点的源。 注意：安装完毕后要先点击停止按钮，再按启动按钮。这个很重要，不然你就得重装了。  使用   Andorid 端用 ConnectBox\n  Windows用 putty ，图形界面用 VNC Viewer。VNC Viewer 直接搜主机IP就行，VNC Server 在你选择安装图形界面功能时就自动安装了，不需要再安装 vnc4server。\n  Linux 输入ssh username@hostname就行。\n  其他   安装后如果用 vnc viewer 只有一个点的话，可以换一个发行版，我尝试的 CentOS 有这个问题。\n  Linux连的时候出现 WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!：\nssh-keygen -R + 输入服务器的IP   altarch 架构的手机 CentOS 系统换源\ncp CentOS-7-armhfp.repo CentOS-Base.repo mv CentOS-7-armhfp.repo CentOS-7-armhfp.repo.backup vi CentOS-Base.repo baseurl=https://mirrors.ustc.edu.cn/centos-altarch/7.6.1810/os/armhfp/ yum makecache yum update   如果你之前没有安装VNC的话，现在又想装：\nyum -y install tigervnc-server   ",
  "wordCount" : "24856",
  "inLanguage": "en",
  "datePublished": "2022-03-09T11:39:38+08:00",
  "dateModified": "2022-03-09T11:39:38+08:00",
  "author":{
    "@type": "Person",
    "name": "Sakamoto Kurome"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sakamotokurome.github.io/posts/fedora/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sakamoto Kurome",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sakamotokurome.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://sakamotokurome.github.io/" accesskey="h" title="Sakamoto Kurome (Alt + H)">Sakamoto Kurome</a>
            <span class="logo-switches">
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://sakamotokurome.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://sakamotokurome.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://sakamotokurome.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Fedora
    </h1>
    <div class="post-meta"><span title='2022-03-09 11:39:38 +0800 CST'>March 9, 2022</span>&nbsp;·&nbsp;50 min&nbsp;·&nbsp;Sakamoto Kurome

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#fedora" aria-label="Fedora">Fedora</a><ul>
                        
                <li>
                    <a href="#fedora-%e5%ae%9a%e5%88%b6%e7%89%88httpsspinsfedoraprojectorgzh_hans_cn" aria-label="Fedora 定制版"><a href="https://spins.fedoraproject.org/zh_Hans_CN/">Fedora 定制版</a></a></li>
                <li>
                    <a href="#selinux-%e5%88%9d%e6%8e%a2distributionsphpselinux" aria-label="SELinux 初探"><a href="/Distributions.php#selinux">SELinux 初探</a></a><ul>
                        
                <li>
                    <a href="#%e4%bb%80%e9%ba%bc%e6%98%af-selinux" aria-label="什麼是 SELinux">什麼是 SELinux</a><ul>
                        
                <li>
                    <a href="#%e7%95%b6%e5%88%9d%e8%a8%ad%e8%a8%88%e7%9a%84%e7%9b%ae%e6%a8%99%e9%81%bf%e5%85%8d%e8%b3%87%e6%ba%90%e7%9a%84%e8%aa%a4%e7%94%a8" aria-label="當初設計的目標：避免資源的誤用">當初設計的目標：避免資源的誤用</a></li>
                <li>
                    <a href="#%e5%82%b3%e7%b5%b1%e7%9a%84%e6%aa%94%e6%a1%88%e6%ac%8a%e9%99%90%e8%88%87%e5%b8%b3%e8%99%9f%e9%97%9c%e4%bf%82%e8%87%aa%e4%b8%bb%e5%bc%8f%e5%ad%98%e5%8f%96%e6%8e%a7%e5%88%b6-dac" aria-label="傳統的檔案權限與帳號關係：自主式存取控制, DAC">傳統的檔案權限與帳號關係：自主式存取控制, DAC</a></li>
                <li>
                    <a href="#%e4%bb%a5%e6%94%bf%e7%ad%96%e8%a6%8f%e5%89%87%e8%a8%82%e5%ae%9a%e7%89%b9%e5%ae%9a%e7%a8%8b%e5%ba%8f%e8%ae%80%e5%8f%96%e7%89%b9%e5%ae%9a%e6%aa%94%e6%a1%88%e5%a7%94%e4%bb%bb%e5%bc%8f%e5%ad%98%e5%8f%96%e6%8e%a7%e5%88%b6-mac" aria-label="以政策規則訂定特定程序讀取特定檔案：委任式存取控制, MAC">以政策規則訂定特定程序讀取特定檔案：委任式存取控制, MAC</a></li></ul>
                </li>
                <li>
                    <a href="#selinux-%e7%9a%84%e9%81%8b%e4%bd%9c%e6%a8%a1%e5%bc%8f" aria-label="SELinux 的運作模式">SELinux 的運作模式</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e5%85%a8%e6%80%a7%e6%9c%ac%e6%96%87-security-context" aria-label="安全性本文 (Security Context)">安全性本文 (Security Context)</a></li>
                <li>
                    <a href="#%e7%a8%8b%e5%ba%8f%e8%88%87%e6%aa%94%e6%a1%88-selinux-type-%e6%ac%84%e4%bd%8d%e7%9a%84%e7%9b%b8%e9%97%9c%e6%80%a7" aria-label="程序與檔案 SELinux type 欄位的相關性">程序與檔案 SELinux type 欄位的相關性</a></li></ul>
                </li>
                <li>
                    <a href="#selinux-%e4%b8%89%e7%a8%ae%e6%a8%a1%e5%bc%8f%e7%9a%84%e5%95%9f%e5%8b%95%e9%97%9c%e9%96%89%e8%88%87%e8%a7%80%e5%af%9f" aria-label="SELinux 三種模式的啟動、關閉與觀察">SELinux 三種模式的啟動、關閉與觀察</a><ul>
                        
                <li>
                    <a href="#selinux-%e7%9a%84%e5%95%9f%e5%8b%95%e8%88%87%e9%97%9c%e9%96%89" aria-label="SELinux 的啟動與關閉">SELinux 的啟動與關閉</a></li></ul>
                </li>
                <li>
                    <a href="#selinux-%e6%94%bf%e7%ad%96%e5%85%a7%e7%9a%84%e8%a6%8f%e5%89%87%e7%ae%a1%e7%90%86" aria-label="SELinux 政策內的規則管理">SELinux 政策內的規則管理</a></li>
                <li>
                    <a href="#selinux-%e5%ae%89%e5%85%a8%e6%9c%ac%e6%96%87%e7%9a%84%e4%bf%ae%e6%94%b9" aria-label="SELinux 安全本文的修改">SELinux 安全本文的修改</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-chcon-%e6%89%8b%e5%8b%95%e4%bf%ae%e6%94%b9%e6%aa%94%e6%a1%88%e7%9a%84-selinux-type" aria-label="使用 chcon 手動修改檔案的 SELinux type">使用 chcon 手動修改檔案的 SELinux type</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-restorecon-%e8%ae%93%e6%aa%94%e6%a1%88%e6%81%a2%e5%be%a9%e6%ad%a3%e7%a2%ba%e7%9a%84-selinux-type" aria-label="使用 restorecon 讓檔案恢復正確的 SELinux type">使用 restorecon 讓檔案恢復正確的 SELinux type</a></li>
                <li>
                    <a href="#semanage-%e9%a0%90%e8%a8%ad%e7%9b%ae%e9%8c%84%e7%9a%84%e5%ae%89%e5%85%a8%e6%80%a7%e6%9c%ac%e6%96%87%e6%9f%a5%e8%a9%a2%e8%88%87%e4%bf%ae%e6%94%b9" aria-label="semanage 預設目錄的安全性本文查詢與修改">semanage 預設目錄的安全性本文查詢與修改</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%80%e5%80%8b%e7%b6%b2%e8%b7%af%e6%9c%8d%e5%8b%99%e6%a1%88%e4%be%8b%e5%8f%8a%e7%99%bb%e9%8c%84%e6%aa%94%e5%8d%94%e5%8a%a9" aria-label="一個網路服務案例及登錄檔協助">一個網路服務案例及登錄檔協助</a></li></ul>
                </li>
                <li>
                    <a href="#tips" aria-label="Tips">Tips</a><ul>
                        
                <li>
                    <a href="#multiple-git-accountshttpstecadminnetsetup-multiple-github-accounts-on-linux" aria-label="Multiple Git Accounts"><a href="https://tecadmin.net/setup-multiple-github-accounts-on-linux/">Multiple Git Accounts</a></a></li>
                <li>
                    <a href="#gnome" aria-label="Gnome">Gnome</a></li>
                <li>
                    <a href="#fcitx5httpsfedoraprojectorgwikii18nfcitx5zh-cn" aria-label="Fcitx5"><a href="https://fedoraproject.org/wiki/I18N/Fcitx5/zh-cn">Fcitx5</a></a></li>
                <li>
                    <a href="#speed-up-dnfhttpsostechnixcomhow-to-speed-up-dnf-package-manager-in-fedora" aria-label="Speed Up DNF"><a href="https://ostechnix.com/how-to-speed-up-dnf-package-manager-in-fedora/">Speed Up DNF</a></a></li>
                <li>
                    <a href="#mirrors" aria-label="Mirrors">Mirrors</a><ul>
                        
                <li>
                    <a href="#bfsuhttpsmirrorsbfsueducnhelpfedora" aria-label="bfsu"><a href="https://mirrors.bfsu.edu.cn/help/fedora/">bfsu</a></a></li>
                <li>
                    <a href="#rpmfusion" aria-label="rpmfusion">rpmfusion</a></li>
                <li>
                    <a href="#flatpak" aria-label="flatpak">flatpak</a></li></ul>
                </li>
                <li>
                    <a href="#nvidiahttpsdocsfedoraprojectorgen-usquick-docshow-to-set-nvidia-as-primary-gpu-on-optimus-based-laptops" aria-label="Nvidia"><a href="https://docs.fedoraproject.org/en-US/quick-docs/how-to-set-nvidia-as-primary-gpu-on-optimus-based-laptops/">Nvidia</a></a></li>
                <li>
                    <a href="#zfs-on-fedora" aria-label="ZFS on Fedora">ZFS on Fedora</a></li>
                <li>
                    <a href="#managing-dnf-repositoryhttpsdocsfedoraprojectorgen-usfedora23htmlsystem_administrators_guidesec-managing_dnf_repositorieshtml" aria-label="Managing DNF Repository"><a href="https://docs.fedoraproject.org/en-US/Fedora/23/html/System_Administrators_Guide/sec-Managing_DNF_Repositories.html">Managing DNF Repository</a></a></li>
                <li>
                    <a href="#podman" aria-label="Podman">Podman</a></li>
                <li>
                    <a href="#connect-to-servers-with-nautilushttpswwwaddictivetipscomubuntu-linux-tipsconnect-to-servers-with-gnome-file-manager" aria-label="connect to servers with nautilus"><a href="https://www.addictivetips.com/ubuntu-linux-tips/connect-to-servers-with-gnome-file-manager/">connect to servers with nautilus</a></a></li>
                <li>
                    <a href="#killhttpswwwcnblogscomsparkdevp6659629html" aria-label="kill"><a href="https://www.cnblogs.com/sparkdev/p/6659629.html">kill</a></a></li>
                <li>
                    <a href="#shell-freezeshttpswikiarchlinuxorgtitlegnometroubleshootingshell_freezes" aria-label="Shell freezes"><a href="https://wiki.archlinux.org/title/GNOME/Troubleshooting#Shell_freezes">Shell freezes</a></a><ul>
                        
                <li>
                    <a href="#fix-a-frozen-gnome-desktop-sessionhttpswwwaddictivetipscomubuntu-linux-tipsfix-frozen-gnome-desktop-session" aria-label="fix a frozen Gnome desktop session"><a href="https://www.addictivetips.com/ubuntu-linux-tips/fix-frozen-gnome-desktop-session/#">fix a frozen Gnome desktop session</a></a></li>
                <li>
                    <a href="#%e9%87%8d%e5%90%af-gnome-shellhttpsbynsscomlinux705736htmlamp" aria-label="重启 Gnome Shell"><a href="https://bynss.com/linux/705736.html/amp/">重启 Gnome Shell</a></a></li></ul>
                </li>
                <li>
                    <a href="#dnf-system-upgradehttpsdocsfedoraprojectorgen-usquick-docsdnf-system-upgrade" aria-label="DNF System Upgrade"><a href="https://docs.fedoraproject.org/en-US/quick-docs/dnf-system-upgrade/">DNF System Upgrade</a></a></li>
                <li>
                    <a href="#dnf-local-pluginhttpsfedoramagazineorguse-the-dnf-local-plugin-to-speed-up-your-home-lab" aria-label="DNF local plugin"><a href="https://fedoramagazine.org/use-the-dnf-local-plugin-to-speed-up-your-home-lab/">DNF local plugin</a></a></li>
                <li>
                    <a href="#use-dns-over-tlshttpsfedoramagazineorguse-dns-over-tls" aria-label="Use DNS over TLS"><a href="https://fedoramagazine.org/use-dns-over-tls/">Use DNS over TLS</a></a></li>
                <li>
                    <a href="#dnf-updateinfohttpsfedoramagazineorguse-dnf-updateinfo-to-read-update-changelogs" aria-label="dnf updateinfo"><a href="https://fedoramagazine.org/use-dnf-updateinfo-to-read-update-changelogs/">dnf updateinfo</a></a></li>
                <li>
                    <a href="#gaming-on-fedorahttpsfedoramagazineorggaming-on-fedora" aria-label="Gaming on Fedora"><a href="https://fedoramagazine.org/gaming-on-fedora/">Gaming on Fedora</a></a></li>
                <li>
                    <a href="#i3-spin" aria-label="i3 Spin">i3 Spin</a></li></ul>
                </li>
                <li>
                    <a href="#questions" aria-label="Questions">Questions</a><ul>
                        
                <li>
                    <a href="#cannot-open-acess-to-console-the-root-account-is-locked" aria-label="Cannot open acess to console, the root account is locked&amp;hellip;">Cannot open acess to console, the root account is locked&hellip;</a></li>
                <li>
                    <a href="#dmesg-x86cpu-sgx-disabled-by-bios" aria-label="dmesg-x86/cpu: SGX disabled by BIOS">dmesg-x86/cpu: SGX disabled by BIOS</a></li>
                <li>
                    <a href="#snd_hda_codec_hdmi-hdaudioc0d2-monitor-plugged-in-failed-to-power-up-codec-ret-13httpsbbsarchlinuxorgviewtopicphpid261225" aria-label="snd_hda_codec_hdmi hdaudioC0D2: Monitor plugged-in, Failed to power up codec ret=[-13]"><a href="https://bbs.archlinux.org/viewtopic.php?id=261225">snd_hda_codec_hdmi hdaudioC0D2: Monitor plugged-in, Failed to power up codec ret=[-13]</a></a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88-linus-torvalds-%e7%94%a8-fedorahttpswwwzhihucomquestion36863290" aria-label="为什么 Linus Torvalds 用 Fedora"><a href="https://www.zhihu.com/question/36863290">为什么 Linus Torvalds 用 Fedora</a></a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%90%86%e5%90%8e%e4%b8%ba%e4%bb%80%e4%b9%88-ping-%e4%b8%8d%e9%80%9ahttpswwwzhihucomquestion20053991" aria-label="代理后为什么 ping 不通"><a href="https://www.zhihu.com/question/20053991">代理后为什么 ping 不通</a></a></li>
                <li>
                    <a href="#fedora%e5%ae%89%e8%a3%85chrome%e5%90%8e%e6%98%be%e7%a4%ba%e6%82%a8%e7%9a%84%e6%b5%8f%e8%a7%88%e5%99%a8%e7%94%b1%e6%89%80%e5%b1%9e%e7%bb%84%e7%bb%87%e7%ae%a1%e7%90%86httpsbugzillaredhatcomshow_bugcgiid1680129" aria-label="Fedora安装Chrome后显示“您的浏览器由所属组织管理”"><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1680129">Fedora安装Chrome后显示“您的浏览器由所属组织管理”</a></a></li>
                <li>
                    <a href="#difference-between-docker-attach-and-docker-exechttpsstackoverflowcoma30962120" aria-label="difference between docker attach and docker exec"><a href="https://stackoverflow.com/a/30962120">difference between docker attach and docker exec</a></a></li>
                <li>
                    <a href="#error-syncing-passwordshttpssupportgooglecomchromethread9947763error-syncing-passwordshlen" aria-label="Error syncing passwords"><a href="https://support.google.com/chrome/thread/9947763/error-syncing-passwords?hl=en">Error syncing passwords</a></a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#centos" aria-label="CentOS">CentOS</a><ul>
                        
                <li>
                    <a href="#red-hat-enterprise-linux-developer-subscriptionhttpsdevelopersredhatcomproductsrheldownload" aria-label="Red Hat Enterprise Linux Developer Subscription"><a href="https://developers.redhat.com/products/rhel/download">Red Hat Enterprise Linux Developer Subscription</a></a></li>
                <li>
                    <a href="#%e5%85%b3%e4%ba%8e%e5%a4%9a%e7%ba%bf%e7%a8%8bhttpsyangfeiffeigithubiopublic20190706multitheading-concepthtml" aria-label="关于多线程"><a href="https://yangfeiffei.github.io/public/2019/07/06/multitheading-concept.html">关于多线程</a></a><ul>
                        
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="概述">概述</a></li>
                <li>
                    <a href="#%e4%b8%8e%e5%a4%9a%e8%bf%9b%e7%a8%8b%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="与多进程的区别">与多进程的区别</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8" aria-label="如何使用？">如何使用？</a></li>
                <li>
                    <a href="#%e6%94%af%e6%8c%81%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84cpu" aria-label="支持多线程的CPU">支持多线程的<code>CPU</code></a></li>
                <li>
                    <a href="#smtht%e6%94%af%e6%8c%81%e6%83%85%e5%86%b5" aria-label="SMT/HT支持情况"><code>SMT/HT</code>支持情况</a><ul>
                        
                <li>
                    <a href="#rhel7centos7--intel-cpu" aria-label="RHEL7/CentOS7 &amp;amp; Intel CPU"><code>RHEL7/CentOS7 &amp; Intel CPU</code></a></li>
                <li>
                    <a href="#aix--power" aria-label="AIX &amp;amp; Power">AIX &amp; Power</a></li>
                <li>
                    <a href="#rhel7--power" aria-label="RHEL7 &amp;amp; Power">RHEL7 &amp; Power</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96" aria-label="其他">其他</a><ul>
                        
                <li>
                    <a href="#oracle%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="oracle数据库"><code>oracle</code>数据库</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5%e7%83%ad%e7%82%b9" aria-label="连接热点">连接热点</a></li>
                <li>
                    <a href="#pppoe-adsl%e6%8b%a8%e5%8f%b7%e4%b8%8a%e7%bd%91" aria-label="PPPOE （ADSL）拨号上网">PPPOE （ADSL）拨号上网</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e4%b8%ad%e6%96%87%e8%be%93%e5%85%a5%e6%b3%95" aria-label="安装中文输入法">安装中文输入法</a></li>
                <li>
                    <a href="#%e5%85%b3%e9%97%ad%e8%a7%a6%e6%91%b8%e6%9d%bf" aria-label="关闭触摸板">关闭触摸板</a></li>
                <li>
                    <a href="#%e7%94%a8-mtp-%e6%8c%82%e8%bd%bd%e6%89%8b%e6%9c%ba" aria-label="用 MTP 挂载手机">用 MTP 挂载手机</a></li>
                <li>
                    <a href="#%e6%9f%a5%e6%89%be%e4%be%9d%e8%b5%96" aria-label="查找依赖">查找依赖</a></li>
                <li>
                    <a href="#%e9%bb%98%e8%ae%a4%e5%ad%97%e4%bd%93" aria-label="默认字体">默认字体</a></li>
                <li>
                    <a href="#centos-minimal--xfce" aria-label="CentOS Minimal &#43; Xfce">CentOS Minimal + Xfce</a></li>
                <li>
                    <a href="#epelhttpswwwjianshucomp4f4c0897075f" aria-label="EPEL"><a href="https://www.jianshu.com/p/4f4c0897075f">EPEL</a></a></li></ul>
                </li>
                <li>
                    <a href="#linux-deploy" aria-label="Linux Deploy">Linux Deploy</a><ul>
                        
                <li>
                    <a href="#%e5%87%86%e5%a4%87" aria-label="准备">准备</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-busy-box" aria-label="安装 Busy Box">安装 Busy Box</a></li>
                <li>
                    <a href="#linux-deploy-1" aria-label="Linux deploy">Linux deploy</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8" aria-label="使用">使用</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96-1" aria-label="其他">其他</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="fedora">Fedora<a hidden class="anchor" aria-hidden="true" href="#fedora">#</a></h2>
<p><code>[fəˈdɔrə]</code> <code>费多拉</code></p>
<h3 id="fedora-定制版httpsspinsfedoraprojectorgzh_hans_cn"><a href="https://spins.fedoraproject.org/zh_Hans_CN/">Fedora 定制版</a><a hidden class="anchor" aria-hidden="true" href="#fedora-定制版httpsspinsfedoraprojectorgzh_hans_cn">#</a></h3>
<h3 id="selinux-初探distributionsphpselinux"><a href="/Distributions.php#selinux">SELinux 初探</a><a hidden class="anchor" aria-hidden="true" href="#selinux-初探distributionsphpselinux">#</a></h3>
<p>從進入了 CentOS 5.x 之後的 CentOS 版本中 (當然包括 CentOS 7)，SELinux 已經是個非常完備的核心模組了！尤其 CentOS 提供了很多管理 SELinux 的指令與機制， 因此在整體架構上面是單純且容易操作管理的！所以，在沒有自行開發網路服務軟體以及使用其他第三方協力軟體的情況下， 也就是全部使用 CentOS 官方提供的軟體來使用我們伺服器的情況下，建議大家不要關閉 SELinux 了喔！ 讓我們來仔細的玩玩這傢伙吧！</p>
<h4 id="什麼是-selinux">什麼是 SELinux<a hidden class="anchor" aria-hidden="true" href="#什麼是-selinux">#</a></h4>
<p>什麼是 SELinux 呢？其實他是『 Security Enhanced Linux 』的縮寫，字面上的意義就是安全強化的 Linux 之意！那麼所謂的『安全強化』是強化哪個部分？ 是網路資安還是權限管理？底下就讓我們來談談吧！</p>
<h5 id="當初設計的目標避免資源的誤用">當初設計的目標：避免資源的誤用<a hidden class="anchor" aria-hidden="true" href="#當初設計的目標避免資源的誤用">#</a></h5>
<p>SELinux 是由美國國家安全局 (NSA) 開發的，當初開發這玩意兒的目的是因為很多企業界發現， 通常系統出現問題的原因大部分都在於『內部員工的資源誤用』所導致的，實際由外部發動的攻擊反而沒有這麼嚴重。 那麼什麼是『員工資源誤用』呢？舉例來說，如果有個不是很懂系統的系統管理員為了自己設定的方便，將網頁所在目錄 /var/www/html/ 的權限設定為 drwxrwxrwx 時，你覺得會有什麼事情發生？</p>
<p>現在我們知道所有的系統資源都是透過程序來進行存取的，那麼 /var/www/html/ 如果設定為 777 ， 代表所有程序均可對該目錄存取，萬一你真的有啟動 WWW 伺服器軟體，那麼該軟體所觸發的程序將可以寫入該目錄， 而該程序卻是對整個 Internet 提供服務的！只要有心人接觸到這支程序，而且該程序剛好又有提供使用者進行寫入的功能， 那麼外部的人很可能就會對你的系統寫入些莫名其妙的東西！那可真是不得了！一個小小的 777 問題可是大大的！</p>
<p>為了控管這方面的權限與程序的問題，所以美國國家安全局就著手處理作業系統這方面的控管。 由於 Linux 是自由軟體，程式碼都是公開的，因此她們便使用 Linux 來作為研究的目標， 最後更將研究的結果整合到 Linux 核心裡面去，那就是 SELinux 啦！所以說， SELinux 是整合到核心的一個模組喔！ 更多的 SELinux 相關說明可以參考：</p>
<ul>
<li><a href="http://www.nsa.gov/research/selinux/">http://www.nsa.gov/research/selinux/</a></li>
</ul>
<p>這也就是說：其實 SELinux 是在進行程序、檔案等細部權限設定依據的一個核心模組！ 由於啟動網路服務的也是程序，因此剛好也能夠控制網路服務能否存取系統資源的一道關卡！ 所以，在講到 SELinux 對系統的存取控制之前，我們得先來回顧一下之前談到的系統檔案權限與使用者之間的關係。 因為先談完這個你才會知道為何需要 SELinux 的啦！</p>
<h5 id="傳統的檔案權限與帳號關係自主式存取控制-dac">傳統的檔案權限與帳號關係：自主式存取控制, DAC<a hidden class="anchor" aria-hidden="true" href="#傳統的檔案權限與帳號關係自主式存取控制-dac">#</a></h5>
<p>我們通过<a href="http://old.linux.vbird.org/linux_basic/0410accountmanager.php">Linux 帳號管理與 ACL 權限設定</a>的內容，知道系統的帳號主要分為系統管理員 (root) 與一般用戶，而這兩種身份能否使用系統上面的檔案資源則與 rwx 的權限設定有關。 不過你要注意的是，各種權限設定對 root 是無效的。因此，當某個程序想要對檔案進行存取時， 系統就會根據該程序的擁有者/群組，並比對檔案的權限，若通過權限檢查，就可以存取該檔案了。</p>
<p>這種存取檔案系統的方式被稱為『自主式存取控制 (Discretionary Access Control, DAC)』，基本上，就是依據程序的擁有者與檔案資源的 rwx 權限來決定有無存取的能力。 不過這種 DAC 的存取控制有幾個困擾，那就是：</p>
<ul>
<li>root 具有最高的權限：如果不小心某支程序被有心人士取得， 且該程序屬於 root 的權限，那麼這支程序就可以在系統上進行任何資源的存取！真是要命！</li>
<li>使用者可以取得程序來變更檔案資源的存取權限：如果你不小心將某個目錄的權限設定為 777 ，由於對任何人的權限會變成 rwx ，因此該目錄就會被任何人所任意存取！</li>
</ul>
<p>這些問題是非常嚴重的！尤其是當你的系統是被某些漫不經心的系統管理員所掌控時！他們甚至覺得目錄權限調為 777 也沒有什麼了不起的危險哩&hellip;</p>
<h5 id="以政策規則訂定特定程序讀取特定檔案委任式存取控制-mac">以政策規則訂定特定程序讀取特定檔案：委任式存取控制, MAC<a hidden class="anchor" aria-hidden="true" href="#以政策規則訂定特定程序讀取特定檔案委任式存取控制-mac">#</a></h5>
<p>現在我們知道 DAC 的困擾就是當使用者取得程序後，他可以藉由這支程序與自己預設的權限來處理他自己的檔案資源。 萬一這個使用者對 Linux 系統不熟，那就很可能會有資源誤用的問題產生。為了避免 DAC 容易發生的問題，因此 SELinux 導入了委任式存取控制 (Mandatory Access Control, MAC) 的方法！</p>
<p>委任式存取控制 (MAC) 有趣啦！他可以針對特定的程序與特定的檔案資源來進行權限的控管！ 也就是說，即使你是 root ，那麼在使用不同的程序時，你所能取得的權限並不一定是 root ， 而得要看當時該程序的設定而定。如此一來，我們針對控制的『主體』變成了『程序』而不是使用者喔！ 此外，這個主體程序也不能任意使用系統檔案資源，因為每個檔案資源也有針對該主體程序設定可取用的權限！ 如此一來，控制項目就細的多了！但整個系統程序那麼多、檔案那麼多，一項一項控制可就沒完沒了！ 所以 SELinux 也提供一些預設的政策 (Policy) ，並在該政策內提供多個規則 (rule) ，讓你可以選擇是否啟用該控制規則！</p>
<p>在委任式存取控制的設定下，我們的程序能夠活動的空間就變小了！舉例來說， WWW 伺服器軟體的達成程序為 httpd 這支程式， 而預設情況下， httpd 僅能在 /var/www/ 這個目錄底下存取檔案，如果 httpd 這個程序想要到其他目錄去存取資料時， 除了規則設定要開放外，目標目錄也得要設定成 httpd 可讀取的模式 (type) 才行喔！限制非常多！ 所以，即使不小心 httpd 被 cracker 取得了控制權，他也無權瀏覽 /etc/shadow 等重要的設定檔喔！</p>
<p>簡單的來說，針對 Apache 這個 WWW 網路服務使用 DAC 或 MAC 的結果來說，兩者間的關係可以使用下圖來說明。 底下這個圖示取自 Red Hat 訓練教材，真的是很不錯～所以被鳥哥借用來說明一下！</p>
<p><img loading="lazy" src="/Distributions/dac_mac.jpg" alt="使用 DAC/MAC 產生的不同結果，以 Apache 為例說明"  />
</p>
<p>左圖是沒有 SELinux 的 DAC 存取結果，apache 這隻 root 所主導的程序，可以在這三個目錄內作任何檔案的新建與修改～ 相當麻煩～右邊則是加上 SELinux 的 MAC 管理的結果，SELinux 僅會針對 Apache 這個『 process 』放行部份的目錄， 其他的非正規目錄就不會放行給 Apache 使用！因此不管你是誰，就是不能穿透 MAC 的框框！這樣有比較了解乎？</p>
<h4 id="selinux-的運作模式">SELinux 的運作模式<a hidden class="anchor" aria-hidden="true" href="#selinux-的運作模式">#</a></h4>
<p>再次的重複說明一下，SELinux 是透過 MAC 的方式來控管程序，他控制的主體是程序， 而目標則是該程序能否讀取的『檔案資源』！所以先來說明一下這些咚咚的相關性啦！</p>
<ul>
<li>
<p><strong>主體 (Subject)：</strong>
SELinux 主要想要管理的就是程序，因此你可以將『主體』跟本章談到的 process 劃上等號；</p>
</li>
<li>
<p><strong>目標 (Object)：</strong>
主體程序能否存取的『目標資源』一般就是檔案系統。因此這個目標項目可以等檔案系統劃上等號；</p>
</li>
<li>
<p><strong>政策 (Policy)</strong>：</p>
<p>由於程序與檔案數量龐大，因此 SELinux 會依據某些服務來制訂基本的存取安全性政策。這些政策內還會有詳細的規則 (rule) 來指定不同的服務開放某些資源的存取與否。在目前的 CentOS 7.x 裡面僅有提供三個主要的政策，分別是：</p>
<ul>
<li>targeted：針對網路服務限制較多，針對本機限制較少，是預設的政策；</li>
<li>minimum：由 target 修訂而來，僅針對選擇的程序來保護！</li>
<li>mls：完整的 SELinux 限制，限制方面較為嚴格。</li>
</ul>
<p>建議使用預設的 targeted 政策即可。</p>
</li>
<li>
<p><strong>安全性本文 (security context)：</strong>
我們剛剛談到了主體、目標與政策面，但是主體能不能存取目標除了政策指定之外，主體與目標的安全性本文必須一致才能夠順利存取。 這個安全性本文 (security context) 有點類似檔案系統的 rwx 啦！安全性本文的內容與設定是非常重要的！ 如果設定錯誤，你的某些服務(主體程序)就無法存取檔案系統(目標資源)，當然就會一直出現『權限不符』的錯誤訊息了！</p>
</li>
</ul>
<p>由於 SELinux 重點在保護程序讀取檔案系統的權限，因此我們將上述的幾個說明搭配起來，繪製成底下的流程圖，比較好理解：</p>
<p><img loading="lazy" src="/Distributions/selinux_1.gif" alt="SELinux 運作的各元件之相關性"  />
</p>
<p>上圖的重點在『主體』如何取得『目標』的資源存取權限！ 由上圖我們可以發現，(1)主體程序必須要通過 SELinux 政策內的規則放行後，就可以與目標資源進行安全性本文的比對， (2)若比對失敗則無法存取目標，若比對成功則可以開始存取目標。問題是，最終能否存取目標還是與檔案系統的 rwx 權限設定有關喔！如此一來，加入了 SELinux 之後，出現權限不符的情況時，你就得要一步一步的分析可能的問題了！</p>
<h5 id="安全性本文-security-context">安全性本文 (Security Context)<a hidden class="anchor" aria-hidden="true" href="#安全性本文-security-context">#</a></h5>
<p>CentOS 7.x 的 target 政策已經幫我們制訂好非常多的規則了，因此你只要知道如何開啟/關閉某項規則的放行與否即可。 那個安全性本文比較麻煩！因為你可能需要自行設定檔案的安全性本文呢！為何需要自行設定啊？ 舉例來說，你不也常常進行檔案的 rwx 的重新設定嗎？這個安全性本文你就將他想成 SELinux 內必備的 rwx 就是了！這樣比較好理解啦。</p>
<p>安全性本文存在於主體程序中與目標檔案資源中。程序在記憶體內，所以安全性本文可以存入是沒問題。 那檔案的安全性本文是記錄在哪裡呢？事實上，安全性本文是放置到檔案的 inode 內的，因此主體程序想要讀取目標檔案資源時，同樣需要讀取 inode ， 在 inode 內就可以比對安全性本文以及 rwx 等權限值是否正確，而給予適當的讀取權限依據。</p>
<p>那麼安全性本文到底是什麼樣的存在呢？我們先來看看 /root 底下的檔案的安全性本文好了。 觀察安全性本文可使用『 ls -Z 』去觀察如下：(注意：你必須已經啟動了 SELinux 才行！若尚未啟動，這部份請稍微看過一遍即可。底下會介紹如何啟動 SELinux 喔！)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 先來觀察一下 root 家目錄底下的『檔案的 SELinux 相關資訊』</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls -Z</span>
-rw-------. root root system_u:object_r:admin_home_t:s0     anaconda-ks.cfg
-rw-r--r--. root root system_u:object_r:admin_home_t:s0     initial-setup-ks.cfg
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 regular_express.txt
<span style="color:#75715e"># 上述特殊字體的部分，就是安全性本文的內容！鳥哥僅列出數個預設的檔案而已，</span>
<span style="color:#75715e"># 本書學習過程中所寫下的檔案則沒有列在上頭喔！</span>
</code></pre></div><p>如上所示，安全性本文主要用冒號分為三個欄位，這三個欄位的意義為：</p>
<pre tabindex="0"><code>Identify:role:type
身份識別:角色:類型
</code></pre><p>這三個欄位的意義仔細的說明一下吧：</p>
<ul>
<li>
<p>身份識別 (Identify)：</p>
<p>相當於帳號方面的身份識別！主要的身份識別常見有底下幾種常見的類型：</p>
<ul>
<li>
<p>unconfined_u：不受限的用戶，也就是說，該檔案來自於不受限的程序所產生的！一般來說，我們使用可登入帳號來取得 bash 之後， 預設的 bash 環境是不受 SELinux 管制的～因為 bash 並不是什麼特別的網路服務！因此，在這個不受 SELinux 所限制的 bash 程序所產生的檔案， 其身份識別大多就是 unconfined_u 這個『不受限』用戶囉！</p>
</li>
<li>
<p>system_u：系統用戶，大部分就是系統自己產生的檔案囉！</p>
</li>
</ul>
<p>基本上，如果是系統或軟體本身所提供的檔案，大多就是 system_u 這個身份名稱，而如果是我們用戶透過 bash 自己建立的檔案，大多則是不受限的 unconfined_u 身份～如果是網路服務所產生的檔案，或者是系統服務運作過程產生的檔案，則大部分的識別就會是 system_u 囉！</p>
<p>因為鳥哥這邊教大家使用文字界面來產生許多的資料，因此你看上面的三個檔案中，系統安裝主動產生的 anaconda-ks.cfs 及 initial-setup-ks.cfg 就會是 system_u，而我們自己從網路上面抓下來的 regular_express.txt 就會是 unconfined_u 這個識別啊！</p>
</li>
<li>
<p>角色 (Role)：</p>
<p>透過角色欄位，我們可以知道這個資料是屬於程序、檔案資源還是代表使用者。一般的角色有：</p>
<ul>
<li>
<p>object_r：代表的是檔案或目錄等檔案資源，這應該是最常見的囉；</p>
</li>
<li>
<p>system_r：代表的就是程序啦！不過，一般使用者也會被指定成為 system_r 喔！</p>
</li>
</ul>
<p>你也會發現角色的欄位最後面使用『 _r 』來結尾！因為是 role 的意思嘛！</p>
</li>
<li>
<p>類型 (Type) (最重要！)：</p>
<p>在預設的 targeted 政策中， Identify 與 Role 欄位基本上是不重要的！重要的在於這個類型 (type) 欄位！ 基本上，一個主體程序能不能讀取到這個檔案資源，與類型欄位有關！而類型欄位在檔案與程序的定義不太相同，分別是：</p>
<ul>
<li>
<p>type：在檔案資源 (Object) 上面稱為類型 (Type)；</p>
</li>
<li>
<p>domain：在主體程序 (Subject) 則稱為領域 (domain) 了！</p>
</li>
</ul>
<p>domain 需要與 type 搭配，則該程序才能夠順利的讀取檔案資源啦！</p>
</li>
</ul>
<h5 id="程序與檔案-selinux-type-欄位的相關性">程序與檔案 SELinux type 欄位的相關性<a hidden class="anchor" aria-hidden="true" href="#程序與檔案-selinux-type-欄位的相關性">#</a></h5>
<p>那麼這三個欄位如何利用呢？首先我們來瞧瞧主體程序在這三個欄位的意義為何！透過身份識別與角色欄位的定義， 我們可以約略知道某個程序所代表的意義喔！先來動手瞧一瞧目前系統中的程序在 SELinux 底下的安全本文為何？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 再來觀察一下系統『程序的 SELinux 相關資訊』</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ps -eZ</span>
LABEL                             PID TTY          TIME CMD
system_u:system_r:init_t:s0         <span style="color:#ae81ff">1</span> ?        00:00:03 systemd
system_u:system_r:kernel_t:s0       <span style="color:#ae81ff">2</span> ?        00:00:00 kthreadd
system_u:system_r:kernel_t:s0       <span style="color:#ae81ff">3</span> ?        00:00:00 ksoftirqd/0
.....<span style="color:#f92672">(</span>中間省略<span style="color:#f92672">)</span>.....
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span style="color:#ae81ff">31513</span> ? 00:00:00 sshd
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span style="color:#ae81ff">31535</span> pts/0 00:00:00 bash
<span style="color:#75715e"># 基本上程序主要就分為兩大類，一種是系統有受限的 system_u:system_r，另一種則可能是用戶自己的，</span>
<span style="color:#75715e"># 比較不受限的程序 (通常是本機用戶自己執行的程式)，亦即是 unconfined_u:unconfined_r 這兩種！</span>
</code></pre></div><p>基本上，這些對應資料在 targeted 政策下的對應如下：</p>
<table>
<thead>
<tr>
<th>身份識別</th>
<th>角色</th>
<th>該對應在 targeted 的意義</th>
</tr>
</thead>
<tbody>
<tr>
<td>unconfined_u</td>
<td>unconfined_r</td>
<td>一般可登入使用者的程序囉！比較沒有受限的程序之意！大多數都是用戶已經順利登入系統 (不論是網路還是本機登入來取得可用的 shell) 後， 所用來操作系統的程序！如 bash, X window 相關軟體等。</td>
</tr>
<tr>
<td>system_u</td>
<td>system_r</td>
<td>由於為系統帳號，因此是非交談式的系統運作程序，大多數的系統程序均是這種類型！</td>
</tr>
</tbody>
</table>
<p>但就如上所述，在預設的 target 政策下，其實最重要的欄位是類型欄位 (type)， 主體與目標之間是否具有可以讀寫的權限，與程序的 domain 及檔案的 type 有關！這兩者的關係我們可以使用 crond 以及他的設定檔來說明！ 亦即是 /usr/sbin/crond, /etc/crontab, /etc/cron.d 等檔案來說明。 首先，看看這幾個咚咚的安全性本文內容先：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 1. 先看看 crond 這個『程序』的安全本文內容：</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ps -eZ | grep cron</span>
system_u:system_r:crond_t:s0-s0:c0.c1023 <span style="color:#ae81ff">1338</span> ? 00:00:01 crond
system_u:system_r:crond_t:s0-s0:c0.c1023 <span style="color:#ae81ff">1340</span> ? 00:00:00 atd
<span style="color:#75715e"># 這個安全本文的類型名稱為 crond_t 格式！</span>

<span style="color:#75715e"># 2. 再來瞧瞧執行檔、設定檔等等的安全本文內容為何！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -Zd /usr/sbin/crond /etc/crontab /etc/cron.d</span>
drwxr-xr-x. root root system_u:object_r:system_cron_spool_t:s0 /etc/cron.d
-rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 /etc/crontab
-rwxr-xr-x. root root system_u:object_r:crond_exec_t:s0 /usr/sbin/crond
</code></pre></div><p>當我們執行 /usr/sbin/crond 之後，這個程式變成的程序的 domain 類型會是 crond_t 這一個～而這個 crond_t 能夠讀取的設定檔則為 system_cron_spool_t 這種的類型。因此不論 /etc/crontab, /etc/cron.d 以及 /var/spool/cron 都會是相關的 SELinux 類型 (/var/spool/cron 為 user_cron_spool_t)。 文字看起來不太容易了解，我們使用圖示來說明這幾個東西的關係！</p>
<p><img loading="lazy" src="/Distributions/centos7_selinux_2.jpg" alt="主體程序取得的 domain 與目標檔案資源的 type 相互關係"  />
</p>
<p>上圖的意義我們可以這樣看的：</p>
<ol>
<li>首先，我們觸發一個可執行的目標檔案，那就是具有 crond_exec_t 這個類型的 /usr/sbin/crond 檔案；</li>
<li>該檔案的類型會讓這個檔案所造成的主體程序 (Subject) 具有 crond 這個領域 (domain)， 我們的政策針對這個領域已經制定了許多規則，其中包括這個領域可以讀取的目標資源類型；</li>
<li>由於 crond domain 被設定為可以讀取 system_cron_spool_t 這個類型的目標檔案 (Object)， 因此你的設定檔放到 /etc/cron.d/ 目錄下，就能夠被 crond 那支程序所讀取了；</li>
<li>但最終能不能讀到正確的資料，還得要看 rwx 是否符合 Linux 權限的規範！</li>
</ol>
<p>上述的流程告訴我們幾個重點，第一個是政策內需要制訂詳細的 domain/type 相關性；第二個是若檔案的 type 設定錯誤， 那麼即使權限設定為 rwx 全開的 777 ，該主體程序也無法讀取目標檔案資源的啦！不過如此一來， 也就可以避免使用者將他的家目錄設定為 777 時所造成的權限困擾。</p>
<p>真的是這樣嗎？沒關係～讓我們來做個測試練習吧！就是，萬一你的 crond 設定檔的 SELinux 並不是 system_cron_spool_t 時， 該設定檔真的可以順利的被讀取運作嗎？來看看底下的範例！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 1. 先假設你因為不熟的緣故，因此是在『root 家目錄』建立一個如下的 cron 設定：</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim checktime</span>
<span style="color:#ae81ff">10</span> * * * * root sleep 60s

<span style="color:#75715e"># 2. 檢查後才發現檔案放錯目錄了，又不想要保留副本，因此使用 mv 移動到正確目錄：</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># mv checktime /etc/cron.d</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll /etc/cron.d/checktime</span>
-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">27</span> Aug  <span style="color:#ae81ff">7</span> 18:41 /etc/cron.d/checktime
<span style="color:#75715e"># 仔細看喔，權限是 644 ，確定沒有問題！任何程序都能夠讀取喔！</span>

<span style="color:#75715e"># 3. 強制重新啟動 crond ，然後偷看一下登錄檔，看看有沒有問題發生！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl restart crond</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># tail /var/log/cron</span>
Aug  <span style="color:#ae81ff">7</span> 18:46:01 study crond<span style="color:#f92672">[</span>28174<span style="color:#f92672">]</span>: <span style="color:#f92672">((</span>null<span style="color:#f92672">))</span> Unauthorized SELinux context<span style="color:#f92672">=</span>system_u:system_r:
system_cronjob_t:s0-s0:c0.c1023 file_context<span style="color:#f92672">=</span>unconfined_u:object_r:admin_home_t:s0 
<span style="color:#f92672">(</span>/etc/cron.d/checktime<span style="color:#f92672">)</span>
Aug  <span style="color:#ae81ff">7</span> 18:46:01 study crond<span style="color:#f92672">[</span>28174<span style="color:#f92672">]</span>: <span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> FAILED <span style="color:#f92672">(</span>loading cron table<span style="color:#f92672">)</span>
<span style="color:#75715e"># 上面的意思是，有錯誤！因為原本的安全本文與檔案的實際安全本文無法搭配的緣故！</span>
</code></pre></div><p>您瞧瞧～從上面的測試案例來看，我們的設定檔確實沒有辦法被 crond 這個服務所讀取喔！而原因在登錄檔內就有說明， 主要就是來自 SELinux 安全本文 (context) type 的不同所致喔！沒辦法讀就沒辦法讀，先放著～後面再來學怎麼處理這問題吧！</p>
<h4 id="selinux-三種模式的啟動關閉與觀察">SELinux 三種模式的啟動、關閉與觀察<a hidden class="anchor" aria-hidden="true" href="#selinux-三種模式的啟動關閉與觀察">#</a></h4>
<p>並非所有的 Linux distributions 都支援 SELinux 的，所以你必須要先觀察一下你的系統版本為何！ 鳥哥這裡介紹的 CentOS 7.x 本身就有支援 SELinux 啦！所以你不需要自行編譯 SELinux 到你的 Linux 核心中！ 目前 SELinux 依據啟動與否，共有三種模式，分別如下：</p>
<ul>
<li>enforcing：強制模式，代表 SELinux 運作中，且已經正確的開始限制 domain/type 了；</li>
<li>permissive：寬容模式：代表 SELinux 運作中，不過僅會有警告訊息並不會實際限制 domain/type 的存取。這種模式可以運來作為 SELinux 的 debug 之用；</li>
<li>disabled：關閉，SELinux 並沒有實際運作。</li>
</ul>
<p>我們前面不是談過主體程序需要經過政策規則、安全本文比對之後，加上 rwx 的權限規範， 若一切合理才會讓程序順利的讀取檔案嗎？那麼這個 SELinux 的三種模式與上面談到的政策規則、安全本文的關係為何呢？我們還是使用圖示加上流程來讓大家理解一下：</p>
<p><img loading="lazy" src="/Distributions/selinux_3.jpg" alt="SELinux 的三種類型與實際運作流程圖示意"  />
</p>
<p>就如上圖所示，首先，你得要知道，並不是所有的程序都會被 SELinux 所管制，因此最左邊會出現一個所謂的『有受限的程序主體』！那如何觀察有沒有受限 (confined )呢？ 很簡單啊！就透過 ps -eZ 去擷取！舉例來說，我們來找一找 crond 與 bash 這兩隻程序是否有被限制吧？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ps -eZ | grep -E &#39;cron|bash&#39;</span>
system_u:system_r:crond_t:s0-s0:c0.c1023 <span style="color:#ae81ff">1340</span> ? 00:00:00 atd
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span style="color:#ae81ff">13888</span> tty2 00:00:00 bash
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span style="color:#ae81ff">28054</span> pts/0 00:00:00 bash
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 <span style="color:#ae81ff">28094</span> pts/0 00:00:00 bash
system_u:system_r:crond_t:s0-s0:c0.c1023 <span style="color:#ae81ff">28174</span> ? 00:00:00 crond
</code></pre></div><p>如前所述，因為在目前 target 這個政策底下，只有第三個類型 (type) 欄位會有影響，因此我們上表僅列出第三個欄位的資料而已。 我們可以看到， crond 確實是有受限的主體程序，而 bash 因為是本機程序，因此就是不受限 (unconfined_t) 的類型！也就是說， bash 是不需要經過上圖的流程，而是直接去判斷 rwx 而已～。</p>
<p>了解了受限的主體程序的意義之後，再來了解一下，三種模式的運作吧！首先，如果是 Disabled 的模式，那麼 SELinux 將不會運作，當然受限的程序也不會經過 SELinux ， 也是直接去判斷 rwx 而已。那如果是寬容 (permissive) 模式呢？這種模式也是不會將主體程序抵擋 (所以箭頭是可以直接穿透的喔！)，不過萬一沒有通過政策規則，或者是安全本文的比對時， 那麼該讀寫動作將會被紀錄起來 (log)，可作為未來檢查問題的判斷依據。</p>
<p>至於最終那個 Enforcing 模式，就是實際將受限主體進入規則比對、安全本文比對的流程，若失敗，就直接抵擋主體程序的讀寫行為，並且將他記錄下來。 如果通通沒問題，這才進入到 rwx 權限的判斷喔！這樣可以理解三種模式的行為了嗎？</p>
<p>那你怎麼知道目前的 SELinux 模式呢？就透過 getenforce 吧！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># getenforce</span>
Enforcing  &lt;<span style="color:#f92672">==</span>諾！就顯示出目前的模式為 Enforcing 囉！
</code></pre></div><p>另外，我們又如何知道 SELinux 的政策 (Policy) 為何呢？這時可以使用 sestatus 來觀察：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sestatus [-vb]</span>
選項與參數：
-v  ：檢查列於 /etc/sestatus.conf 內的檔案與程序的安全性本文內容；
-b  ：將目前政策的規則布林值列出，亦即某些規則 <span style="color:#f92672">(</span>rule<span style="color:#f92672">)</span> 是否要啟動 <span style="color:#f92672">(</span>0/1<span style="color:#f92672">)</span> 之意；

範例一：列出目前的 SELinux 使用哪個政策 <span style="color:#f92672">(</span>Policy<span style="color:#f92672">)</span>？
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sestatus</span>
SELinux status:                 enabled           &lt;<span style="color:#f92672">==</span>是否啟動 SELinux
SELinuxfs mount:                /sys/fs/selinux   &lt;<span style="color:#f92672">==</span>SELinux 的相關檔案資料掛載點
SELinux root directory:         /etc/selinux      &lt;<span style="color:#f92672">==</span>SELinux 的根目錄所在
Loaded policy name:             targeted          &lt;<span style="color:#f92672">==</span>目前的政策為何？
Current mode:                   enforcing         &lt;<span style="color:#f92672">==</span>目前的模式
Mode from config file:          enforcing         &lt;<span style="color:#f92672">==</span>目前設定檔內規範的 SELinux 模式
Policy MLS status:              enabled           &lt;<span style="color:#f92672">==</span>是否含有 MLS 的模式機制
Policy deny_unknown status:     allowed           &lt;<span style="color:#f92672">==</span>是否預設抵擋未知的主體程序
Max kernel policy version:      <span style="color:#ae81ff">28</span> 
</code></pre></div><p>如上所示，目前是啟動的，而且是 Enforcing 模式，而由設定檔查詢得知亦為 Enforcing 模式。 此外，目前的預設政策為 targeted 這一個。你應該要有疑問的是， SELinux 的設定檔是哪個檔案啊？ 其實就是 /etc/selinux/config 這個檔案喔！我們來看看內容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim /etc/selinux/config</span>
SELINUX<span style="color:#f92672">=</span>enforcing     &lt;<span style="color:#f92672">==</span>調整 enforcing|disabled|permissive
SELINUXTYPE<span style="color:#f92672">=</span>targeted  &lt;<span style="color:#f92672">==</span>目前僅有 targeted, mls, minimum 三種政策
</code></pre></div><p>若有需要修改預設政策的話，就直接改 SELINUX=enforcing 那一行即可喔！</p>
<h5 id="selinux-的啟動與關閉">SELinux 的啟動與關閉<a hidden class="anchor" aria-hidden="true" href="#selinux-的啟動與關閉">#</a></h5>
<p>上面是預設的政策與啟動的模式！你要注意的是，如果改變了政策則需要重新開機；如果由 enforcing 或 permissive 改成 disabled ，或由 disabled 改成其他兩個，那也必須要重新開機。這是因為 SELinux 是整合到核心裡面去的， 你只可以在 SELinux 運作下切換成為強制 (enforcing) 或寬容 (permissive) 模式，不能夠直接關閉 SELinux 的！ 如果剛剛你發現 getenforce 出現 disabled 時，請到上述檔案修改成為 enforcing 然後重新開機吧！</p>
<p>不過你要注意的是，如果從 disable 轉到啟動 SELinux 的模式時， 由於系統必須要針對檔案寫入安全性本文的資訊，因此開機過程會花費不少時間在等待重新寫入 SELinux 安全性本文 (有時也稱為 SELinux Label) ，而且在寫完之後還得要再次的重新開機一次喔！你必須要等待粉長一段時間！ 等到下次開機成功後，再使用 <a href="/Distributions.php#getenforce">getenforce</a> 或 <a href="/Distributions.php#sestatus">sestatus</a> 來觀察看看有否成功的啟動到 Enforcing 的模式囉！</p>
<p>如果你已經在 Enforcing 的模式，但是可能由於一些設定的問題導致 SELinux 讓某些服務無法正常的運作， 此時你可以將 Enforcing 的模式改為寬容 (permissive) 的模式，讓 SELinux 只會警告無法順利連線的訊息， 而不是直接抵擋主體程序的讀取權限。讓 SELinux 模式在 enforcing 與 permissive 之間切換的方法為：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># setenforce [0|1]</span>
選項與參數：
<span style="color:#ae81ff">0</span> ：轉成 permissive 寬容模式；
<span style="color:#ae81ff">1</span> ：轉成 Enforcing 強制模式

範例一：將 SELinux 在 Enforcing 與 permissive 之間切換與觀察
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># setenforce 0</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># getenforce</span>
Permissive
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># setenforce 1</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># getenforce</span>
Enforcing
</code></pre></div><p>不過請注意， setenforce 無法在 Disabled 的模式底下進行模式的切換喔！</p>
<p>Tips：在某些特殊的情況底下，你從 Disabled 切換成 Enforcing 之後，竟然有一堆服務無法順利啟動，都會跟你說在 /lib/xxx 裡面的資料沒有權限讀取，所以啟動失敗。這大多是由於在重新寫入 SELinux type (Relabel) 出錯之故，使用 Permissive 就沒有這個錯誤。那如何處理呢？最簡單的方法就是在 Permissive 的狀態下，使用『 restorecon -Rv / 』重新還原所有 SELinux 的類型，就能夠處理這個錯誤！</p>
<h4 id="selinux-政策內的規則管理">SELinux 政策內的規則管理<a hidden class="anchor" aria-hidden="true" href="#selinux-政策內的規則管理">#</a></h4>
<p>我們知道 SELinux 的三種模式是會影響到主體程序的放行與否。 如果是進入 Enforcing 模式，那麼接著下來會影響到主體程序的，當然就是第二關：『 target 政策內的各項規則 (rules) 』了！ 好了，那麼我們怎麼知道目前這個政策裡面到底有多少會影響到主體程序的規則呢？很簡單，就透過 getsebool 來瞧一瞧即可。</p>
<ul>
<li>SELinux 各個規則的布林值查詢 getsebool</li>
</ul>
<p>如果想要查詢系統上面全部規則的啟動與否 (on/off，亦即布林值)，很簡單的透過 sestatus -b 或 getsebool -a 均可！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># getsebool [-a] [規則的名稱]</span>
選項與參數：
-a  ：列出目前系統上面的所有 SELinux 規則的布林值為開啟或關閉值

範例一：查詢本系統內所有的布林值設定狀況
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># getsebool -a</span>
abrt_anon_write --&gt; off
abrt_handle_event --&gt; off
....<span style="color:#f92672">(</span>中間省略<span style="color:#f92672">)</span>....
cron_can_relabel --&gt; off                 <span style="color:#75715e"># 這個跟 cornd 比較有關！</span>
cron_userdomain_transition --&gt; on
....<span style="color:#f92672">(</span>中間省略<span style="color:#f92672">)</span>....
httpd_enable_homedirs --&gt; off            <span style="color:#75715e"># 這當然就是跟網頁，亦即 http 有關的囉！</span>
....<span style="color:#f92672">(</span>底下省略<span style="color:#f92672">)</span>....
<span style="color:#75715e"># 這麼多的 SELinux 規則喔！每個規則後面都列出現在是允許放行還是不許放行的布林值喔！</span>
</code></pre></div><ul>
<li>SELinux 各個規則規範的主體程序能夠讀取的檔案 SELinux type 查詢 seinfo, sesearch</li>
</ul>
<p>我們現在知道有這麼多的 SELinux 規則，但是每個規則內到底是在限制什麼東西？如果你想要知道的話，那就得要使用 seinfo 等工具！ 這些工具並沒有在我們安裝時就安裝了，因此請拿出原版光碟，放到光碟機，鳥哥假設你將原版光碟掛載到 /mnt 底下，那麼接下來這麼作， 先安裝好我們所需要的軟體才行！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># yum install /mnt/Packages/setools-console-*</span>
</code></pre></div><p>很快的安裝完畢之後，我們就可以來使用 seinfo, sesearch 等指令了！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># seinfo [-trub]</span>
選項與參數：
--all ：列出 SELinux 的狀態、規則布林值、身份識別、角色、類別等所有資訊
-u    ：列出 SELinux 的所有身份識別 <span style="color:#f92672">(</span>user<span style="color:#f92672">)</span> 種類
-r    ：列出 SELinux 的所有角色 <span style="color:#f92672">(</span>role<span style="color:#f92672">)</span> 種類
-t    ：列出 SELinux 的所有類別 <span style="color:#f92672">(</span>type<span style="color:#f92672">)</span> 種類
-b    ：列出所有規則的種類 <span style="color:#f92672">(</span>布林值<span style="color:#f92672">)</span>

範例一：列出 SELinux 在此政策下的統計狀態
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># seinfo</span>
Statistics <span style="color:#66d9ef">for</span> policy file: /sys/fs/selinux/policy
Policy Version &amp; Type: v.28 <span style="color:#f92672">(</span>binary, mls<span style="color:#f92672">)</span>

   Classes:            <span style="color:#ae81ff">83</span>    Permissions:       <span style="color:#ae81ff">255</span>
   Sensitivities:       <span style="color:#ae81ff">1</span>    Categories:       <span style="color:#ae81ff">1024</span>
   Types:            <span style="color:#ae81ff">4620</span>    Attributes:        <span style="color:#ae81ff">357</span>
   Users:               <span style="color:#ae81ff">8</span>    Roles:              <span style="color:#ae81ff">14</span>
   Booleans:          <span style="color:#ae81ff">295</span>    Cond. Expr.:       <span style="color:#ae81ff">346</span>
   Allow:          <span style="color:#ae81ff">102249</span>    Neverallow:          <span style="color:#ae81ff">0</span>
   Auditallow:        <span style="color:#ae81ff">160</span>    Dontaudit:        <span style="color:#ae81ff">8413</span>
   Type_trans:      <span style="color:#ae81ff">16863</span>    Type_change:        <span style="color:#ae81ff">74</span>
   Type_member:        <span style="color:#ae81ff">35</span>    Role allow:         <span style="color:#ae81ff">30</span>
   Role_trans:        <span style="color:#ae81ff">412</span>    Range_trans:      <span style="color:#ae81ff">5439</span>
....<span style="color:#f92672">(</span>底下省略<span style="color:#f92672">)</span>....
<span style="color:#75715e"># 從上面我們可以看到這個政策是 targeted ，此政策的安全本文類別有 4620 個；</span>
<span style="color:#75715e"># 而各種 SELinux 的規則 (Booleans) 共制訂了 295 條！</span>
</code></pre></div><p>我們前面簡單的談到了幾個身份識別 (user) 以及角色 (role) 而已，如果你想要查詢目前所有的身份識別與角色，就使用『 seinfo -u 』及『 seinfo -r 』就可以知道了！至於簡單的統計資料，就直接輸入 seinfo 即可！但是上面還是沒有談到規則相關的東西耶～ 沒關係～一個一個來～我們在 16.5.1 的最後面談到 /etc/cron.d/checktime 的 SELinux type 類型不太對～那我們也知道 crond 這個程序的 type 是 crond_t ， 能不能找一下 crond_t 能夠讀取的檔案 SELinux type 有哪些呢？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sesearch [-A] [-s 主體類別] [-t 目標類別] [-b 布林值]</span>
選項與參數：
-A  ：列出後面資料中，允許『讀取或放行』的相關資料
-t  ：後面還要接類別，例如 -t httpd_t
-b  ：後面還要接SELinux的規則，例如 -b httpd_enable_ftp_server

範例一：找出 crond_t 這個主體程序能夠讀取的檔案 SELinux type
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sesearch -A -s crond_t | grep spool</span>
   allow crond_t system_cron_spool_t : file <span style="color:#f92672">{</span> ioctl read write create getattr ..
   allow crond_t system_cron_spool_t : dir <span style="color:#f92672">{</span> ioctl read getattr lock search op..
   allow crond_t user_cron_spool_t : file <span style="color:#f92672">{</span> ioctl read write create getattr se..
   allow crond_t user_cron_spool_t : dir <span style="color:#f92672">{</span> ioctl read write getattr lock add_n..
   allow crond_t user_cron_spool_t : lnk_file <span style="color:#f92672">{</span> read getattr <span style="color:#f92672">}</span> ;
<span style="color:#75715e"># allow 後面接主體程序以及檔案的 SELinux type，上面的資料是擷取出來的，</span>
<span style="color:#75715e"># 意思是說，crond_t 可以讀取 system_cron_spool_t 的檔案/目錄類型～等等！</span>

範例二：找出 crond_t 是否能夠讀取 /etc/cron.d/checktime 這個我們自訂的設定檔？
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -Z /etc/cron.d/checktime</span>
-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 /etc/cron.d/checktime
<span style="color:#75715e"># 兩個重點，一個是 SELinux type 為 admin_home_t，一個是檔案 (file)</span>

<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sesearch -A -s crond_t | grep admin_home_t</span>
   allow domain admin_home_t : dir <span style="color:#f92672">{</span> getattr search open <span style="color:#f92672">}</span> ;
   allow domain admin_home_t : lnk_file <span style="color:#f92672">{</span> read getattr <span style="color:#f92672">}</span> ;
   allow crond_t admin_home_t : dir <span style="color:#f92672">{</span> ioctl read getattr lock search open <span style="color:#f92672">}</span> ;
   allow crond_t admin_home_t : lnk_file <span style="color:#f92672">{</span> read getattr <span style="color:#f92672">}</span> ;
<span style="color:#75715e"># 仔細看！看仔細～雖然有 crond_t admin_home_t 存在，但是這是總體的資訊，</span>
<span style="color:#75715e"># 並沒有針對某些規則的尋找～所以還是不確定 checktime 能否被讀取。但是，基本上就是 SELinux</span>
<span style="color:#75715e"># type 出問題～因此才會無法讀取的！</span>
</code></pre></div><p>所以，現在我們知道 /etc/cron.d/checktime 這個我們自己複製過去的檔案會沒有辦法被讀取的原因，就是因為 SELinux type 錯誤啦！ 根本就無法被讀取～好～那現在我們來查一查，那 getsebool -a 裡面看到的 httpd_enable_homedirs 到底是什麼？又是規範了哪些主體程序能夠讀取的 SELinux type 呢？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage boolean -l | grep httpd_enable_homedirs</span>
SELinux boolean                State  Default Description
httpd_enable_homedirs          <span style="color:#f92672">(</span>off  ,  off<span style="color:#f92672">)</span>  Allow httpd to enable homedirs
<span style="color:#75715e"># httpd_enable_homedirs 的功能是允許 httpd 程序去讀取使用者家目錄的意思～</span>

<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sesearch -A -b httpd_enable_homedirs</span>
範例三：列出 httpd_enable_homedirs 這個規則當中，主體程序能夠讀取的檔案 SELinux type
Found <span style="color:#ae81ff">43</span> semantic av rules:
   allow httpd_t home_root_t : dir <span style="color:#f92672">{</span> ioctl read getattr lock search open <span style="color:#f92672">}</span> ;
   allow httpd_t home_root_t : lnk_file <span style="color:#f92672">{</span> read getattr <span style="color:#f92672">}</span> ;
   allow httpd_t user_home_type : dir <span style="color:#f92672">{</span> getattr search open <span style="color:#f92672">}</span> ;
   allow httpd_t user_home_type : lnk_file <span style="color:#f92672">{</span> read getattr <span style="color:#f92672">}</span> ;
....<span style="color:#f92672">(</span>後面省略<span style="color:#f92672">)</span>....
<span style="color:#75715e"># 從上面的資料才可以理解，在這個規則中，主要是放行 httpd_t 能否讀取使用者家目錄的檔案！</span>
<span style="color:#75715e"># 所以，如果這個規則沒有啟動，基本上， httpd_t 這種程序就無法讀取使用者家目錄下的檔案！</span>
</code></pre></div><ul>
<li>修改 SELinux 規則的布林值 setsebool</li>
</ul>
<p>那麼如果查詢到某個 SELinux rule，並且以 sesearch 知道該規則的用途後，想要關閉或啟動他，又該如何處置？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># setsebool  [-P]  『規則名稱』 [0|1]</span>
選項與參數：
-P  ：直接將設定值寫入設定檔，該設定資料未來會生效的！

範例一：查詢 httpd_enable_homedirs 這個規則的狀態，並且修改這個規則成為不同的布林值
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># getsebool httpd_enable_homedirs</span>
httpd_enable_homedirs --&gt; off  &lt;<span style="color:#f92672">==</span>結果是 off ，依題意給他啟動看看！

<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># setsebool -P httpd_enable_homedirs 1 # 會跑很久很久！請耐心等待！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># getsebool httpd_enable_homedirs</span>
httpd_enable_homedirs --&gt; on
</code></pre></div><p>這個 setsebool 最好記得一定要加上 -P 的選項！因為這樣才能將此設定寫入設定檔！ 這是非常棒的工具組！你一定要知道如何使用 getsebool 與 setsebool 才行！</p>
<h4 id="selinux-安全本文的修改">SELinux 安全本文的修改<a hidden class="anchor" aria-hidden="true" href="#selinux-安全本文的修改">#</a></h4>
<p>現在我們知道 SELinux 對受限的主體程序有沒有影響，第一關考慮 SELinux 的三種類型，第二關考慮 SELinux 的政策規則是否放行，第三關則是開始比對 SELinux type 啦！從剛剛我們也知道可以透過 sesearch 來找到主體程序與檔案的 SELinux type 關係！ 好，現在總算要來修改檔案的 SELinux type，以讓主體程序能夠讀到正確的檔案啊！這時就得要幾個重要的小東西了～來瞧瞧～</p>
<h5 id="使用-chcon-手動修改檔案的-selinux-type">使用 chcon 手動修改檔案的 SELinux type<a hidden class="anchor" aria-hidden="true" href="#使用-chcon-手動修改檔案的-selinux-type">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># chcon [-R] [-t type] [-u user] [-r role] 檔案</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># chcon [-R] --reference=範例檔 檔案</span>
選項與參數：
-R  ：連同該目錄下的次目錄也同時修改；
-t  ：後面接安全性本文的類型欄位！例如 httpd_sys_content_t ；
-u  ：後面接身份識別，例如 system_u； <span style="color:#f92672">(</span>不重要<span style="color:#f92672">)</span>
-r  ：後面接角色，例如 system_r；     <span style="color:#f92672">(</span>不重要<span style="color:#f92672">)</span>
-v  ：若有變化成功，請將變動的結果列出來
--reference<span style="color:#f92672">=</span>範例檔：拿某個檔案當範例來修改後續接的檔案的類型！

範例一：查詢一下 /etc/hosts 的 SELinux type，並將該類型套用到 /etc/cron.d/checktime 上
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -Z /etc/hosts</span>
-rw-r--r--. root root system_u:object_r:net_conf_t:s0  /etc/hosts
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># chcon -v -t net_conf_t /etc/cron.d/checktime</span>
changing security context of ‘/etc/cron.d/checktime’
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -Z /etc/cron.d/checktime</span>
-rw-r--r--. root root unconfined_u:object_r:net_conf_t:s0 /etc/cron.d/checktime

範例二：直接以 /etc/shadow SELinux type 套用到 /etc/cron.d/checktime 上！
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># chcon -v --reference=/etc/shadow /etc/cron.d/checktime</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -Z /etc/shadow /etc/cron.d/checktime</span>
-rw-r--r--. root root system_u:object_r:shadow_t:s0    /etc/cron.d/checktime
----------. root root system_u:object_r:shadow_t:s0    /etc/shadow
</code></pre></div><p>上面的練習『都沒有正確的解答！』因為正確的 SELinux type 應該就是要以 /etc/cron.d/ 底下的檔案為標準來處理才對啊～ 好了～既然如此～能不能讓 SELinux 自己解決預設目錄下的 SELinux type 呢？可以！就用 restorecon 吧！</p>
<h5 id="使用-restorecon-讓檔案恢復正確的-selinux-type">使用 restorecon 讓檔案恢復正確的 SELinux type<a hidden class="anchor" aria-hidden="true" href="#使用-restorecon-讓檔案恢復正確的-selinux-type">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># restorecon [-Rv] 檔案或目錄</span>
選項與參數：
-R  ：連同次目錄一起修改；
-v  ：將過程顯示到螢幕上

範例三：將 /etc/cron.d/ 底下的檔案通通恢復成預設的 SELinux type！
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># restorecon -Rv /etc/cron.d</span>
restorecon reset /etc/cron.d/checktime context system_u:object_r:shadow_t:s0-&gt;
system_u:object_r:system_cron_spool_t:s0
<span style="color:#75715e"># 上面這兩行其實是同一行喔！表示將 checktime 由 shadow_t 改為 system_cron_spool_t</span>

範例四：重新啟動 crond 看看有沒有正確啟動 checktime 囉！？
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl restart crond</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># tail /var/log/cron</span>
<span style="color:#75715e"># 再去瞧瞧這個 /var/log/cron 的內容，應該就沒有錯誤訊息了</span>
</code></pre></div><p>其實，鳥哥幾乎已經忘了 chcon 這個指令了！因為 restorecon 主動的回復預設的 SELinux type 要簡單很多！而且可以一口氣恢復整個目錄下的檔案！ 所以，鳥哥建議你幾乎只要記得 restorecon 搭配 -Rv 同時加上某個目錄這樣的指令串即可～修改 SELinux 的 type 就變得非常的輕鬆囉！</p>
<h5 id="semanage-預設目錄的安全性本文查詢與修改">semanage 預設目錄的安全性本文查詢與修改<a hidden class="anchor" aria-hidden="true" href="#semanage-預設目錄的安全性本文查詢與修改">#</a></h5>
<p>你應該要覺得奇怪，為什麼 restorecon 可以『恢復』原本的 SELinux type 呢？那肯定就是有個地方在紀錄每個檔案/目錄的 SELinux 預設類型囉？ 沒錯！是這樣～那要如何 (1)查詢預設的 SELinux type 以及 (2)如何增加/修改/刪除預設的 SELinux type 呢？很簡單～透過 semanage 即可！他是這樣使用的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage {login|user|port|interface|fcontext|translation} -l</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage fcontext -{a|d|m} [-frst] file_spec</span>
選項與參數：
fcontext ：主要用在安全性本文方面的用途， -l 為查詢的意思；
-a ：增加的意思，你可以增加一些目錄的預設安全性本文類型設定；
-m ：修改的意思；
-d ：刪除的意思。

範例一：查詢一下 /etc /etc/cron.d 的預設 SELinux type 為何？
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage fcontext -l | grep -E &#39;^/etc |^/etc/cron&#39;</span>
SELinux fcontext         type               Context
/etc                     all files          system_u:object_r:etc_t:s0
/etc/cron<span style="color:#ae81ff">\.</span>d<span style="color:#f92672">(</span>/.*<span style="color:#f92672">)</span>?       all files          system_u:object_r:system_cron_spool_t:s0
</code></pre></div><p>看到上面輸出的最後一行，那也是為啥我們直接使用 vim 去 /etc/cron.d 底下建立新檔案時，預設的 SELinux type 就是正確的！ 同時，我們也會知道使用 restorecon 回復正確的 SELinux type 時，系統會去判斷預設的類型為何的依據。現在讓我們來想一想， 如果 (當然是假的！不可能這麼幹) 我們要建立一個 /srv/mycron 的目錄，這個目錄預設也是需要變成 system_cron_spool_t 時， 我們應該要如何處理呢？基本上可以這樣作：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 1. 先建立 /srv/mycron 同時在內部放入設定檔，同時觀察 SELinux type</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /srv/mycron</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># cp /etc/cron.d/checktime /srv/mycron</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -dZ /srv/mycron /srv/mycron/checktime</span>
drwxr-xr-x. root root unconfined_u:object_r:var_t:s0   /srv/mycron
-rw-r--r--. root root unconfined_u:object_r:var_t:s0   /srv/mycron/checktime

<span style="color:#75715e"># 2. 觀察一下上層 /srv 的 SELinux type</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage fcontext -l | grep &#39;^/srv&#39;</span>
SELinux fcontext         type               Context
/srv                     all files          system_u:object_r:var_t:s0
<span style="color:#75715e"># 怪不得 mycron 會是 var_t 囉！</span>

<span style="color:#75715e"># 3. 將 mycron 預設值改為 system_cron_spool_t 囉！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage fcontext -a -t system_cron_spool_t &#34;/srv/mycron(/.*)?&#34;</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage fcontext -l | grep &#39;^/srv/mycron&#39;</span>
SELinux fcontext         type               Context
/srv/mycron<span style="color:#f92672">(</span>/.*<span style="color:#f92672">)</span>?        all files          system_u:object_r:system_cron_spool_t:s0

<span style="color:#75715e"># 4. 恢復 /srv/mycron 以及子目錄相關的 SELinux type 喔！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># restorecon -Rv /srv/mycron</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -dZ /srv/mycron /srv/mycron/*</span>
drwxr-xr-x. root root unconfined_u:object_r:system_cron_spool_t:s0 /srv/mycron
-rw-r--r--. root root unconfined_u:object_r:system_cron_spool_t:s0 /srv/mycron/checktime
<span style="color:#75715e"># 有了預設值，未來就不會不小心被亂改了！這樣比較妥當些～</span>
</code></pre></div><p>semanage 的功能很多，不過鳥哥主要用到的僅有 fcontext 這個項目的動作而已。如上所示， 你可以使用 semanage 來查詢所有的目錄預設值，也能夠使用他來增加預設值的設定！如果您學會這些基礎的工具， 那麼 SELinux 對你來說，也不是什麼太難的咚咚囉！</p>
<h4 id="一個網路服務案例及登錄檔協助">一個網路服務案例及登錄檔協助<a hidden class="anchor" aria-hidden="true" href="#一個網路服務案例及登錄檔協助">#</a></h4>
<p>本章在 SELinux 小節當中談到的各個指令中，尤其是 setsebool, chcon, restorecon 等，都是為了當你的某些網路服務無法正常提供相關功能時， 才需要進行修改的一些指令動作。但是，我們怎麼知道哪個時候才需要進行這些指令的修改啊？我們怎麼知道系統因為 SELinux 的問題導致網路服務不對勁啊？如果都要靠用戶端連線失敗才來哭訴，那也太沒有效率了！所以，我們的 CentOS 7.x 有提供幾支偵測的服務在登錄 SELinux 產生的錯誤喔！那就是 auditd 與 setroubleshootd。</p>
<ul>
<li>setroubleshoot &ndash;&gt; 錯誤訊息寫入 /var/log/messages</li>
</ul>
<p>幾乎所有 SELinux 相關的程式都會以 se 為開頭，這個服務也是以 se 為開頭！而 troubleshoot 大家都知道是錯誤克服，因此這個 setroubleshoot 自然就得要啟動他啦！這個服務會將關於 SELinux 的錯誤訊息與克服方法記錄到 /var/log/messages 與 /var/log/setroubleshoot/* 裡頭，所以你一定得要啟動這個服務才好。啟動這個服務之前當然就是得要安裝它啦！ 這玩意兒總共需要兩個軟體，分別是 setroublshoot 與 setroubleshoot-server，如果你沒有安裝，請自行使用 yum 安裝吧！</p>
<p>此外，原本的 SELinux 資訊本來是以兩個服務來記錄的，分別是 auditd 與 setroubleshootd。既然是同樣的資訊，因此 CentOS 6.x (含 7.x) 以後將兩者整合在 auditd 當中啦！所以，並沒有 setroubleshootd 的服務存在了喔！因此，當你安裝好了 setroubleshoot-server 之後，請記得要重新啟動 auditd，否則 setroubleshootd 的功能不會被啟動的。</p>
<p>Tips：事實上，CentOS 7.x 對 setroubleshootd 的運作方式是： (1)先由 auditd 去呼叫 audispd 服務， (2)然後 audispd 服務去啟動 sedispatch 程式， (3)sedispatch 再將原本的 auditd 訊息轉成 setroubleshootd 的訊息，進一步儲存下來的！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># rpm -qa | grep setroubleshoot</span>
setroubleshoot-plugins-3.0.59-1.el7.noarch
setroubleshoot-3.2.17-3.el7.x86_64
setroubleshoot-server-3.2.17-3.el7.x86_64
</code></pre></div><p>在預設的情況下，這個 setroubleshoot 應該都是會安裝的！是否正確安裝可以使用上述的表格指令去查詢。萬一沒有安裝，請使用 yum install 去安裝吧！ 再說一遍，安裝完畢最好重新啟動 auditd 這個服務喔！不過，剛剛裝好且順利啟動後， setroubleshoot 還是不會有作用，為啥？ 因為我們並沒有任何受限的網路服務主體程序在運作啊！所以，底下我們將使用一個簡單的 FTP 伺服器軟體為例，讓你了解到我們上頭講到的許多重點的應用！</p>
<ul>
<li>實例狀況說明：透過 vsftpd 這個 FTP 伺服器來存取系統上的檔案</li>
</ul>
<p>現在的年輕小伙子們傳資料都用 line, FB, dropbox, google 雲端磁碟等等，不過在網路早期傳送大容量的檔案，還是以 FTP 這個協定為主！ 現在為了速度，經常有 p2p 的軟體提供大容量檔案的傳輸，但以鳥哥這個老人家來說，可能 FTP 傳送資料還是比較有保障&hellip; 在 CentOS 7.x 的環境下，達成 FTP 的預設伺服器軟體主要是 vsftpd 這一支喔！</p>
<p>詳細的 FTP 協定我們在伺服器篇再來談，這裡只是簡單的利用 vsftpd 這個軟體與 FTP 的協定來講解 SELinux 的問題與錯誤克服而已。 不過既然要使用到 FTP 協定，一些簡單的知識還是得要存在才好！否則等一下我們沒有辦法了解為啥要這麼做！ 首先，你得要知道，用戶端需要使用『FTP 帳號登入 FTP 伺服器』才行！而有一個稱為『匿名 (anonymous) 』的帳號可以登入系統！ 但是這個匿名的帳號登入後，只能存取某一個特定的目錄，而無法脫離該目錄～！</p>
<p>在 vsftpd 中，一般用戶與匿名者的家目錄說明如下：</p>
<ul>
<li>匿名者：如果使用瀏覽器來連線到 FTP 伺服器的話，那預設就是使用匿名者登入系統。而匿名者的家目錄預設是在 /var/ftp 當中！ 同時，匿名者在家目錄下只能下載資料，不能上傳資料到 FTP 伺服器。同時，匿名者無法離開 FTP 伺服器的 /var/ftp 目錄喔！</li>
<li>一般 FTP 帳號：在預設的情況下，所有 UID 大於 1000 的帳號，都可以使用 FTP 來登入系統！ 而登入系統之後，所有的帳號都能夠取得自己家目錄底下的檔案資料！當然預設是可以上傳、下載檔案的！</li>
</ul>
<p>為了避免跟之前章節的用戶產生誤解的情況，這裡我們先建立一個名為 ftptest 的帳號，且帳號密碼為 myftp123， 先來建立一下吧！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># useradd -s /sbin/nologin ftptest</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;myftp123&#34; | passwd --stdin ftptest</span>
</code></pre></div><p>接下來當然就是安裝 vsftpd 這隻伺服器軟體，同時啟動這隻服務，另外，我們也希望未來開機都能夠啟動這隻服務！ 因此需要這樣做 (鳥哥假設你的 CentOS 7.x 的原版光碟已經掛載於 /mnt 了喔！)：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># yum install /mnt/Packages/vsftpd-3*</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl start vsftpd</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl enable vsftpd</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># netstat -tlnp</span>
Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
Proto Recv-Q Send-Q Local Address   Foreign Address   State   PID/Program name
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:22      0.0.0.0:*         LISTEN  1326/sshd
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:25    0.0.0.0:*         LISTEN  2349/master
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::21           :::*              LISTEN  6256/vsftpd
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22           :::*              LISTEN  1326/sshd
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> ::1:25          :::*              LISTEN  2349/master
<span style="color:#75715e"># 要注意看，上面的特殊字體那行有出現，才代表 vsftpd 這隻服務有啟動喔！！</span>
</code></pre></div><ul>
<li>匿名者無法下載的問題</li>
</ul>
<p>現在讓我們來模擬一些 FTP 的常用狀態！假設你想要將 /etc/securetty 以及主要的 /etc/sysctl.conf 放置給所有人下載， 那麼你可能會這樣做！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># cp -a /etc/securetty /etc/sysctl.conf /var/ftp/pub</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll /var/ftp/pub</span>
-rw-------. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">221</span> Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2014</span> securetty    <span style="color:#75715e"># 先假設你沒有看到這個問題！</span>
-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">225</span> Mar  <span style="color:#ae81ff">6</span> 11:05 sysctl.conf
</code></pre></div><p>一般來說，預設要給用戶下載的 FTP 檔案會放置到上面表格當中的 /var/ftp/pub 目錄喔！現在讓我們使用簡單的終端機瀏覽器 curl 來觀察看看！ 看你能不能查詢到上述兩個檔案的內容呢？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
<span style="color:#75715e"># 1. 先看看 FTP 根目錄底下有什麼檔案存在？</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://localhost</span>
drwxr-xr-x    <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>              <span style="color:#ae81ff">40</span> Aug <span style="color:#ae81ff">08</span> 00:51 pub
<span style="color:#75715e"># 確實有存在一個名為 pub 的檔案喔！那就是在 /var/ftp 底下的 pub 囉！</span>

<span style="color:#75715e"># 2. 再往下看看，能不能看到 pub 內的檔案呢？</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://localhost/pub/  # 因為是目錄，要加上 / 才好！</span>
-rw-------    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">221</span> Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2014</span> securetty
-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">225</span> Mar <span style="color:#ae81ff">06</span> 03:05 sysctl.conf

<span style="color:#75715e"># 3. 承上，繼續看一下 sysctl.conf 的內容好了！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://localhost/pub/sysctl.conf</span>
<span style="color:#75715e"># System default settings live in /usr/lib/sysctl.d/00-system.conf.</span>
<span style="color:#75715e"># To override those settings, enter new settings here, or in an /etc/sysctl.d/&lt;name&gt;.conf file</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e"># For more information, see sysctl.conf(5) and sysctl.d(5).</span>
<span style="color:#75715e"># 真的有看到這個檔案的內容喔！所以確定是可以讓 vsftpd 讀取到這檔案的！</span>

<span style="color:#75715e"># 4. 再來瞧瞧 securetty 好了！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://localhost/pub/securetty</span>
curl: <span style="color:#f92672">(</span>78<span style="color:#f92672">)</span> RETR response: <span style="color:#ae81ff">550</span>
<span style="color:#75715e"># 看不到耶！但是，基本的原因應該是權限問題喔！因為 vsftpd 預設放在 /var/ftp/pub 內的資料，</span>
<span style="color:#75715e"># 不論什麼 SELinux type 幾乎都可以被讀取的才對喔！所以要這樣處理！</span>

<span style="color:#75715e"># 5. 修訂權限之後再一次觀察 securetty 看看！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># chmod a+r /var/ftp/pub/securetty</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://localhost/pub/securetty</span>
<span style="color:#75715e"># 此時你就可以看到實際的檔案內容囉！</span>

<span style="color:#75715e"># 6. 修訂 SELinux type 的內容 (非必備)</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># restorecon -Rv /var/ftp</span>
</code></pre></div><p>上面這個例子在告訴你，要先從權限的角度來瞧一瞧，如果無法被讀取，可能就是因為沒有 r 或沒有 rx 囉！並不一定是由 SELinux 引起的！ 了解乎？好～再來瞧瞧如果是一般帳號呢？如何登入？</p>
<ul>
<li>無法從家目錄下載檔案的問題分析與解決</li>
</ul>
<p>我們前面建立了 ftptest 帳號，那如何使用文字界面來登入呢？就使用如下的方式來處理。同時請注意，因為文字型的 FTP 用戶端軟體， 預設會將用戶丟到根目錄而不是家目錄，因此，你的 URL 可能需要修訂一下如下！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 0. 為了讓 curl 這個文字瀏覽器可以傳輸資料，我們先建立一些資料在 ftptest 家目錄</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;testing&#34; &gt; ~ftptest/test.txt</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># cp -a /etc/hosts /etc/sysctl.conf ~ftptest/</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll ~ftptest/</span>
-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">158</span> Jun  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">2013</span> hosts
-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">225</span> Mar  <span style="color:#ae81ff">6</span> 11:05 sysctl.conf
-rw-r--r--. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">8</span> Aug  <span style="color:#ae81ff">9</span> 01:05 test.txt

<span style="color:#75715e"># 1. 一般帳號直接登入 FTP 伺服器，同時變換目錄到家目錄去！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://ftptest:myftp123@localhost/~/</span>
-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">158</span> Jun <span style="color:#ae81ff">07</span>  <span style="color:#ae81ff">2013</span> hosts
-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">225</span> Mar <span style="color:#ae81ff">06</span> 03:05 sysctl.conf
-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">8</span> Aug <span style="color:#ae81ff">08</span> 17:05 test.txt
<span style="color:#75715e"># 真的有資料～看檔案最左邊的權限也是沒問題，所以，來讀一下 test.txt 的內容看看</span>

<span style="color:#75715e"># 2. 開始下載 test.txt, sysctl.conf 等有權限可以閱讀的檔案看看！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://ftptest:myftp123@localhost/~/test.txt</span>
curl: <span style="color:#f92672">(</span>78<span style="color:#f92672">)</span> RETR response: <span style="color:#ae81ff">550</span>
<span style="color:#75715e"># 竟然說沒有權限！明明我們的 rwx 是正常沒問題！那是否有可能是 SELinux 造成的？</span>

<span style="color:#75715e"># 3. 先將 SELinux 從 Enforce 轉成 Permissive 看看情況！同時觀察登錄檔</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># setenforce 0</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://ftptest:myftp123@localhost/~/test.txt</span>
testing
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># setenforce 1  # 確定問題後，一定要轉成 Enforcing 啊！</span>
<span style="color:#75715e"># 確定有資料內容！所以，確定就是 SELinux 造成無法讀取的問題～那怎辦？要改規則？還是改 type？</span>
<span style="color:#75715e"># 因為都不知道，所以，就檢查一下登錄檔看看有沒有相關的資訊可以提供給我們處理！</span>

<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim /var/log/messages</span>
Aug  <span style="color:#ae81ff">9</span> 02:55:58 station3-39 setroubleshoot: SELinux is preventing /usr/sbin/vsftpd 
 from lock access on the file /home/ftptest/test.txt. For complete SELinux messages. 
 run sealert -l 3a57aad3-a128-461b-966a-5bb2b0ffa0f9
Aug  <span style="color:#ae81ff">9</span> 02:55:58 station3-39 python: SELinux is preventing /usr/sbin/vsftpd from 
 lock access on the file /home/ftptest/test.txt.

*****  Plugin catchall_boolean <span style="color:#f92672">(</span>47.5 confidence<span style="color:#f92672">)</span> suggests   ******************

If you want to allow ftp to home dir
Then you must tell SELinux about this by enabling the <span style="color:#e6db74">&#39;ftp_home_dir&#39;</span> boolean.
You can read <span style="color:#e6db74">&#39;None&#39;</span> man page <span style="color:#66d9ef">for</span> more details.
Do
setsebool -P ftp_home_dir <span style="color:#ae81ff">1</span>

*****  Plugin catchall_boolean <span style="color:#f92672">(</span>47.5 confidence<span style="color:#f92672">)</span> suggests   ******************

If you want to allow ftpd to full access
Then you must tell SELinux about this by enabling the <span style="color:#e6db74">&#39;ftpd_full_access&#39;</span> boolean.
You can read <span style="color:#e6db74">&#39;None&#39;</span> man page <span style="color:#66d9ef">for</span> more details.
Do
setsebool -P ftpd_full_access <span style="color:#ae81ff">1</span>

*****  Plugin catchall <span style="color:#f92672">(</span>6.38 confidence<span style="color:#f92672">)</span> suggests   **************************
.....<span style="color:#f92672">(</span>底下省略<span style="color:#f92672">)</span>.....
<span style="color:#75715e"># 基本上，你會看到有個特殊字體的部份，就是 sealert 那一行。雖然底下已經列出可能的解決方案了，</span>
<span style="color:#75715e"># 就是一堆底線那些東西。至少就有三個解決方案 (最後一個沒列出來)，哪種才是正確的？</span>
<span style="color:#75715e"># 為了了解正確的解決方案，我們還是還執行一下 sealert 那行吧！看看情況再說！</span>

<span style="color:#75715e"># 4. 透過 sealert 的解決方案來處理問題</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sealert -l 3a57aad3-a128-461b-966a-5bb2b0ffa0f9</span>
SELinux is preventing /usr/sbin/vsftpd from lock access on the file /home/ftptest/test.txt.

<span style="color:#75715e"># 底下說有 47.5% 的機率是由於這個原因所發生，並且可以使用 setsebool 去解決的意思！</span>
*****  Plugin catchall_boolean <span style="color:#f92672">(</span>47.5 confidence<span style="color:#f92672">)</span> suggests   ******************

If you want to allow ftp to home dir
Then you must tell SELinux about this by enabling the <span style="color:#e6db74">&#39;ftp_home_dir&#39;</span> boolean.
You can read <span style="color:#e6db74">&#39;None&#39;</span> man page <span style="color:#66d9ef">for</span> more details.
Do
setsebool -P ftp_home_dir <span style="color:#ae81ff">1</span>

<span style="color:#75715e"># 底下說也是有 47.5% 的機率是由此產生的！</span>
*****  Plugin catchall_boolean <span style="color:#f92672">(</span>47.5 confidence<span style="color:#f92672">)</span> suggests   ******************

If you want to allow ftpd to full access
Then you must tell SELinux about this by enabling the <span style="color:#e6db74">&#39;ftpd_full_access&#39;</span> boolean.
You can read <span style="color:#e6db74">&#39;None&#39;</span> man page <span style="color:#66d9ef">for</span> more details.
Do
setsebool -P ftpd_full_access <span style="color:#ae81ff">1</span>

<span style="color:#75715e"># 底下說，僅有 6.38% 的可信度是由這個情況產生的！</span>
*****  Plugin catchall <span style="color:#f92672">(</span>6.38 confidence<span style="color:#f92672">)</span> suggests   **************************

If you believe that vsftpd should be allowed lock access on the test.txt file by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access <span style="color:#66d9ef">for</span> now by executing:
<span style="color:#75715e"># grep vsftpd /var/log/audit/audit.log | audit2allow -M mypol</span>
<span style="color:#75715e"># semodule -i mypol.pp</span>

<span style="color:#75715e"># 底下就重要了！是整個問題發生的主因～最好還是稍微瞧一瞧！</span>
Additional Information:
Source Context                system_u:system_r:ftpd_t:s0-s0:c0.c1023
Target Context                unconfined_u:object_r:user_home_t:s0
Target Objects                /home/ftptest/test.txt <span style="color:#f92672">[</span> file <span style="color:#f92672">]</span>
Source                        vsftpd
Source Path                   /usr/sbin/vsftpd
Port                          &lt;Unknown&gt;
Host                          station3-39.gocloud.vm
Source RPM Packages           vsftpd-3.0.2-9.el7.x86_64
Target RPM Packages
Policy RPM                    selinux-policy-3.13.1-23.el7.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Permissive
Host Name                     station3-39.gocloud.vm
Platform                      Linux station3-39.gocloud.vm 3.10.0-229.el7.x86_64
                              <span style="color:#75715e">#1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64</span>
Alert Count                   <span style="color:#ae81ff">3</span>
First Seen                    2015-08-09 01:00:12 CST
Last Seen                     2015-08-09 02:55:57 CST
Local ID                      3a57aad3-a128-461b-966a-5bb2b0ffa0f9

Raw Audit Messages
type<span style="color:#f92672">=</span>AVC msg<span style="color:#f92672">=</span>audit<span style="color:#f92672">(</span>1439060157.358:635<span style="color:#f92672">)</span>: avc:  denied  <span style="color:#f92672">{</span> lock <span style="color:#f92672">}</span> <span style="color:#66d9ef">for</span>  pid<span style="color:#f92672">=</span><span style="color:#ae81ff">5029</span> comm<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;vsftpd&#34;</span> 
 path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/home/ftptest/test.txt&#34;</span> dev<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dm-2&#34;</span> ino<span style="color:#f92672">=</span><span style="color:#ae81ff">141</span> scontext<span style="color:#f92672">=</span>system_u:system_r:ftpd_t:s0-s0:
 c0.c1023 tcontext<span style="color:#f92672">=</span>unconfined_u:object_r:user_home_t:s0 tclass<span style="color:#f92672">=</span>file

type<span style="color:#f92672">=</span>SYSCALL msg<span style="color:#f92672">=</span>audit<span style="color:#f92672">(</span>1439060157.358:635<span style="color:#f92672">)</span>: arch<span style="color:#f92672">=</span>x86_64 syscall<span style="color:#f92672">=</span>fcntl success<span style="color:#f92672">=</span>yes exit<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> 
 a0<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span> a1<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> a2<span style="color:#f92672">=</span>7fffceb8cbb0 a3<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> items<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ppid<span style="color:#f92672">=</span><span style="color:#ae81ff">5024</span> pid<span style="color:#f92672">=</span><span style="color:#ae81ff">5029</span> auid<span style="color:#f92672">=</span><span style="color:#ae81ff">4294967295</span> uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> gid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span>
 euid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> suid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> fsuid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> egid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> sgid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> fsgid<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> tty<span style="color:#f92672">=(</span>none<span style="color:#f92672">)</span> ses<span style="color:#f92672">=</span><span style="color:#ae81ff">4294967295</span>
 comm<span style="color:#f92672">=</span>vsftpd exe<span style="color:#f92672">=</span>/usr/sbin/vsftpd subj<span style="color:#f92672">=</span>system_u:system_r:ftpd_t:s0-s0:c0.c1023 key<span style="color:#f92672">=(</span>null<span style="color:#f92672">)</span>

Hash: vsftpd,ftpd_t,user_home_t,file,lock
</code></pre></div><p>經過上面的測試，現在我們知道主要的問題發生在 SELinux 的 type 不是 vsftpd_t 所能讀取的原因～ 經過仔細觀察 test.txt 檔案的類型，我們知道他原本就是家目錄，因此是 user_home_t 也沒啥了不起的啊！是正確的～ 因此，分析兩個比較可信 (47.5%) 的解決方案後，可能是與 ftp_home_dir 比較有關啊！所以，我們應該不需要修改 SELinux type， 修改的應該是 SELinux rules 才對！所以，這樣做看看：</p>
<pre tabindex="0"><code># 1. 先確認一下 SELinux 的模式，然後再瞧一瞧能否下載 test.txt，最終使用處理方式來解決～
[root@study ~]# getenforce
Enforcing
[root@study ~]# curl ftp://ftptest:myftp123@localhost/~/test.txt
curl: (78) RETR response: 550
# 確定還是無法讀取的喔！
[root@study ~]# setsebool -P ftp_home_dir 1
[root@study ~]# curl ftp://ftptest:myftp123@localhost/~/test.txt
testing
# OK！太讚了！處理完畢！現在使用者可以在自己的家目錄上傳/下載檔案了！

# 2. 開始下載其他檔案試看看囉！
[root@study ~]# curl ftp://ftptest:myftp123@localhost/~/sysctl.conf
# System default settings live in /usr/lib/sysctl.d/00-system.conf.
# To override those settings, enter new settings here, or in an /etc/sysctl.d/&lt;name&gt;.conf file
#
# For more information, see sysctl.conf(5) and sysctl.d(5).
</code></pre><p>沒問題喔！透過修改 SELinux rule 的布林值，現在我們就可以使用一般帳號在 FTP 服務來上傳/下載資料囉！非常愉快吧！ 那萬一我們還有其他的目錄也想要透過 FTP 來提供這個 ftptest 用戶上傳與下載呢？往下瞧瞧～</p>
<ul>
<li>一般帳號用戶從非正規目錄上傳/下載檔案</li>
</ul>
<p>假設我們還想要提供 /srv/gogogo 這個目錄給 ftptest 用戶使用，那又該如何處理呢？假設我們都沒有考慮 SELinux ， 那就是這樣的情況：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 1. 先處理好所需要的目錄資料</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /srv/gogogo</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># chgrp ftptest /srv/gogogo</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;test&#34; &gt; /srv/gogogo/test.txt</span>

<span style="color:#75715e"># 2. 開始直接使用 ftp 觀察一下資料！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt</span>
curl: <span style="color:#f92672">(</span>78<span style="color:#f92672">)</span> RETR response: <span style="color:#ae81ff">550</span>
<span style="color:#75715e"># 有問題喔！來瞧瞧登錄檔怎麼說！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># grep sealert /var/log/messages | tail</span>
Aug  <span style="color:#ae81ff">9</span> 04:23:12 station3-39 setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from
 read access on the file test.txt. For complete SELinux messages. run sealert -l
 08d3c0a2-5160-49ab-b199-47a51a5fc8dd
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sealert -l 08d3c0a2-5160-49ab-b199-47a51a5fc8dd</span>
SELinux is preventing /usr/sbin/vsftpd from read access on the file test.txt.

<span style="color:#75715e"># 雖然這個可信度比較高～不過，因為會全部放行 FTP ，所以不太考慮！</span>
*****  Plugin catchall_boolean <span style="color:#f92672">(</span>57.6 confidence<span style="color:#f92672">)</span> suggests   ******************

If you want to allow ftpd to full access
Then you must tell SELinux about this by enabling the <span style="color:#e6db74">&#39;ftpd_full_access&#39;</span> boolean.
You can read <span style="color:#e6db74">&#39;None&#39;</span> man page <span style="color:#66d9ef">for</span> more details.
Do
setsebool -P ftpd_full_access <span style="color:#ae81ff">1</span>

<span style="color:#75715e"># 因為是非正規目錄的使用，所以這邊加上預設 SELinux type 恐怕會是比較正確的選擇！</span>
*****  Plugin catchall_labels <span style="color:#f92672">(</span>36.2 confidence<span style="color:#f92672">)</span> suggests   *******************

If you want to allow vsftpd to have read access on the test.txt file
Then you need to change the label on test.txt
Do
<span style="color:#75715e"># semanage fcontext -a -t FILE_TYPE &#39;test.txt&#39;</span>
where FILE_TYPE is one of the following: NetworkManager_tmp_t, abrt_helper_exec_t, abrt_tmp_t,
 abrt_upload_watch_tmp_t, abrt_var_cache_t, abrt_var_run_t, admin_crontab_tmp_t, afs_cache_t,
 alsa_home_t, alsa_tmp_t, amanda_tmp_t, antivirus_home_t, antivirus_tmp_t, apcupsd_tmp_t, ...
Then execute:
restorecon -v <span style="color:#e6db74">&#39;test.txt&#39;</span>

*****  Plugin catchall <span style="color:#f92672">(</span>7.64 confidence<span style="color:#f92672">)</span> suggests   **************************

If you believe that vsftpd should be allowed read access on the test.txt file by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access <span style="color:#66d9ef">for</span> now by executing:
<span style="color:#75715e"># grep vsftpd /var/log/audit/audit.log | audit2allow -M mypol</span>
<span style="color:#75715e"># semodule -i mypol.pp</span>

Additional Information:
Source Context                system_u:system_r:ftpd_t:s0-s0:c0.c1023
Target Context                unconfined_u:object_r:var_t:s0
Target Objects                test.txt <span style="color:#f92672">[</span> file <span style="color:#f92672">]</span>
Source                        vsftpd
.....<span style="color:#f92672">(</span>底下省略<span style="color:#f92672">)</span>.....
</code></pre></div><p>因為是非正規目錄啊，所以感覺上似乎與 semanage 那一行的解決方案比較相關～接下來就是要找到 FTP 的 SELinux type 來解決囉！ 所以，讓我們查一下 FTP 相關的資料囉！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 3. 先查看一下 /var/ftp 這個地方的 SELinux type 吧！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll -Zd /var/ftp</span>
drwxr-xr-x. root root system_u:object_r:public_content_t:s0 /var/ftp

<span style="color:#75715e"># 4. 以 sealert 建議的方法來處理好 SELinux type 囉！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage fcontext -a -t public_content_t &#34;/srv/gogogo(/.*)?&#34;</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># restorecon -Rv /srv/gogogo</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://ftptest:myftp123@localhost//srv/gogogo/test.txt</span>
test
<span style="color:#75715e"># 喔耶！終於再次搞定喔！</span>
</code></pre></div><p>在這個範例中，我們是修改了 SELinux type 喔！與前一個修改 SELinux rule 不太一樣！要理解理解喔！</p>
<ul>
<li>無法變更 FTP 連線埠口問題分析與解決</li>
</ul>
<p>在某些情況下，可能你的伺服器軟體需要開放在非正規的埠口，舉例來說，如果因為某些政策問題，導致 FTP 啟動的正常的 21 號埠口無法使用， 因此你想要啟用在 555 號埠口時，該如何處理呢？基本上，既然 SELinux 的主體程序大多是被受限的網路服務，沒道理不限制放行的埠口啊！ 所以，很可能會出問題～那就得要想想辦法才行！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 1. 先處理 vsftpd 的設定檔，加入換 port 的參數才行！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim /etc/vsftpd/vsftpd.conf</span>
<span style="color:#75715e"># 請按下大寫的 G 跑到最後一行，然後新增加底下這行設定！前面不可以留白！</span>
listen_port<span style="color:#f92672">=</span><span style="color:#ae81ff">555</span>

<span style="color:#75715e"># 2. 重新啟動 vsftpd 並且觀察登錄檔的變化！</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl restart vsftpd</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># grep sealert /var/log/messages</span>
Aug  <span style="color:#ae81ff">9</span> 06:34:46 station3-39 setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from
 name_bind access on the tcp_socket port 555. For complete SELinux messages. run
 sealert -l 288118e7-c386-4086-9fed-2fe78865c704

<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># sealert -l 288118e7-c386-4086-9fed-2fe78865c704</span>
SELinux is preventing /usr/sbin/vsftpd from name_bind access on the tcp_socket port 555.

*****  Plugin bind_ports <span style="color:#f92672">(</span>92.2 confidence<span style="color:#f92672">)</span> suggests   ************************

If you want to allow /usr/sbin/vsftpd to bind to network port <span style="color:#ae81ff">555</span>
Then you need to modify the port type.
Do
<span style="color:#75715e"># semanage port -a -t PORT_TYPE -p tcp 555</span>
    where PORT_TYPE is one of the following: certmaster_port_t, cluster_port_t,
 ephemeral_port_t, ftp_data_port_t, ftp_port_t, hadoop_datanode_port_t, hplip_port_t,
 port_t, postgrey_port_t, unreserved_port_t.
.....<span style="color:#f92672">(</span>後面省略<span style="color:#f92672">)</span>.....
<span style="color:#75715e"># 看一下信任度，高達 92.2% 耶！幾乎就是這傢伙～因此不必再看～就是他了！比較重要的是，</span>
<span style="color:#75715e"># 解決方案裡面，那個 PORT_TYPE 有很多選擇～但我們是要開啟 FTP 埠口嘛！所以，</span>
<span style="color:#75715e"># 就由後續資料找到 ftp_port_t 那個項目囉！帶入實驗看看！</span>

<span style="color:#75715e"># 3. 實際帶入 SELinux 埠口修訂後，在重新啟動 vsftpd 看看</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># semanage port -a -t ftp_port_t -p tcp 555</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl restart vsftpd</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># netstat -tlnp</span>
Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
Proto Recv-Q Send-Q Local Address    Foreign Address   State    PID/Program name
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:22       0.0.0.0:*         LISTEN   1167/sshd
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:25     0.0.0.0:*         LISTEN   1598/master
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::555           :::*              LISTEN   8436/vsftpd
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22            :::*              LISTEN   1167/sshd
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> ::1:25           :::*              LISTEN   1598/master

<span style="color:#75715e"># 4. 實驗看看這個 port 能不能用？</span>
<span style="color:#f92672">[</span>root@study ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl ftp://localhost:555/pub/</span>
-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">221</span> Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2014</span> securetty
-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">225</span> Mar <span style="color:#ae81ff">06</span> 03:05 sysctl.conf
</code></pre></div><p>透過上面的幾個小練習，你會知道在正規或非正規的環境下，如何處理你的 SELinux 問題哩！仔細研究看看囉！</p>
<h3 id="tips">Tips<a hidden class="anchor" aria-hidden="true" href="#tips">#</a></h3>
<h4 id="multiple-git-accountshttpstecadminnetsetup-multiple-github-accounts-on-linux"><a href="https://tecadmin.net/setup-multiple-github-accounts-on-linux/">Multiple Git Accounts</a><a hidden class="anchor" aria-hidden="true" href="#multiple-git-accountshttpstecadminnetsetup-multiple-github-accounts-on-linux">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh-keygen -t rsa -C <span style="color:#e6db74">&#34;your-email&#34;</span> 
$ nano ~/.ssh/config 
Host github-proj1
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_rsa_github_proj1
  AddKeysToAgent yes
 
Host github-proj2
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_rsa_github_proj2
  AddKeysToAgent yes
 
Host aws-codecommit-proj3
  Hostname git-codecommit.us-east-2.amazonaws.com
  User TECADMIN0123456789
  IdentityFile ~/.ssh/id_rsa_aws_codecommit_proj3
  AddKeysToAgent yes
$ git clone ssh://github-proj1/user1/repo.git 
$ git clone ssh://github-proj2/user2/repo.git 
$ git clone ssh://aws-codecommit-proj3/v1/repos/myrepo 
</code></pre></div><h4 id="gnome">Gnome<a hidden class="anchor" aria-hidden="true" href="#gnome">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf install gnome-tweaks gnome-extensions-app
</code></pre></div><p>gnome-tweaks 里面可以管理 startup apps。</p>
<p>gnome-extensions-app 管理 extensions。</p>
<ul>
<li><a href="https://extensions.gnome.org/extension/4236/blur-me/">Blur Me</a></li>
<li>gnome-shell-extension-appindicator</li>
<li>gnome-shell-extension-caffeine</li>
<li>gnome-shell-extension-freon</li>
</ul>
<h4 id="fcitx5httpsfedoraprojectorgwikii18nfcitx5zh-cn"><a href="https://fedoraproject.org/wiki/I18N/Fcitx5/zh-cn">Fcitx5</a><a hidden class="anchor" aria-hidden="true" href="#fcitx5httpsfedoraprojectorgwikii18nfcitx5zh-cn">#</a></h4>
<p><a href="https://yanqiyu.info/2020/11/06/fcitx5-fedora-updated/"><strong>安装</strong></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf install fcitx5 fcitx5-chinese-addons fcitx5-gtk fcitx5-qt fcitx5-configtool fcitx5-autostart
$ rpm -ql fcitx5-autostart
/etc/profile.d/fcitx5.sh
/etc/xdg/autostart/org.fcitx.Fcitx5.desktop
$ cat /etc/profile.d/fcitx5.sh 
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! <span style="color:#e6db74">&#34;</span>$XDG_SESSION_TYPE<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tty&#34;</span> <span style="color:#f92672">]</span>   <span style="color:#75715e"># if this is a gui session (not tty)</span>
<span style="color:#66d9ef">then</span>
    <span style="color:#75715e"># let&#39;s use fcitx instead of fcitx5 to make flatpak happy</span>
    <span style="color:#75715e"># this may break behavior for users who have installed both</span>
    <span style="color:#75715e"># fcitx and fcitx5, let then change the file on their own</span>
    export INPUT_METHOD<span style="color:#f92672">=</span>fcitx
    export GTK_IM_MODULE<span style="color:#f92672">=</span>fcitx
    export QT_IM_MODULE<span style="color:#f92672">=</span>fcitx
    export XMODIFIERS<span style="color:#f92672">=</span>@im<span style="color:#f92672">=</span>fcitx
<span style="color:#66d9ef">fi</span>
$ cat /etc/xdg/autostart/org.fcitx.Fcitx5.desktop
<span style="color:#f92672">[</span>Desktop Entry<span style="color:#f92672">]</span>
Name<span style="color:#f92672">[</span>ca<span style="color:#f92672">]=</span>Fcitx <span style="color:#ae81ff">5</span>
Name<span style="color:#f92672">[</span>da<span style="color:#f92672">]=</span>Fcitx <span style="color:#ae81ff">5</span>
Name<span style="color:#f92672">[</span>de<span style="color:#f92672">]=</span>Fcitx <span style="color:#ae81ff">5</span>
Name<span style="color:#f92672">[</span>ja<span style="color:#f92672">]=</span>Fcitx <span style="color:#ae81ff">5</span>
Name<span style="color:#f92672">[</span>ko<span style="color:#f92672">]=</span>Fcitx <span style="color:#ae81ff">5</span>
Name<span style="color:#f92672">[</span>zh_CN<span style="color:#f92672">]=</span>Fcitx <span style="color:#ae81ff">5</span>
Name<span style="color:#f92672">[</span>zh_TW<span style="color:#f92672">]=</span>Fcitx <span style="color:#ae81ff">5</span>
Name<span style="color:#f92672">=</span>Fcitx <span style="color:#ae81ff">5</span>
GenericName<span style="color:#f92672">[</span>ca<span style="color:#f92672">]=</span>Mètode d<span style="color:#e6db74">&#39;entrada
</span><span style="color:#e6db74">GenericName[da]=Inputmetode
</span><span style="color:#e6db74">GenericName[de]=Eingabemethode
</span><span style="color:#e6db74">GenericName[ja]=入力メソッド
</span><span style="color:#e6db74">GenericName[ko]=입력기
</span><span style="color:#e6db74">GenericName[ru]=Метод ввода
</span><span style="color:#e6db74">GenericName[zh_CN]=输入法
</span><span style="color:#e6db74">GenericName[zh_TW]=輸入法
</span><span style="color:#e6db74">GenericName=Input Method
</span><span style="color:#e6db74">Comment[ca]=Mètode d&#39;</span>entrada estàndard
Comment<span style="color:#f92672">[</span>da<span style="color:#f92672">]=</span>Start inputmetode
Comment<span style="color:#f92672">[</span>de<span style="color:#f92672">]=</span>Eingabemethode starten
Comment<span style="color:#f92672">[</span>ja<span style="color:#f92672">]=</span>入力メソッドを開始
Comment<span style="color:#f92672">[</span>ko<span style="color:#f92672">]=</span>입력기 시작
Comment<span style="color:#f92672">[</span>zh_CN<span style="color:#f92672">]=</span>启动输入法
Comment<span style="color:#f92672">=</span>Start Input Method
Exec<span style="color:#f92672">=</span>/usr/bin/fcitx5
Icon<span style="color:#f92672">=</span>fcitx
Terminal<span style="color:#f92672">=</span>false
Type<span style="color:#f92672">=</span>Application
Categories<span style="color:#f92672">=</span>System;Utility;
StartupNotify<span style="color:#f92672">=</span>false
X-GNOME-AutoRestart<span style="color:#f92672">=</span>false
X-GNOME-Autostart-Notify<span style="color:#f92672">=</span>false
X-KDE-autostart-after<span style="color:#f92672">=</span>panel
X-KDE-StartupNotify<span style="color:#f92672">=</span>false
X-KDE-Wayland-VirtualKeyboard<span style="color:#f92672">=</span>true
</code></pre></div><p><strong>扩展</strong></p>
<ul>
<li><a href="https://extensions.gnome.org/extension/261/kimpanel/">Input Method Panel</a></li>
</ul>
<h4 id="speed-up-dnfhttpsostechnixcomhow-to-speed-up-dnf-package-manager-in-fedora"><a href="https://ostechnix.com/how-to-speed-up-dnf-package-manager-in-fedora/">Speed Up DNF</a><a hidden class="anchor" aria-hidden="true" href="#speed-up-dnfhttpsostechnixcomhow-to-speed-up-dnf-package-manager-in-fedora">#</a></h4>
<p>尝试更改参数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo vi /etc/dnf/dnf.conf
fastestmirror<span style="color:#f92672">=</span>true
max_parallel_downloads<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
metadata_expire<span style="color:#f92672">=</span>2d
</code></pre></div><ul>
<li>fastermirror 选择最快的镜像</li>
<li>max_parallel_downloads 一次下载多个包</li>
</ul>
<p>如果在更新过程中某个小包下载不了，导致无法更新，尝试只使用 ipv4 或者点击下载链接手动下载</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf update -4 -v -y
</code></pre></div><h4 id="mirrors">Mirrors<a hidden class="anchor" aria-hidden="true" href="#mirrors">#</a></h4>
<h5 id="bfsuhttpsmirrorsbfsueducnhelpfedora"><a href="https://mirrors.bfsu.edu.cn/help/fedora/">bfsu</a><a hidden class="anchor" aria-hidden="true" href="#bfsuhttpsmirrorsbfsueducnhelpfedora">#</a></h5>
<p>tuna的姊妹站，通俗来讲就是tuna派人维护，北京外国语大学出钱。人少、稳定、涵盖项目较广。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo mkdir /etc/yum.repos.d/bak
$ sudo mv /etc/yum.repos.d/<span style="color:#f92672">{</span>fedora,fedora-updates,fedora-modular,fedora-updates-modular<span style="color:#f92672">}</span>.repo /etc/yum.repos.d/bak

$ sudo nano /etc/yum.repos.d/fedora.repo
<span style="color:#f92672">[</span>fedora<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>Fedora $releasever - $basearch
failovermethod<span style="color:#f92672">=</span>priority
baseurl<span style="color:#f92672">=</span>https://mirrors.bfsu.edu.cn/fedora/releases/$releasever/Everything/$basearch/os/
metadata_expire<span style="color:#f92672">=</span>28d
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgkey<span style="color:#f92672">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch
skip_if_unavailable<span style="color:#f92672">=</span>False

$ sudo nano /etc/yum.repos.d/fedora-updates.repo
<span style="color:#f92672">[</span>updates<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>Fedora $releasever - $basearch - Updates
failovermethod<span style="color:#f92672">=</span>priority
baseurl<span style="color:#f92672">=</span>https://mirrors.bfsu.edu.cn/fedora/updates/$releasever/Everything/$basearch/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
metadata_expire<span style="color:#f92672">=</span>6h
gpgkey<span style="color:#f92672">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch
skip_if_unavailable<span style="color:#f92672">=</span>False

$ sudo nano /etc/yum.repos.d/fedora-modular.repo
<span style="color:#f92672">[</span>fedora-modular<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>Fedora Modular $releasever - $basearch
failovermethod<span style="color:#f92672">=</span>priority
baseurl<span style="color:#f92672">=</span>https://mirrors.bfsu.edu.cn/fedora/releases/$releasever/Modular/$basearch/os/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
metadata_expire<span style="color:#f92672">=</span>7d
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgkey<span style="color:#f92672">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch
skip_if_unavailable<span style="color:#f92672">=</span>False

$ sudo nano /etc/yum.repos.d/fedora-updates-modular.repo
<span style="color:#f92672">[</span>updates-modular<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>Fedora Modular $releasever - $basearch - Updates
failovermethod<span style="color:#f92672">=</span>priority
baseurl<span style="color:#f92672">=</span>https://mirrors.bfsu.edu.cn/fedora/updates/$releasever/Modular/$basearch/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
metadata_expire<span style="color:#f92672">=</span>6h
gpgkey<span style="color:#f92672">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch
skip_if_unavailable<span style="color:#f92672">=</span>False
</code></pre></div><p>最后运行 <code>sudo dnf makecache</code> 生成缓存。</p>
<h5 id="rpmfusion">rpmfusion<a hidden class="anchor" aria-hidden="true" href="#rpmfusion">#</a></h5>
<p>第一步下载基础包(开源和闭源)， 这里我们使用bfsu来下载，以避免网络问题，终端输入:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo yum install --nogpgcheck https://mirrors.bfsu.edu.cn/rpmfusion/free/fedora/rpmfusion-free-release-<span style="color:#66d9ef">$(</span>rpm -E %fedora<span style="color:#66d9ef">)</span>.noarch.rpm https://mirrors.bfsu.edu.cn/rpmfusion/nonfree/fedora/rpmfusion-nonfree-release-<span style="color:#66d9ef">$(</span>rpm -E %fedora<span style="color:#66d9ef">)</span>.noarch.rpm
</code></pre></div><p>第二步，<a href="https://mirrors.ustc.edu.cn/help/fedora.html">使用bfsu镜像</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo sed -e <span style="color:#e6db74">&#39;s|^metalink=|#metalink=|g&#39;</span> -e <span style="color:#e6db74">&#39;s|^#baseurl=http://download1.rpmfusion.org/|baseurl=https://mirrors.bfsu.edu.cn/rpmfusion/|g&#39;</span> -i.bak /etc/yum.repos.d/rpmfusion-*
</code></pre></div><h5 id="flatpak">flatpak<a hidden class="anchor" aria-hidden="true" href="#flatpak">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
$ sudo flatpak remote-modify flathub --url<span style="color:#f92672">=</span>https://mirror.sjtu.edu.cn/flathub
</code></pre></div><h4 id="nvidiahttpsdocsfedoraprojectorgen-usquick-docshow-to-set-nvidia-as-primary-gpu-on-optimus-based-laptops"><a href="https://docs.fedoraproject.org/en-US/quick-docs/how-to-set-nvidia-as-primary-gpu-on-optimus-based-laptops/">Nvidia</a><a hidden class="anchor" aria-hidden="true" href="#nvidiahttpsdocsfedoraprojectorgen-usquick-docshow-to-set-nvidia-as-primary-gpu-on-optimus-based-laptops">#</a></h4>
<ul>
<li>
<p>Update from the existing repositories</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf update
</code></pre></div></li>
<li>
<p><a href="https://itsfoss.com/fedora-third-party-repos/">Add the RPMFusion repository</a> for NVIDIA drivers</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf install fedora-workstation-repositories
</code></pre></div></li>
<li>
<p>Update from the newly added repositories</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf update --refresh
</code></pre></div></li>
<li>
<p>Install the driver and its dependencies</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf install gcc kernel-headers kernel-devel akmod-nvidia xorg-x11-drv-nvidia xorg-x11-drv-nvidia-libs xorg-x11-drv-nvidia-libs.i686
</code></pre></div></li>
<li>
<p>Wait for the kernel modules to load up</p>
</li>
<li>
<p>Read from the updated kernel modules</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo akmods --force
$ sudo dracut --force
</code></pre></div></li>
<li>
<p>Reboot your system</p>
</li>
<li>
<p>Edit the X11 configuration</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo cp -p /usr/share/X11/xorg.conf.d/nvidia.conf /etc/X11/xorg.conf.d/nvidia.conf
$ sudo nano /etc/X11/xorg.conf.d/nvidia.conf
Section <span style="color:#e6db74">&#34;OutputClass&#34;</span>
	Identifier <span style="color:#e6db74">&#34;nvidia&#34;</span>
	MatchDriver <span style="color:#e6db74">&#34;nvidia-drm&#34;</span>
	Driver <span style="color:#e6db74">&#34;nvidia&#34;</span>
	Option <span style="color:#e6db74">&#34;AllowEmptyInitialConfiguration&#34;</span>
	Option <span style="color:#e6db74">&#34;SLI&#34;</span> <span style="color:#e6db74">&#34;Auto&#34;</span>
	Option <span style="color:#e6db74">&#34;BaseMosaic&#34;</span> <span style="color:#e6db74">&#34;on&#34;</span>
	Option <span style="color:#e6db74">&#34;PrimaryGPU&#34;</span> <span style="color:#e6db74">&#34;yes&#34;</span>
EndSection

Section <span style="color:#e6db74">&#34;ServerLayout&#34;</span>
	Identifier <span style="color:#e6db74">&#34;layout&#34;</span>
	Option <span style="color:#e6db74">&#34;AllowNVIDIAGPUScreens&#34;</span>
EndSection
</code></pre></div></li>
<li>
<p>Reboot your system</p>
</li>
<li>
<p>Verify the configuration</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ glxinfo | egrep <span style="color:#e6db74">&#34;OpenGL vendor|OpenGL renderer&#34;</span>
</code></pre></div></li>
</ul>
<h4 id="zfs-on-fedora">ZFS on Fedora<a hidden class="anchor" aria-hidden="true" href="#zfs-on-fedora">#</a></h4>
<p>zfs-fuse is a daemon which provides support for the ZFS filesystem, via fuse. Ordinarily this daemon will be invoked from system boot scripts.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf install zfs-fuse
$ sudo zfs-fuse
$ sudo zpool import dpool
cannot import <span style="color:#e6db74">&#39;dpool&#39;</span>: pool is formatted using a newer ZFS version
</code></pre></div><p><a href="https://openzfs.github.io/openzfs-docs/Getting%20Started/Fedora/index.html"><strong>OpenZFS on Fedora</strong></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo rpm -e --nodeps zfs-fuse
$ sudo dnf install -y https://zfsonlinux.org/fedora/zfs-release<span style="color:#66d9ef">$(</span>rpm -E %dist<span style="color:#66d9ef">)</span>.noarch.rpm
$ sudo dnf install -y kernel-devel
$ sudo dnf install -y zfs
$ sudo modprobe zfs
$ echo zfs | sudo tee /etc/modules-load.d/zfs.conf
</code></pre></div><h4 id="managing-dnf-repositoryhttpsdocsfedoraprojectorgen-usfedora23htmlsystem_administrators_guidesec-managing_dnf_repositorieshtml"><a href="https://docs.fedoraproject.org/en-US/Fedora/23/html/System_Administrators_Guide/sec-Managing_DNF_Repositories.html">Managing DNF Repository</a><a hidden class="anchor" aria-hidden="true" href="#managing-dnf-repositoryhttpsdocsfedoraprojectorgen-usfedora23htmlsystem_administrators_guidesec-managing_dnf_repositorieshtml">#</a></h4>
<p>DNF repositories commonly provide their own <code>.repo</code> file. To add such a repository to your system and enable it, run the following command as <code>root</code>:</p>
<pre tabindex="0"><code>dnf config-manager --add-repo repository_url
</code></pre><p>To enable a particular repository or repositories, type the following at a shell prompt as <code>root</code>:</p>
<pre tabindex="0"><code>dnf config-manager --set-enabled repository…
</code></pre><p>To disable a DNF repository, run the following command as <code>root</code>:</p>
<pre tabindex="0"><code>dnf config-manager --set-disabled repository…
</code></pre><h4 id="podman">Podman<a hidden class="anchor" aria-hidden="true" href="#podman">#</a></h4>
<p><strong>kali linux</strong></p>
<ul>
<li>
<p>开代理的话会报错：</p>
<pre tabindex="0"><code>Could not connect to 127.0.0.1:7890 (127.0.0.1). - connect (111: Connection refused)
</code></pre><p>查看 <a href="https://docs.podman.io/en/latest/markdown/podman-run.1.html#http-proxy"><code>man podman-run</code></a>，添加 <code>--http-proxy=false</code> 解决：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ podman run --http-proxy<span style="color:#f92672">=</span>false -it docker.io/kalilinux/kali-rolling:latest /bin/bash
</code></pre></div></li>
<li>
<p>更换 <a href="https://mirrors.ustc.edu.cn/help/kali.html">ustc 源</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo <span style="color:#e6db74">&#39;deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free con
</span><span style="color:#e6db74">trib&#39;</span> &gt; sources.list
</code></pre></div></li>
<li>
<p><a href="https://www.kali.org/docs/containers/official-kalilinux-docker-images/">metapackage</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ apt update <span style="color:#f92672">&amp;&amp;</span> apt -y install kali-linux-headless
</code></pre></div></li>
</ul>
<h4 id="connect-to-servers-with-nautilushttpswwwaddictivetipscomubuntu-linux-tipsconnect-to-servers-with-gnome-file-manager"><a href="https://www.addictivetips.com/ubuntu-linux-tips/connect-to-servers-with-gnome-file-manager/">connect to servers with nautilus</a><a hidden class="anchor" aria-hidden="true" href="#connect-to-servers-with-nautilushttpswwwaddictivetipscomubuntu-linux-tipsconnect-to-servers-with-gnome-file-manager">#</a></h4>
<pre tabindex="0"><code>ftp://ip.address.of.ftp.server
smb://ip.address.of.samba.file.server
nfs://ip.address.of.nfs.server
</code></pre><h4 id="killhttpswwwcnblogscomsparkdevp6659629html"><a href="https://www.cnblogs.com/sparkdev/p/6659629.html">kill</a><a hidden class="anchor" aria-hidden="true" href="#killhttpswwwcnblogscomsparkdevp6659629html">#</a></h4>
<p>kill 是向进程发送信号的命令。</p>
<table>
<thead>
<tr>
<th>代号</th>
<th>名称</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>SIGHUP</td>
<td>启动被终止的程序，可让该进程重新读取自己的配置文件，类似重新启动。</td>
</tr>
<tr>
<td>2</td>
<td>SIGINT</td>
<td>相当于用键盘输入 [ctrl]-c 来中断一个程序的进行。</td>
</tr>
<tr>
<td>9</td>
<td>SIGKILL</td>
<td>代表强制中断一个程序的进行，如果该程序进行到一半，那么尚未完成的部分可能会有“半产品”产生，类似 vim会有 .filename.swp 保留下来。</td>
</tr>
<tr>
<td>15</td>
<td>SIGTERM</td>
<td>以正常的方式来终止该程序。由于是正常的终止，所以后续的动作会将他完成。不过，如果该程序已经发生问题，就是无法使用正常的方法终止时，输入这个 signal 也是没有用的。</td>
</tr>
<tr>
<td>19</td>
<td>SIGSTOP</td>
<td>相当于用键盘输入 [ctrl]-z 来暂停一个程序的进行。</td>
</tr>
</tbody>
</table>
<h4 id="shell-freezeshttpswikiarchlinuxorgtitlegnometroubleshootingshell_freezes"><a href="https://wiki.archlinux.org/title/GNOME/Troubleshooting#Shell_freezes">Shell freezes</a><a hidden class="anchor" aria-hidden="true" href="#shell-freezeshttpswikiarchlinuxorgtitlegnometroubleshootingshell_freezes">#</a></h4>
<p>In the event of a shell freeze (which might be caused by certain appearance tweaks, malfunctioning extensions or perhaps a lack of available memory), restarting the shell by pressing <code>Alt+F2</code> and then entering <code>r</code> may not be possible.</p>
<p>In this case, try switching to another TTY (<code>Ctrl+Alt+F2</code>) and entering the following command: <code>pkill -HUP gnome-shell</code>. It may take a few seconds before the shell successfully restarts. On X11, restarting the shell in this fashion should not log the user out, but it is a good idea to try and ensure that all work is saved anyway; on Wayland (currently the default), restarting the shell kills the whole session, so everything will be lost.</p>
<p>If this fails, the Xorg server will need to be restarted either by <code>pkill X</code> for console logins or by restarting <code>gdm.service</code> for GDM logins. Bear in mind that restarting the Xorg server will log the user out, so try to ensure that all work is saved before attempting this.</p>
<h5 id="fix-a-frozen-gnome-desktop-sessionhttpswwwaddictivetipscomubuntu-linux-tipsfix-frozen-gnome-desktop-session"><a href="https://www.addictivetips.com/ubuntu-linux-tips/fix-frozen-gnome-desktop-session/#">fix a frozen Gnome desktop session</a><a hidden class="anchor" aria-hidden="true" href="#fix-a-frozen-gnome-desktop-sessionhttpswwwaddictivetipscomubuntu-linux-tipsfix-frozen-gnome-desktop-session">#</a></h5>
<p>在较旧的 Gnome（即 Gnome 3.28 之前）中，您可以使用此命令重新启动 GNome shell。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ glxinfo | grep display
name of display: :1
display: :1  screen: <span style="color:#ae81ff">0</span>
$ touch gnome-restart
$ echo <span style="color:#e6db74">&#39;#!/bin/bash&#39;</span> &gt; gnome-restart
$ echo <span style="color:#e6db74">&#39;DISPLAY=:1 gnome-shell --replace &amp;&#39;</span> &gt;&gt; gnome-restart
$ sudo chmod +x gnome-restart
$ ./gnome-restart
</code></pre></div><h5 id="重启-gnome-shellhttpsbynsscomlinux705736htmlamp"><a href="https://bynss.com/linux/705736.html/amp/">重启 Gnome Shell</a><a hidden class="anchor" aria-hidden="true" href="#重启-gnome-shellhttpsbynsscomlinux705736htmlamp">#</a></h5>
<p>可以使用 <code>busctl --user call org.gnome.Shell /org/gnome/Shell org.gnome.Shell Eval s 'Meta.restart(&quot;Restarting…&quot;)'</code> 命令行执行 <code>ALT + F2 r</code> 相同的操作。</p>
<p>亦可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo systemctl restart systemd-logind
</code></pre></div><h4 id="dnf-system-upgradehttpsdocsfedoraprojectorgen-usquick-docsdnf-system-upgrade"><a href="https://docs.fedoraproject.org/en-US/quick-docs/dnf-system-upgrade/">DNF System Upgrade</a><a hidden class="anchor" aria-hidden="true" href="#dnf-system-upgradehttpsdocsfedoraprojectorgen-usquick-docsdnf-system-upgrade">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf upgrade --refresh
$ sudo reboot
$ sudo dnf install dnf-plugin-system-upgrade
$ sudo dnf system-upgrade download --releasever<span style="color:#f92672">=</span><span style="color:#ae81ff">35</span>
$ sudo dnf system-upgrade reboot
</code></pre></div><ul>
<li>Change the <code>--releasever=</code> number if you want to upgrade to a different release.</li>
<li>If some of your packages have unsatisfied dependencies, the upgrade will refuse to continue until you run it again with an extra <code>--allowerasing</code> option. This often happens with packages installed from third-party repositories for which an updated repositories hasn’t been yet published. Study the output very carefully and examine which packages are going to be removed. None of them should be essential for system functionality, but some of them might be important for your productivity.
<ul>
<li>In case of unsatisfied dependencies, you can sometimes see more details if you add <code>--best</code> option to the command line.</li>
<li>If you want to remove/install some packages manually before running <code>dnf system-upgrade download</code> again, it is advisable to perform those operations with <code>--setopt=keepcache=1</code> dnf command line option. Otherwise the whole package cache will be removed after your operation, and you will need to download all the packages once again.</li>
</ul>
</li>
<li>There are other <strong>important optional operations</strong> here, please read the official documentation.</li>
</ul>
<h4 id="dnf-local-pluginhttpsfedoramagazineorguse-the-dnf-local-plugin-to-speed-up-your-home-lab"><a href="https://fedoramagazine.org/use-the-dnf-local-plugin-to-speed-up-your-home-lab/">DNF local plugin</a><a hidden class="anchor" aria-hidden="true" href="#dnf-local-pluginhttpsfedoramagazineorguse-the-dnf-local-plugin-to-speed-up-your-home-lab">#</a></h4>
<p>An internet search yields two common solutions that eliminate or reduce repeat downloads of the same RPM set – create a private Fedora Linux mirror or set up a caching proxy.</p>
<p>Fedora provides guidance on setting up a [private mirror](<a href="https://fedoraproject.org/wiki/">https://fedoraproject.org/wiki/</a> Infrastructure/Mirroring#How_can_someone_make_a_private_mirror). A mirror requires a lot of bandwidth and disk space and significant work to maintain. A full private mirror would be too expensive and it would be overkill for my purposes.</p>
<p>The most common solution I found online was to implement a caching proxy using Squid. I had two concerns with this type of solution. First, I would need to edit repository definitions stored in <em>/etc/yum.repo.d</em> on each virtual and physical machine or container to use the same mirror. Second, I would need to use <em>http</em> and not <em>https</em> connections which would introduce a security risk.</p>
<p>After reading Glenn’s 2018 post on the DNF local plugin, I searched for additional information but could not find much of anything besides the sparse documentation for the plugin on the DNF documentation web site. This article is intended to raise awareness of this plugin.</p>
<h4 id="use-dns-over-tlshttpsfedoramagazineorguse-dns-over-tls"><a href="https://fedoramagazine.org/use-dns-over-tls/">Use DNS over TLS</a><a hidden class="anchor" aria-hidden="true" href="#use-dns-over-tlshttpsfedoramagazineorguse-dns-over-tls">#</a></h4>
<h4 id="dnf-updateinfohttpsfedoramagazineorguse-dnf-updateinfo-to-read-update-changelogs"><a href="https://fedoramagazine.org/use-dnf-updateinfo-to-read-update-changelogs/">dnf updateinfo</a><a hidden class="anchor" aria-hidden="true" href="#dnf-updateinfohttpsfedoramagazineorguse-dnf-updateinfo-to-read-update-changelogs">#</a></h4>
<p>First, check the updates available:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dnf check-update
</code></pre></div><p>OK, so run your first <em>dnf updateinfo</em> command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dnf updateinfo
</code></pre></div><p>Look at the list of updates and which types they belong to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dnf updateinfo list
</code></pre></div><p>The next command will list the actual changelog.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dnf updateinfo info
</code></pre></div><p><a href="https://fedoramagazine.org/how-to-install-only-security-and-bugfixes-updates-with-dnf/">install only security and bugfixes updates</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dnf check-update --security --bugfix
$ sudo dnf update --security --bugfix
</code></pre></div><p>Install only specific updates</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo dnf update --advisories<span style="color:#f92672">=</span>FEDORA-2021-74ebf2f06f,FEDORA-2021-83fdddca0f
</code></pre></div><h4 id="gaming-on-fedorahttpsfedoramagazineorggaming-on-fedora"><a href="https://fedoramagazine.org/gaming-on-fedora/">Gaming on Fedora</a><a hidden class="anchor" aria-hidden="true" href="#gaming-on-fedorahttpsfedoramagazineorggaming-on-fedora">#</a></h4>
<ul>
<li>Nvidia Drivers</li>
<li>Steam(<a href="https://www.protondb.com/">ProtonDB</a>)/<a href="https://lutris.net/">Lutris</a>/<a href="https://q4wine.brezblock.org.ua/">Q4Wine</a></li>
<li>Discord</li>
<li>OBS</li>
<li>GOverlay</li>
</ul>
<h4 id="i3-spin">i3 Spin<a hidden class="anchor" aria-hidden="true" href="#i3-spin">#</a></h4>
<p>安装程序是 <code>liveinst</code>。</p>
<h3 id="questions">Questions<a hidden class="anchor" aria-hidden="true" href="#questions">#</a></h3>
<h4 id="cannot-open-acess-to-console-the-root-account-is-locked">Cannot open acess to console, the root account is locked&hellip;<a hidden class="anchor" aria-hidden="true" href="#cannot-open-acess-to-console-the-root-account-is-locked">#</a></h4>
<p>先是添加一个 LV 到 /etc/fstab，结果开机报错，原因是写错了：</p>
<pre tabindex="0"><code>Time out ...Dependency failed for ...
</code></pre><p>结束后就 Cannot open acess to console, the root account is locked，什么也干不了，只能强制关机。</p>
<p>解决方案是重启进入 Fedora Live CD，挂载 root，修改 /etc/fstab。但是无法挂载，挂载的是 Fedora Live CD 的 root，我 TM 佛了，原因应该是这两个名一模一样，Live CD 覆盖了 root。最后是用 Ubntu Live CD 解决。</p>
<p>这告诉我们，不要只有一个 Live CD。这还告诉我们，先找自己的原因才能有耐心去解决问题。</p>
<h4 id="dmesg-x86cpu-sgx-disabled-by-bios">dmesg-x86/cpu: SGX disabled by BIOS<a hidden class="anchor" aria-hidden="true" href="#dmesg-x86cpu-sgx-disabled-by-bios">#</a></h4>
<p><a href="http://www.jos.org.cn/html/2018/9/5594.htm#top">SGX技术的分析和研究</a></p>
<h4 id="snd_hda_codec_hdmi-hdaudioc0d2-monitor-plugged-in-failed-to-power-up-codec-ret-13httpsbbsarchlinuxorgviewtopicphpid261225"><a href="https://bbs.archlinux.org/viewtopic.php?id=261225">snd_hda_codec_hdmi hdaudioC0D2: Monitor plugged-in, Failed to power up codec ret=[-13]</a><a hidden class="anchor" aria-hidden="true" href="#snd_hda_codec_hdmi-hdaudioc0d2-monitor-plugged-in-failed-to-power-up-codec-ret-13httpsbbsarchlinuxorgviewtopicphpid261225">#</a></h4>
<p>set <a href="https://wiki.archlinux.org/title/Kernel_parameters_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Kernel parameters</a>，要使改变在重启后仍生效，您可以手动编辑 /boot/grub/grub.cfg。对于初学者，建议编辑 /etc/default/grub 并将您的内核选项添加至 GRUB_CMDLINE_LINUX_DEFAULT 行：</p>
<pre tabindex="0"><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;snd_hda_codec_hdmi.enable_silent_stream=0&quot;
</code></pre><p>然后重新生成 grub.cfg 文件：</p>
<pre tabindex="0"><code># grub2grub-mkconfig2 -o /boot/grub2/grub.cfg
</code></pre><h4 id="为什么-linus-torvalds-用-fedorahttpswwwzhihucomquestion36863290"><a href="https://www.zhihu.com/question/36863290">为什么 Linus Torvalds 用 Fedora</a><a hidden class="anchor" aria-hidden="true" href="#为什么-linus-torvalds-用-fedorahttpswwwzhihucomquestion36863290">#</a></h4>
<ul>
<li>2008：linus对发行版的要求是&quot;易安装，比较贴近上游&quot;即可（滚动+少折腾”）。</li>
<li>2010年的时候，他指出了Fedora 14的一个bug。</li>
<li>2011年Fedora 15换Gnome3作为默认DE了，Linus直言&quot;unholy mess&quot; ，然后转投XFCE。</li>
<li>2011年末，Linus提出并修补了openSUSE中Xorg的一个严重bug。</li>
<li>2013年5月：Linus尝试将自己手头的MacBook Air装上Linux，把几个大的发行版全部都试了一遍。发现只有Fedora能正常工作。</li>
<li>之后的所有消息就是各种fedora了</li>
</ul>
<h4 id="代理后为什么-ping-不通httpswwwzhihucomquestion20053991"><a href="https://www.zhihu.com/question/20053991">代理后为什么 ping 不通</a><a hidden class="anchor" aria-hidden="true" href="#代理后为什么-ping-不通httpswwwzhihucomquestion20053991">#</a></h4>
<p>问题：</p>
<p>设置了http_proxy和https_proxy在.bashrc文件里，firefox可以上网了。ping外网能够解析域名，但ping不通</p>
<p>解答：</p>
<p>首先提一个问题，为什么我们要用代理服务器上网？</p>
<p>那是因为如果不用代理服务器，我们访问的website 被blocked，最简单的方式就是在一个大型防火墙上执行： deny website IP。</p>
<p>而使用代理服务器，无非是用代理服务器的IP作为目的IP，把用户的HTTP、HTTPS封装在TCP上，这样途径防火墙时，由于目的IP不在blocked IP 之列，所以被放行，这样我们就可以浏览一些被blocked 的网页。</p>
<p>但是一般代理服务器并不为UDP/ICMP服务，最多为TCP服务，所以你ping website 时，代理服务器并没有介入，因为Ping是ICMP报文，那就意味着你的ping包的目的IP就是被blocked IP地址，很显然无法正常通过，全被丢了。</p>
<h4 id="fedora安装chrome后显示您的浏览器由所属组织管理httpsbugzillaredhatcomshow_bugcgiid1680129"><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1680129">Fedora安装Chrome后显示“您的浏览器由所属组织管理”</a><a hidden class="anchor" aria-hidden="true" href="#fedora安装chrome后显示您的浏览器由所属组织管理httpsbugzillaredhatcomshow_bugcgiid1680129">#</a></h4>
<p>I finally got a chance to look into this today, and I don&rsquo;t think it&rsquo;s as alarming as this BZ makes it sound. Yes, Chrome (over-)states that it is &ldquo;Managed by your organization&rdquo;. Clicking on that links to <a href="https://support.google.com/chrome/answer/9281740">https://support.google.com/chrome/answer/9281740</a> which lists the things a managed system <em>can</em> do. However, if you read just a few sentences further, it tells you how to view exactly which settings your administrator has enabled, which in turn has links to the descriptions of what those features are. As clearly linked there, the only settings we&rsquo;ve enabled is &ldquo;This browser can negotiate authentication with *.fedoraproject.org&rdquo;.</p>
<p>So, I&rsquo;m inclined to say that while the initial reading page might lead a user to be slightly concerned, I don&rsquo;t feel that the situation is particularly dire. They can always just read content in the links.</p>
<p>In the worst case, if someone <em>really</em> doesn&rsquo;t want to have that message appear, they can just <code>dnf remove fedora-chromium-config</code>.</p>
<p><strong><a href="https://src.fedoraproject.org/rpms/fedora-chromium-config">fedora-chromium-config</a></strong></p>
<p>This package is used to install customizations for Chromium/Chrome that are recommended by Fedora, including a user-agent string identifying the system as Fedora.</p>
<p>It includes a GSSAPI configuration that enables access to many Fedora Project services. To add support for other domains, replace the symlink /etc/chromium/policies/managed/00_gssapi.json with your own content. (<a href="https://src.fedoraproject.org/rpms/fedora-chromium-config">upstream</a>)</p>
<h4 id="difference-between-docker-attach-and-docker-exechttpsstackoverflowcoma30962120"><a href="https://stackoverflow.com/a/30962120">difference between docker attach and docker exec</a><a hidden class="anchor" aria-hidden="true" href="#difference-between-docker-attach-and-docker-exechttpsstackoverflowcoma30962120">#</a></h4>
<p>There was a <a href="https://github.com/docker/docker/commit/2f46ec60c012e94771698351515178fe9caea21a">commit PR</a> which added to the doc:</p>
<blockquote>
<p><strong>Note:</strong> This command (<code>attach</code>) is not for running a new process in a container. See: <code>docker exec</code>.</p>
</blockquote>
<p>The answer to &ldquo;<a href="https://askubuntu.com/a/507009/5470">Docker. How to get bash\ssh inside runned container (<code>run -d</code>)?</a>&rdquo; illustrates the difference:</p>
<blockquote>
<p>(docker &gt;= 1.3) If we use <a href="https://docs.docker.com/engine/reference/commandline/attach/"><code>docker attach</code></a>, <strong>we can use only one instance of shell</strong>.
So if we want to open new terminal with new instance of container&rsquo;s shell, we just need to run <a href="https://docs.docker.com/engine/reference/commandline/exec/"><code>docker exec</code></a></p>
<p>if the docker container was started using <code>/bin/bash</code> command, you can access it using attach, if not then you need to <em>execute</em> the command to create a bash instance inside the container using <code>exec</code>.</p>
</blockquote>
<p>As mentioned in <a href="https://github.com/docker/docker/issues/2855#issuecomment-57102647">this issue</a>:</p>
<blockquote>
<ul>
<li>Attach isn&rsquo;t for running an extra thing in a container, it&rsquo;s for attaching to the running process.</li>
<li>&ldquo;<code>docker exec</code>&rdquo; is specifically for running new things in a already started container, be it a shell or some other process.</li>
</ul>
</blockquote>
<p>The same issue adds:</p>
<blockquote>
<p>While <code>attach</code> is not well named, particularly because of the LXC command <code>lxc-attach</code> (which is more akin <code>docker exec &lt;container&gt; /bin/sh</code>, but LXC specific), it does have a specific purpose of literally attaching you to the process Docker started.
<strong>Depending on what the process is the behavior may be different</strong>, for instance attaching to <code>/bin/bash</code> will give you a shell, but attaching to redis-server will be like you&rsquo;d just started redis directly without daemonizing.</p>
</blockquote>
<h4 id="error-syncing-passwordshttpssupportgooglecomchromethread9947763error-syncing-passwordshlen"><a href="https://support.google.com/chrome/thread/9947763/error-syncing-passwords?hl=en">Error syncing passwords</a><a hidden class="anchor" aria-hidden="true" href="#error-syncing-passwordshttpssupportgooglecomchromethread9947763error-syncing-passwordshlen">#</a></h4>
<blockquote>
<p><em>Error: MergeDataAndStartSyncing@../../components/password_manager/core/browser/sync/password_syncable_service.cc:190, datatype error was encountered: Failed to get passwords from store.</em></p>
</blockquote>
<p>The problem was solved by deleting &lsquo;Login Data&rsquo; and &lsquo;Login Data-journal&rsquo; in the profile.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ rm -rf ~/.config/google-chrome/Default/Login<span style="color:#ae81ff">\ </span>Data*
</code></pre></div><p>The <code>&lt;profile&gt;</code> part can be found in the Profile Path on the chrome://version page.</p>
<h2 id="centos">CentOS<a hidden class="anchor" aria-hidden="true" href="#centos">#</a></h2>
<h3 id="red-hat-enterprise-linux-developer-subscriptionhttpsdevelopersredhatcomproductsrheldownload"><a href="https://developers.redhat.com/products/rhel/download">Red Hat Enterprise Linux Developer Subscription</a><a hidden class="anchor" aria-hidden="true" href="#red-hat-enterprise-linux-developer-subscriptionhttpsdevelopersredhatcomproductsrheldownload">#</a></h3>
<p>Need to log in to download RHEL.</p>
<p><a href="https://access.redhat.com/zh_CN/solutions/1119463">怎样使用 Red Hat Subscription Manager (RHSM) 将系统注册到红帽客户门户网站？</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># subscription-manager register --username &lt;username&gt; --password &lt;password&gt; --auto-attach</span>
</code></pre></div><p><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/8/html-single/configuring_basic_system_settings/index">配置 Red Hat Enterprise Linux 8 中基本系统设置的指南</a></p>
<p><a href="https://yangfeiffei.github.io/">Frey&rsquo;s Blog</a></p>
<ul>
<li><a href="https://yangfeiffei.github.io/all">所有文章</a></li>
<li><a href="https://yangfeiffei.github.io/public/2019/07/06/multitheading-concept.html#">分类 </a></li>
</ul>
<h3 id="关于多线程httpsyangfeiffeigithubiopublic20190706multitheading-concepthtml"><a href="https://yangfeiffei.github.io/public/2019/07/06/multitheading-concept.html">关于多线程</a><a hidden class="anchor" aria-hidden="true" href="#关于多线程httpsyangfeiffeigithubiopublic20190706multitheading-concepthtml">#</a></h3>
<h4 id="概述">概述<a hidden class="anchor" aria-hidden="true" href="#概述">#</a></h4>
<p>每个正在系统上运行的程序都是一个进程。每个进程包含一到N个线程。进程也可能是整个程序或者是部分程序的动态执行。线程是一组指令的集合，或者是程序的特殊段，它可以在程序里独立执行。也可以把它理解为代码运行的上下文。所以线程基本上是轻量级的进程，它负责在单个程序里执行多任务。通常由操作系统负责多个线程的调度和执行。线程是程序中一个单一的顺序控制流程。在单个程序中同时运行多个线程完成不同的工作,称为多线程。</p>
<p>线程和进程的区别在于,子进程和父进程有不同的代码和数据空间,而多个线程则共享数据空间,每个线程有自己的执行堆栈和程序计数器为其执行上下文.多线程主要是为了节约CPU时间,发挥利用,根据具体情况而定. 线程的运行中需要使用计算机的内存资源和CPU。</p>
<p><code>同步多线程（SMT）</code>是一种在一个CPU 的时钟周期内能够执行来自多个线程的指令的硬件多线程技术。本质上，同步多线程是一种将线程级并行处理（多CPU）转化为指令级并行处理（同一CPU）的方法。 同步多线程是单个物理处理器从多个硬件线程上下文同时分派指令的能力。同步多线程用于在商用环境中及为周期/指令（CPI）计数较高的工作负载创造性能优势。 处理器采用超标量结构，最适于以并行方式读取及运行指令。同步多线程使您可在同一处理器上同时调度两个应用程序，从而利用处理器的超标量结构性质。</p>
<p><code>超线程（HT, Hyper-Threading）</code>是英特尔研发的一种技术，于2002年发布。通过此技术，英特尔实现在一个实体CPU中，提供两个逻辑线程。</p>
<p>其实可以将<code>SMT</code>和<code>HT</code>理解为一个技术。</p>
<blockquote>
<p>Hyper-threading (officially called Hyper- ThreadingTechnology or HT Technology, and abbreviated as HTT orHT) is Intel’s proprietary simultaneous multithreading (SMT) implementation used to improve parallelization ofcomputations (doing multiple tasks at once) performed onx86 microprocessors.</p>
<p>来自 <a href="https://cn.bing.com/search?q=intel+ht&amp;go=%E6%8F%90%E4%BA%A4&amp;qs=ds&amp;form=QBLHCN">https://cn.bing.com/search?q=intel+ht&amp;go=%E6%8F%90%E4%BA%A4&amp;qs=ds&amp;form=QBLHCN</a></p>
</blockquote>
<h4 id="与多进程的区别">与多进程的区别<a hidden class="anchor" aria-hidden="true" href="#与多进程的区别">#</a></h4>
<blockquote>
<p>“进程——资源分配的最小单位，线程——程序执行的最小单位”</p>
</blockquote>
<p>实际应用中基本上都是“进程+线程”的结合方式，千万不要真的陷入一种非此即彼的误区。</p>
<table>
<thead>
<tr>
<th style="text-align:center">对比维度</th>
<th style="text-align:center">多进程</th>
<th style="text-align:center">多线程</th>
<th style="text-align:center">总结</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据共享、同步</td>
<td style="text-align:center">数据共享复杂，需要用IPC；数据是分开的，同步简单</td>
<td style="text-align:center">因为共享进程数据，数据共享简单，但也是因为这个原因导致同步复杂</td>
<td style="text-align:center">各有优势</td>
</tr>
<tr>
<td style="text-align:center">内存、CPU</td>
<td style="text-align:center">占用内存多，切换复杂，CPU利用率低</td>
<td style="text-align:center">占用内存少，切换简单，CPU利用率高</td>
<td style="text-align:center">线程占优</td>
</tr>
<tr>
<td style="text-align:center">创建销毁、切换</td>
<td style="text-align:center">创建销毁、切换复杂，速度慢</td>
<td style="text-align:center">创建销毁、切换简单，速度很快</td>
<td style="text-align:center">线程占优</td>
</tr>
<tr>
<td style="text-align:center">编程、调试</td>
<td style="text-align:center">编程简单，调试简单</td>
<td style="text-align:center">编程复杂，调试复杂</td>
<td style="text-align:center">进程占优</td>
</tr>
<tr>
<td style="text-align:center">可靠性</td>
<td style="text-align:center">进程间不会互相影响</td>
<td style="text-align:center">一个线程挂掉将导致整个进程挂掉</td>
<td style="text-align:center">进程占优</td>
</tr>
<tr>
<td style="text-align:center">分布式</td>
<td style="text-align:center">适应于多核、多机分布式；如果一台机器不够，扩展到多台机器比较简单</td>
<td style="text-align:center">适应于多核分布式</td>
<td style="text-align:center">进程占优</td>
</tr>
</tbody>
</table>
<ul>
<li>需要注意：</li>
</ul>
<blockquote>
<p>1）需要频繁创建销毁的优先用线程</p>
<p>2）需要进行大量计算的优先使用线程</p>
<p>3）强相关的处理用线程，弱相关的处理用进程</p>
<p>一般的Server需要完成如下任务：消息收发、消息处理。“消息收发”和“消息处理”就是弱相关的任务，而“消息处理”里面可能又分为“消息解码”、“业务处理”，这两个任务相对来说相关性就要强多了。因此“消息收发”和“消息处理”可以分进程设计，“消息解码”、“业务处理”可以分线程设计。当然这种划分方式不是一成不变的，也可以根据实际情况进行调整。</p>
<p>4）可能要扩展到多机分布的用进程，多核分布的用线程</p>
<p>5）都满足需求的情况下，用你最熟悉、最拿手的方式</p>
<p>来自 <a href="https://blog.csdn.net/lishenglong666/article/details/8557215">https://blog.csdn.net/lishenglong666/article/details/8557215</a></p>
</blockquote>
<h4 id="如何使用">如何使用？<a hidden class="anchor" aria-hidden="true" href="#如何使用">#</a></h4>
<p>需要CPU、BIOS、操作系统、应用软件都支持多线程技术才可以。</p>
<h4 id="支持多线程的cpu">支持多线程的<code>CPU</code><a hidden class="anchor" aria-hidden="true" href="#支持多线程的cpu">#</a></h4>
<p><code>Power CPU </code>支持的<code>SMT</code>技术：</p>
<blockquote>
<p>Simultaneous multithreading (SMT) is a processor technology that allows multiple instruction streams (threads) to run concurrently on the same physical processor, improving overall throughput. To the operating system, each hardware thread is treated as an independent logical processor. Single-threaded (ST) execution mode is also supported.</p>
<p>来自 <a href="https://www.ibm.com/support/knowledgecenter/SSFHY8_6.2/reference/am5gr_f0106.html?view=embed">https://www.ibm.com/support/knowledgecenter/SSFHY8_6.2/reference/am5gr_f0106.html?view=embed</a></p>
</blockquote>
<p><code>Intel CPU </code>支持的<code>HT</code>技术：</p>
<blockquote>
<p>Intel® Hyper-Threading Technology (Intel® HT Technology) uses processor resources more efficiently, enabling multiple threads to run on each core. As a performance feature, it also increases processor throughput, improving overall performance on threaded software. Intel® HT Technology is available on the latest Intel® Core™ vPro™ processors, the Intel® Core™ processor family, the Intel® Core™ M processor family, and the Intel® Xeon® processor family. By combining one of these Intel® processors and chipsets with an operating system and BIOS supporting Intel® HT Technology.</p>
<p>来自 <a href="https://www.intel.com/content/www/us/en/architecture-and-technology/hyper-threading/hyper-threading-technology.html">https://www.intel.com/content/www/us/en/architecture-and-technology/hyper-threading/hyper-threading-technology.html</a></p>
</blockquote>
<h4 id="smtht支持情况"><code>SMT/HT</code>支持情况<a hidden class="anchor" aria-hidden="true" href="#smtht支持情况">#</a></h4>
<ul>
<li>Intel CPU : 2 Thread/Core</li>
<li>Power9 CPU： 8 Thread /Core</li>
<li>Sparc: 8 Thread /Core</li>
</ul>
<h5 id="rhel7centos7--intel-cpu"><code>RHEL7/CentOS7 &amp; Intel CPU</code><a hidden class="anchor" aria-hidden="true" href="#rhel7centos7--intel-cpu">#</a></h5>
<p><code>BIOS </code>中修改<code>SMT/HT</code> 的设置，使用这种方式<code>Enable</code>或者<code>Disable</code>后，将永久生效，需要重启。</p>
<pre tabindex="0"><code>Hyper-Threading Technology BIOS Setup Options

For Intel® Desktop/Server Boards setup option location is the main menu of the BIOS setup program.

 • Located on the same menu screen that already had Processor Type, Processor Speed, System Bus Speed, and other related processor fields.

 • Setup Option Text

  ○ The field is called Hyper-Threading Technology.

 • Setup Option Values

  ○ The setup option values are Enabled and Disabled.

 • Setup Option Help Text

来自 &lt;https://www.intel.com/content/www/us/en/support/articles/000007645/boards-and-kits/desktop-boards.html&gt; 
</code></pre><p><code>RHEL/CentOS</code>操作系统中查看多线程情况：（更多信息：https://access.redhat.com/solutions/rhel-smt）</p>
<pre tabindex="0"><code># lscpu | grep -e Socket -e Core -e Thread
Thread(s) per core: 2 # 线程数
Core(s) per socket: 6 # core 数量
Socket(s): 2
</code></pre><p>或者</p>
<pre tabindex="0"><code># grep -H . /sys/devices/system/cpu/cpu*/topology/thread_siblings_list | sort -n -t ':' -k 2 -u

# 显示 /sys/devices/system/cpu/cpu0/topology/thread_siblings_list:0 # 表示HT关闭
# 显示 /sys/devices/system/cpu/cpu0/topology/thread_siblings_list:0-1 # 表示 HT 启用
</code></pre><p>操作系统层关闭多线程有几种办法：</p>
<ul>
<li>方法一：使用<code>nosmt</code>启动参数，需要新的<code>x86 CPU</code>，需要重启</li>
</ul>
<pre tabindex="0"><code># grubby --args=nosmt --update-kernel=DEFAULT
# grub2-mkconfig -o  /boot/grub/grub.conf   # 创建新的grub.conf
# reboot  #重启
</code></pre><ul>
<li>方法二：临时关闭，重启后失效</li>
</ul>
<pre tabindex="0"><code># echo off &gt; /sys/devices/system/cpu/smt/control
 /sys/devices/system/cpu/smt/control:
This file allows to read out the SMT control state and provides the
     ability to disable or (re)enable SMT. The possible states are:
============== ===================================================
        on SMT is supported by the CPU and enabled. All
                        logical CPUs can be onlined and offlined without
                        restrictions.
off SMT is supported by the CPU and disabled. Only
                        the so called primary SMT threads can be onlined
                        and offlined without restrictions. An attempt to
                        online a non-primary sibling is rejected
forceoff Same as 'off' but the state cannot be controlled.
                        Attempts to write to the control file are rejected.
notsupported The processor does not support SMT. It's therefore
                        not affected by the SMT implications of L1TF.
                        Attempts to write to the control file are rejected.
        ============== ===================================================
The possible states which can be written into this file to control SMT
     state are:
     - on
     - off
     - forceoff
/sys/devices/system/cpu/smt/active:
This file reports whether SMT is enabled and active, i.e. if on any
     physical core two or more sibling threads are online.
</code></pre><h5 id="aix--power">AIX &amp; Power<a hidden class="anchor" aria-hidden="true" href="#aix--power">#</a></h5>
<p><code>Power9 CPU</code>默认支持8线程，使用<code>smtctl</code>命令可以查看和修改<code> smt</code>级别。更多内容查看https://www.ibm.com/support/knowledgecenter/ssw_aix_72/com.ibm.aix.cmds5/smtctl.htm</p>
<ul>
<li>查看<code> SMT level</code></li>
</ul>
<pre tabindex="0"><code>smtctl
</code></pre><ul>
<li>临时修改 <code>SMT level</code>, # 可以是 <code>1, 2, 4 or 8</code>，重启后将恢复原来的<code>smt level</code></li>
</ul>
<pre tabindex="0"><code>smtctl -t 2 -w now
</code></pre><ul>
<li>修改 <code>SMT level</code>永久生效，# 可以是 <code>1, 2, 4 or 8</code>，完成后需要使用<code>bosboot</code>创建启动设备</li>
</ul>
<pre tabindex="0"><code> smtctl -t 4 -w boot
 bosboot -a # Creates complete boot image and device.
</code></pre><h5 id="rhel7--power">RHEL7 &amp; Power<a hidden class="anchor" aria-hidden="true" href="#rhel7--power">#</a></h5>
<p><code>OpenPower CPU</code> 默认支持4线程，安装<code>RHEL</code>后可以使用开源的工具 <code>ppc64_cpu</code>进行查看和修改多线程（更多查看 <a href="https://github.com/ibm-power-utilities/powerpc-utils">https://github.com/ibm-power-utilities/powerpc-utils</a>）。</p>
<pre tabindex="0"><code>ppc64_cpu
---------

This allows users to set the smt state, smt-snooze-delay and other settings

on ppc64 processors. It also allows users to control the number of processor

cores which are online (not in the sleep state).
来自 &lt;https://github.com/ibm-power-utilities/powerpc-utils&gt; 
</code></pre><p>1，查看 <code>SMT level</code></p>
<pre tabindex="0"><code>ppc64_cpu --smt
</code></pre><p>2，修改 <code>SMT </code>级别， <code># is 1, 2, 4 or on</code></p>
<pre tabindex="0"><code>ppc64_cpu --smt=#
</code></pre><p>3， 关闭 <code>smt</code>支持</p>
<pre tabindex="0"><code>ppc64_cpu --smt=off
</code></pre><h4 id="其他">其他<a hidden class="anchor" aria-hidden="true" href="#其他">#</a></h4>
<h5 id="oracle数据库"><code>oracle</code>数据库<a hidden class="anchor" aria-hidden="true" href="#oracle数据库">#</a></h5>
<p><code>Oracle Database</code> 在12c之前<code>windows</code>平台下支持多线程，<code>Unix</code>和<code>Linux</code>只支持多进程模式。在<code>Oracle Database 12c</code>中，<code>Oracle</code>引入了多线程模式，允许在<code>Windows</code>平台之外的<code>Unix</code>、<code>Linux</code>系统使用多线程模式，结合多进程与多线程模式，<code>Oracle</code>可以改进进程管理与性能。</p>
<p>通过设置初始化参数<code>threaded_execution</code>，可以启用或关闭多线程模式，该参数缺省值为<code>False</code>，设置为<code>TRUE</code>启用12c的这个新特性：</p>
<pre tabindex="0"><code>SQL&gt; show parameter threaded_exec

NAME TYPE VALUE

---

threaded_execution boolean FALSE

SQL&gt; alter system set threaded_execution=true scope=spfile;

System altered.
</code></pre><p>该参数重新启动数据库后生效，但是注意，多线程模式，不支持操作系统认证，不能直接启动数据库，需要提供<code>SYS</code>的密码认证后方能启动数据库：</p>
<pre tabindex="0"><code>SQL&gt; shutdown immediate;

SQL&gt; startup

ORA-01017: invalid username/password; logon denied

# 需要通过用户名和密码登录数据库。
</code></pre><p>用<code>ps -ef</code> 检查一下进程/线程：</p>
<pre tabindex="0"><code>[oracle@enmocoredb dbs]$ ps -ef|grep ora_
oracle 27404 1 0 17:00 ? 00:00:00 ora_pmon_core
oracle 27406 1 0 17:00 ? 00:00:00 ora_psp0_core
oracle 27408 1 3 17:00 ? 00:00:05 ora_vktm_core
oracle 27412 1 0 17:00 ? 00:00:00 ora_u004_core
oracle 27418 1 0 17:00 ? 00:00:00 ora_u005_core
oracle 27424 1 0 17:00 ? 00:00:00 ora_dbw0_core
其中U&lt;NNN&gt;进程是共享线程的&quot;容器进程&quot;，每个进程可以容纳100个线程。
来自 https://www.eygle.com/archives/2013/07/oracle_database_12c_multithreaded_model.html 
</code></pre><h3 id="连接热点">连接热点<a hidden class="anchor" aria-hidden="true" href="#连接热点">#</a></h3>
<ul>
<li>
<p>打开WIFI</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ifconfig interface up 
</code></pre></div></li>
<li>
<p>查看所有可用的无线网络信号</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iw wlp2s0 scan | grep SSID
</code></pre></div></li>
<li>
<p>连接无线网</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wpa_supplicant -B -i wlp2s0 -c &lt;<span style="color:#f92672">(</span>wpa_passphrase <span style="color:#e6db74">&#34;SSID&#34;</span> <span style="color:#e6db74">&#34;passwd&#34;</span><span style="color:#f92672">)</span> 
</code></pre></div></li>
<li>
<p>分配IP地址</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dhclient interface
</code></pre></div></li>
<li>
<p>查看无线网卡地址信息，有ip地址表示网络连接成功</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ifconfig interface
</code></pre></div></li>
</ul>
<h3 id="pppoe-adsl拨号上网">PPPOE （ADSL）拨号上网<a hidden class="anchor" aria-hidden="true" href="#pppoe-adsl拨号上网">#</a></h3>
<ul>
<li>
<p>安装拨号软件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnf install  rp-pppoe* ppp*
</code></pre></div></li>
<li>
<p>设定</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pppoe-setup
</code></pre></div></li>
<li>
<p>拨号上网</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pppoe-stoppppoe-start
</code></pre></div></li>
</ul>
<h3 id="安装中文输入法">安装中文输入法<a hidden class="anchor" aria-hidden="true" href="#安装中文输入法">#</a></h3>
<ul>
<li>
<p>安装 fcitx</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnf install fcitx-im fcitx-configtool fcitx-googlepinyin
</code></pre></div></li>
<li>
<p>配置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nano ~/.xprofile  <span style="color:#75715e"># or ~/.bashrc</span>
export GTK_MODULE<span style="color:#f92672">=</span>fcitx
export QT_IM_MODULE<span style="color:#f92672">=</span>fcitx
export XMODIFIERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@im=fcitx&#34;</span>
</code></pre></div></li>
<li>
<p>fcitx  没图标：重装fcitx，在fcitx配置里关掉Kimpanel</p>
</li>
</ul>
<h3 id="关闭触摸板">关闭触摸板<a hidden class="anchor" aria-hidden="true" href="#关闭触摸板">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dnf install xorg-x11-apps 
synclient TouchpadOff<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>    <span style="color:#75715e"># 关闭</span>
synclient TouchpadOff<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    <span style="color:#75715e"># 开启</span>
</code></pre></div><h3 id="用-mtp-挂载手机">用 MTP 挂载手机<a hidden class="anchor" aria-hidden="true" href="#用-mtp-挂载手机">#</a></h3>
<ul>
<li>
<p>安装jmtpfs</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnf install jmtpfs
</code></pre></div></li>
<li>
<p>查看手机 “busnum”和“devnum”</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">jmptfs -l
</code></pre></div></li>
<li>
<p>建立挂载点</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /media/dir
</code></pre></div></li>
<li>
<p>挂载手机</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">jmtpfs -device<span style="color:#f92672">=</span>busnum,devnum /media/dir/
</code></pre></div></li>
</ul>
<h3 id="查找依赖">查找依赖<a hidden class="anchor" aria-hidden="true" href="#查找依赖">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ yum whatprovide package
$ dnf provides package
</code></pre></div><h3 id="默认字体">默认字体<a hidden class="anchor" aria-hidden="true" href="#默认字体">#</a></h3>
<p>CentOS 默认字体目录 <code>/lib/kbd/consolefonts</code></p>
<p>纯命令行是不能使用系统之外的字体的。</p>
<h3 id="centos-minimal--xfce">CentOS Minimal + Xfce<a hidden class="anchor" aria-hidden="true" href="#centos-minimal--xfce">#</a></h3>
<p>base 源与 epel 源，使用用阿里镜像: <a href="https://developer.aliyun.com/mirror/">https://developer.aliyun.com/mirror/</a></p>
<ul>
<li>
<p>安装Xfce4，先安装 Xfce 可以保证不安装多余的包</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnf group listdnf groupinstall Xfce
</code></pre></div></li>
<li>
<p>安装 X Window system</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnf groupinstall <span style="color:#e6db74">&#34;X Window system&#34;</span>
</code></pre></div></li>
<li>
<p>验证</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl isolate graphical.target
</code></pre></div></li>
<li>
<p>设置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 设置成命令模式systemctl set-default multi-user.target        # 设置成图形模式systemctl set-default graphical.target        </span>
</code></pre></div></li>
<li>
<p>安装中文字体和中文输入法楷体字体</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnf install cjkuni-ukai-fonts
</code></pre></div></li>
<li>
<p>输入法需要安装如下包：</p>
<ul>
<li>ibus， 这个包里有ibus-daemon这个平台服务器程序和ibus这个配置助手。</li>
<li>ibus-libpinyin， 这个是ibus平台下具体的拼音输入法。</li>
<li>im-chooser,这个是输入法平台选择助手程序。</li>
<li>执行im-chooser，选择输入法平台和输入法。重新登录系统。</li>
</ul>
</li>
<li>
<p>xfce 主题</p>
<ul>
<li>网站：xfce-look.org</li>
<li>主题目录： <code>/usr/share/themes</code> 或 <code>~/.themes</code></li>
<li>图标鼠标目录： <code>/usr/share/icons</code> 或 <code>~/.icons</code></li>
<li>壁纸： <code>/usr/share/background</code> , <code>/usr/share/wallpapers</code></li>
<li><a href="http://li.nux.ro/">Plank</a></li>
</ul>
</li>
</ul>
<h3 id="epelhttpswwwjianshucomp4f4c0897075f"><a href="https://www.jianshu.com/p/4f4c0897075f">EPEL</a><a hidden class="anchor" aria-hidden="true" href="#epelhttpswwwjianshucomp4f4c0897075f">#</a></h3>
<p>EPEL的全称叫 Extra Packages for Enterprise Linux 。EPEL是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。装上了 EPEL之后，就相当于添加了一个第三方源。</p>
<p>如果你知道rpmfusion.org的话，拿 rpmfusion 做比较还是很恰当的，rpmfusion 主要为桌面发行版提供大量rpm包（只有开源驱动才能进官方源，想要闭源驱动装rpmfusion），而EPEL则为服务器版本提供大量的rpm包，而且大多数rpm包在官方 repository 中是找不到的。</p>
<h2 id="linux-deploy">Linux Deploy<a hidden class="anchor" aria-hidden="true" href="#linux-deploy">#</a></h2>
<h3 id="准备">准备<a hidden class="anchor" aria-hidden="true" href="#准备">#</a></h3>
<p>一个 Root 了的 Android 手机</p>
<p><a href="https://www.busybox.net/">Busy Box</a>：Linux Deploy 支撑软件。</p>
<p><a href="https://github.com/meefik/linuxdeploy/releases">Linux deploy</a>：Linux 系统支撑软件。</p>
<h4 id="安装-busy-box">安装 Busy Box<a hidden class="anchor" aria-hidden="true" href="#安装-busy-box">#</a></h4>
<p>点击安装，等待程序自行运行，在界面中输出 <code>## END</code> 后退出程序。</p>
<h4 id="linux-deploy-1">Linux deploy<a hidden class="anchor" aria-hidden="true" href="#linux-deploy-1">#</a></h4>
<ul>
<li>点击左图左上角部分，选择 <strong>设置</strong>，在设置界面中找到PATH变量，赋予其值 <code>/system/xbin</code>。</li>
<li>建议开启 <strong>锁定Wifi</strong> 功能。</li>
<li>接着退回主界面，点击右下角部分。</li>
<li><strong>发行版</strong> 看个人喜好选择，Debian 系（Debian，Kaili，Ubuntu）较热门。</li>
<li><strong>架构</strong> 默认。</li>
<li><strong>源</strong> 默认。如果下的慢的话，就仿照默认的源换为国内的源，如 <a href="http://mirrors.ustc.edu.cn/">USTC MIRRORS</a>，但是不要特意去换源，官方的源用的了的话官方的源最好。</li>
<li><strong>安装路径</strong> ：安装在手机自带的存储空间中，则在路径开头加上<code>${ENV_DIR}</code>；安装在 <strong>sdcard</strong> 中，加上<code>${EXTERNAL_STORAGE}</code>。</li>
<li><strong>文件系统</strong> ：推荐 <code>ext4</code>。</li>
<li><strong>用户名</strong> 和 <strong>密码</strong> 自定义。</li>
<li><strong>DNS</strong> 默认。</li>
<li><strong>本地化</strong> ：简体中文可以选择 <code>zh_CN.UTF-8</code>，建议选择 <code>en_US.UTF-8</code> 。</li>
<li><strong>挂载列表</strong>：添加访问手机内容的目录，<strong>手机目录：挂载点</strong>，如 <code>/sdcard:/mnt</code>，之后会自动挂载。</li>
<li><strong>开启<code>SSH</code></strong>。</li>
<li><strong>图形界面功能</strong>，需要的话就选 <code>XFce</code> 为桌面，XFce`是轻量级桌面环境。</li>
<li>退出系统设置界面，点击主界面右上角，选择安装。
等待程序自行安装Linux系统，开始时会自动创造一个4G左右大小的img文件，这个是默认的大小，你可以根据你手机的容量自定义，创造文件需要一点时间，屏幕会很安静，再然后会安装各种东西，屏幕会输出很多信息，根据你的源的速度，等待时间不等，看到 <code>&lt;&lt;&lt;deploy</code> 则安装完毕。如果中间没有 <code>failed</code> 则安装成功。安装失败的话就需要重新安装，换个快一点的网，或者好一点的源。</li>
<li><strong>注意：安装完毕后要先点击停止按钮，再按启动按钮</strong>。这个很重要，不然你就得重装了。</li>
</ul>
<h3 id="使用">使用<a hidden class="anchor" aria-hidden="true" href="#使用">#</a></h3>
<ul>
<li>
<p>Andorid 端用 <a href="https://github.com/connectbot/connectbot/releases">ConnectBox</a></p>
</li>
<li>
<p>Windows用  <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">putty</a> ，图形界面用 <a href="https://www.realvnc.com/en/connect/download/viewer/">VNC Viewer</a>。VNC Viewer 直接搜主机IP就行，VNC Server 在你选择安装图形界面功能时就自动安装了，不需要再安装 vnc4server。</p>
</li>
<li>
<p>Linux 输入<code>ssh username@hostname</code>就行。</p>
</li>
</ul>
<h3 id="其他-1">其他<a hidden class="anchor" aria-hidden="true" href="#其他-1">#</a></h3>
<ul>
<li>
<p>安装后如果用 vnc viewer 只有一个点的话，可以换一个发行版，我尝试的 CentOS 有这个问题。</p>
</li>
<li>
<p>Linux连的时候出现 <code>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ssh-keygen -R + 输入服务器的IP
</code></pre></div></li>
<li>
<p>altarch 架构的手机 CentOS 系统换源</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cp CentOS-7-armhfp.repo CentOS-Base.repo
mv CentOS-7-armhfp.repo CentOS-7-armhfp.repo.backup
vi CentOS-Base.repo
baseurl<span style="color:#f92672">=</span>https://mirrors.ustc.edu.cn/centos-altarch/7.6.1810/os/armhfp/
yum makecache
yum update
</code></pre></div></li>
<li>
<p><strong>如果你之前没有安装VNC的话，现在又想装：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">yum -y install tigervnc-server
</code></pre></div></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://sakamotokurome.github.io/tags/unix/">Unix</a></li>
      <li><a href="https://sakamotokurome.github.io/tags/linux/">Linux</a></li>
      <li><a href="https://sakamotokurome.github.io/tags/fedora/">Fedora</a></li>
      <li><a href="https://sakamotokurome.github.io/tags/centos/">CentOS</a></li>
      <li><a href="https://sakamotokurome.github.io/tags/linux-deploy/">Linux Deploy</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://sakamotokurome.github.io/posts/opensuse/">
    <span class="title">« Prev Page</span>
    <br>
    <span>OpenSUSE</span>
  </a>
  <a class="next" href="https://sakamotokurome.github.io/posts/ubuntutips/">
    <span class="title">Next Page »</span>
    <br>
    <span>Ubuntu Tips</span>
  </a>
</nav>

  </footer>
</article>

<div class="disqus-container">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    this.page.identifier = 'cb04a6';
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "sakamotokurome" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://sakamotokurome.github.io/">Sakamoto Kurome</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
